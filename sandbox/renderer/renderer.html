<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	 "http://www.w3.org/TR/html4/strict.dtd">

<html>

<head>

	<meta http-equiv="content-type" content="text/html;charset=utf-8">
	<script type="text/javascript" src="../build/three.min.js"></script>
<!-- JSModeler includes start -->
	<script type="text/javascript" src="../../src/core/jsm.js"></script>
	<script type="text/javascript" src="../../src/core/timer.js"></script>
	<script type="text/javascript" src="../../src/geometry/determinant.js"></script>
	<script type="text/javascript" src="../../src/geometry/matrix.js"></script>
	<script type="text/javascript" src="../../src/geometry/coord.js"></script>
	<script type="text/javascript" src="../../src/geometry/coordutils.js"></script>
	<script type="text/javascript" src="../../src/geometry/coordsystem.js"></script>
	<script type="text/javascript" src="../../src/geometry/coordsystemutils.js"></script>
	<script type="text/javascript" src="../../src/geometry/sector.js"></script>
	<script type="text/javascript" src="../../src/geometry/sectorutils.js"></script>
	<script type="text/javascript" src="../../src/geometry/line.js"></script>
	<script type="text/javascript" src="../../src/geometry/lineutils.js"></script>
	<script type="text/javascript" src="../../src/geometry/transformation.js"></script>
	<script type="text/javascript" src="../../src/geometry/transformationutils.js"></script>
	<script type="text/javascript" src="../../src/geometry/plane.js"></script>
	<script type="text/javascript" src="../../src/geometry/planeutils.js"></script>
	<script type="text/javascript" src="../../src/geometry/projection.js"></script>
	<script type="text/javascript" src="../../src/geometry/convexhull.js"></script>
	<script type="text/javascript" src="../../src/geometry/polygon.js"></script>
	<script type="text/javascript" src="../../src/geometry/polygonutils.js"></script>
	<script type="text/javascript" src="../../src/geometry/bsptree.js"></script>
	<script type="text/javascript" src="../../src/geometry/utilities.js"></script>
	<script type="text/javascript" src="../../src/modeler/body.js"></script>
	<script type="text/javascript" src="../../src/modeler/model.js"></script>
	<script type="text/javascript" src="../../src/modeler/material.js"></script>
	<script type="text/javascript" src="../../src/modeler/bodyutils.js"></script>
	<script type="text/javascript" src="../../src/modeler/adjacencylist.js"></script>
	<script type="text/javascript" src="../../src/modeler/textureutils.js"></script>
	<script type="text/javascript" src="../../src/modeler/cututils.js"></script>
	<script type="text/javascript" src="../../src/modeler/generator.js"></script>
	<script type="text/javascript" src="../../src/modeler/camera.js"></script>
	<script type="text/javascript" src="../../src/modeler/explode.js"></script>
	<script type="text/javascript" src="../../src/modeler/exporter.js"></script>
	<script type="text/javascript" src="../../src/extras/solidgenerator.js"></script>
	<script type="text/javascript" src="../../src/extras/extgenerator.js"></script>
	<script type="text/javascript" src="../../src/extras/painter.js"></script>
	<script type="text/javascript" src="../../src/extras/drawing.js"></script>
	<script type="text/javascript" src="../../src/extras/subdivision.js"></script>
	<script type="text/javascript" src="../../src/extras/svgtomodel.js"></script>
	<script type="text/javascript" src="../../src/extras/csg.js"></script>
	<script type="text/javascript" src="../../src/extras/surfaces.js"></script>
	<script type="text/javascript" src="../../src/dialogs/basedialog.js"></script>
	<script type="text/javascript" src="../../src/dialogs/settingscontrols.js"></script>
	<script type="text/javascript" src="../../src/dialogs/settingsdialog.js"></script>
	<script type="text/javascript" src="../../src/dialogs/floatingdialog.js"></script>
	<script type="text/javascript" src="../../src/viewer/mouse.js"></script>
	<script type="text/javascript" src="../../src/viewer/touch.js"></script>
	<script type="text/javascript" src="../../src/viewer/converter.js"></script>
	<script type="text/javascript" src="../../src/viewer/viewer.js"></script>
	<script type="text/javascript" src="../../src/viewer/softwareviewer.js"></script>
<!-- JSModeler includes end -->
	<script type="text/javascript" src="renderer.js"></script>
	<title>Example</title>

	<script type="text/javascript">
		JSM.ConvertBodyToArrayBuffers = function (body, materials, geometries)
		{
			function OnGeometryStart (material)
			{
				function ConvertToShaderRGB (hexColor)
				{
					var hexString = hexColor.toString (16);
					while (hexString.length < 6) {
						hexString = '0' + hexString;
					}
					var r = parseInt (hexString.substr (0, 2), 16) / 255.0;
					var g = parseInt (hexString.substr (2, 2), 16) / 255.0;
					var b = parseInt (hexString.substr (4, 2), 16) / 255.0;
					return [r, g, b];
				};

				geometries.push ({
					material : {
						diffuse : ConvertToShaderRGB (material.diffuse)
					},
					vertices : [],
					normals : []
				});
			}

			function OnGeometryEnd (material)
			{
			
			}

			function OnTriangle (vertex1, vertex2, vertex3, normal1, normal2, normal3, uv1, uv2, uv3)
			{
				var lastGeometry = geometries[geometries.length - 1];
				lastGeometry.vertices.push (vertex1.x, vertex1.y, vertex1.z);
				lastGeometry.vertices.push (vertex2.x, vertex2.y, vertex2.z);
				lastGeometry.vertices.push (vertex3.x, vertex3.y, vertex3.z);
				lastGeometry.normals.push (normal1.x, normal1.y, normal1.z);
				lastGeometry.normals.push (normal2.x, normal2.y, normal2.z);
				lastGeometry.normals.push (normal3.x, normal3.y, normal3.z);
			}
			
			var explodeData = {
				hasConvexPolygons : false,
				onGeometryStart : OnGeometryStart,
				onGeometryEnd : OnGeometryEnd,
				onTriangle : OnTriangle
			};
			
			JSM.ExplodeBodyToTriangles (body, materials, explodeData);
		};

		JSM.ConvertModelToArrayBuffers = function (model, materials, geometries)
		{
			var i, body;
			for (i = 0; i < model.BodyCount (); i++) {
				body = model.GetBody (i);
				JSM.ConvertBodyToArrayBuffers (body, materials, geometries);
			}
		};

		function Load ()
		{
			var renderer = new JSM.Renderer ();
			if (!renderer.Init ('example')) {
				//alert ('error');
			} else {
				//alert ('success');
			}

			//var body = JSM.GenerateCylinder (0.5, 1, 50, true, true);
			//var body = JSM.GenerateCuboid (1, 1, 1);
			var materials = new JSM.Materials ();
			materials.AddMaterial (new JSM.Material (0xcc0000, 0xcc0000));
			materials.AddMaterial (new JSM.Material (0x0000cc, 0x0000cc));

			var body1 = JSM.GenerateTorus (1.0, 0.2, 50, 50, 1);
			
			var body2 = JSM.GenerateTorus (0.6, 0.1, 50, 50, 1);
			body2.Transform (JSM.TranslationTransformation (new JSM.Vector (0, -0.5, 1)));
			body2.SetPolygonsMaterialIndex (0);
			
			var body3 = JSM.GenerateTorus (0.3, 0.05, 50, 50, 1);
			body3.Transform (JSM.TranslationTransformation (new JSM.Vector (0, 1.5, 1)));
			body3.SetPolygonsMaterialIndex (1);

			var model = new JSM.Model ();
			model.AddBody (body1);
			model.AddBody (body2);
			model.AddBody (body3);

			var geometries = [];
			JSM.ConvertModelToArrayBuffers (model, materials, geometries);
			renderer.AddGeometries (geometries);
			renderer.Draw ();
		}
	
	    window.onload = function ()
		{
			Load ();
		}
	</script>

</head>

<body>
	<canvas id="example" width="800" height="500"></canvas>
</body>

</html>
