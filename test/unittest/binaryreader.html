<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	 "http://www.w3.org/TR/html4/strict.dtd">

<html>

<head>

	<meta http-equiv="content-type" content="text/html;charset=utf-8">
	<link rel="stylesheet" type="text/css" href="framework/test.css">

<!-- JSModeler includes start -->
	<script type="text/javascript" src="../../src/core/jsm.js"></script>
	<script type="text/javascript" src="../../src/core/timer.js"></script>
	<script type="text/javascript" src="../../src/core/algorithm.js"></script>
	<script type="text/javascript" src="../../src/geometry/coord.js"></script>
	<script type="text/javascript" src="../../src/geometry/determinant.js"></script>
	<script type="text/javascript" src="../../src/geometry/coordutils.js"></script>
	<script type="text/javascript" src="../../src/geometry/matrix.js"></script>
	<script type="text/javascript" src="../../src/geometry/coordsystem.js"></script>
	<script type="text/javascript" src="../../src/geometry/coordsystemutils.js"></script>
	<script type="text/javascript" src="../../src/geometry/sector.js"></script>
	<script type="text/javascript" src="../../src/geometry/sectorutils.js"></script>
	<script type="text/javascript" src="../../src/geometry/line.js"></script>
	<script type="text/javascript" src="../../src/geometry/lineutils.js"></script>
	<script type="text/javascript" src="../../src/geometry/transformation.js"></script>
	<script type="text/javascript" src="../../src/geometry/transformationutils.js"></script>
	<script type="text/javascript" src="../../src/geometry/plane.js"></script>
	<script type="text/javascript" src="../../src/geometry/planeutils.js"></script>
	<script type="text/javascript" src="../../src/geometry/projection.js"></script>
	<script type="text/javascript" src="../../src/geometry/convexhull.js"></script>
	<script type="text/javascript" src="../../src/geometry/polygon.js"></script>
	<script type="text/javascript" src="../../src/geometry/polygonutils.js"></script>
	<script type="text/javascript" src="../../src/geometry/bsptree.js"></script>
	<script type="text/javascript" src="../../src/geometry/utilities.js"></script>
	<script type="text/javascript" src="../../src/modeler/body.js"></script>
	<script type="text/javascript" src="../../src/modeler/model.js"></script>
	<script type="text/javascript" src="../../src/modeler/color.js"></script>
	<script type="text/javascript" src="../../src/modeler/light.js"></script>
	<script type="text/javascript" src="../../src/modeler/material.js"></script>
	<script type="text/javascript" src="../../src/modeler/bodyutils.js"></script>
	<script type="text/javascript" src="../../src/modeler/adjacencylist.js"></script>
	<script type="text/javascript" src="../../src/modeler/textureutils.js"></script>
	<script type="text/javascript" src="../../src/modeler/cututils.js"></script>
	<script type="text/javascript" src="../../src/modeler/generator.js"></script>
	<script type="text/javascript" src="../../src/modeler/camera.js"></script>
	<script type="text/javascript" src="../../src/modeler/explode.js"></script>
	<script type="text/javascript" src="../../src/modeler/exporter.js"></script>
	<script type="text/javascript" src="../../src/extras/solidgenerator.js"></script>
	<script type="text/javascript" src="../../src/extras/extgenerator.js"></script>
	<script type="text/javascript" src="../../src/extras/painter.js"></script>
	<script type="text/javascript" src="../../src/extras/drawing.js"></script>
	<script type="text/javascript" src="../../src/extras/subdivision.js"></script>
	<script type="text/javascript" src="../../src/extras/svgtomodel.js"></script>
	<script type="text/javascript" src="../../src/extras/csg.js"></script>
	<script type="text/javascript" src="../../src/extras/surfaces.js"></script>
	<script type="text/javascript" src="../../src/renderer/renderer.js"></script>
	<script type="text/javascript" src="../../src/renderer/pointcloudrenderer.js"></script>
	<script type="text/javascript" src="../../src/renderer/converter.js"></script>
	<script type="text/javascript" src="../../src/viewer/jsonfileloader.js"></script>
	<script type="text/javascript" src="../../src/viewer/mouse.js"></script>
	<script type="text/javascript" src="../../src/viewer/touch.js"></script>
	<script type="text/javascript" src="../../src/viewer/navigation.js"></script>
	<script type="text/javascript" src="../../src/viewer/softwareviewer.js"></script>
	<script type="text/javascript" src="../../src/viewer/spriteviewer.js"></script>
	<script type="text/javascript" src="../../src/viewer/viewer.js"></script>
	<script type="text/javascript" src="../../src/viewer/pointcloudviewer.js"></script>
	<script type="text/javascript" src="../../src/three/threeconverter.js"></script>
	<script type="text/javascript" src="../../src/three/threeviewer.js"></script>
	<script type="text/javascript" src="../../src/import/binaryreader.js"></script>
	<script type="text/javascript" src="../../src/import/importer.js"></script>
<!-- JSModeler includes end -->
	
	<title>JSModeler Test</title>

	<script type="text/javascript">
		function AddLogContent (content)
		{
			var logDiv = document.getElementById ('log');
			log.innerHTML += content;
		}		
	
		function AddLogLine (line)
		{
			var logDiv = document.getElementById ('log');
			log.innerHTML += line + '<br>';
		}
		
		function Assert (condition)
		{
			if (condition) {
				AddLogContent ('<span style="color: #00aa00;">success</a> ');
			} else {
				AddLogContent ('<span style="color: #aa0000;">failed</a> ');
			}
		}
	
		function RunURLTestExample (url)
		{
			AddLogLine ('url test (' + url + '):');
			JSM.GetArrayBufferFromURL (url, function (arrayBuffer) {
				var br = new JSM.BinaryReader (arrayBuffer, true);
				Assert (br.ReadBoolean () == true);
				Assert (br.ReadBoolean () == false);
				
				Assert (String.fromCharCode (br.ReadCharacter ()) == 'a');
				Assert (String.fromCharCode (br.ReadCharacter ()) == 'A');
				Assert (String.fromCharCode (br.ReadUnsignedCharacter ()) == 'a');
				Assert (String.fromCharCode (br.ReadUnsignedCharacter ()) == 'A');

				Assert (br.ReadInteger16 () == 42);
				Assert (br.ReadInteger16 () == -42);
				Assert (br.ReadInteger16 () == 32000);
				Assert (br.ReadInteger16 () == -32000);

				Assert (br.ReadUnsignedInteger16 () == 42);
				Assert (br.ReadUnsignedInteger16 () == 65494);
				Assert (br.ReadUnsignedInteger16 () == 32000);
				Assert (br.ReadUnsignedInteger16 () == 33536);

				Assert (br.ReadInteger32 () == 42);
				Assert (br.ReadInteger32 () == -42);
				Assert (br.ReadInteger32 () == 32000);
				Assert (br.ReadInteger32 () == -32000);
				Assert (br.ReadInteger32 () == 2000000000);
				Assert (br.ReadInteger32 () == -2000000000);

				Assert (br.ReadUnsignedInteger32 () == 42);
				Assert (br.ReadUnsignedInteger32 () == 4294967254);
				Assert (br.ReadUnsignedInteger32 () == 32000);
				Assert (br.ReadUnsignedInteger32 () == 4294935296);
				Assert (br.ReadUnsignedInteger32 () == 2000000000);
				Assert (br.ReadUnsignedInteger32 () == 2294967296);

				Assert (br.ReadInteger32 () == 42);
				Assert (br.ReadInteger32 () == -42);
				Assert (br.ReadInteger32 () == 32000);
				Assert (br.ReadInteger32 () == -32000);
				Assert (br.ReadInteger32 () == 2000000000);
				Assert (br.ReadInteger32 () == -2000000000);

				Assert (br.ReadUnsignedInteger32 () == 42);
				Assert (br.ReadUnsignedInteger32 () == 4294967254);
				Assert (br.ReadUnsignedInteger32 () == 32000);
				Assert (br.ReadUnsignedInteger32 () == 4294935296);
				Assert (br.ReadUnsignedInteger32 () == 2000000000);
				Assert (br.ReadUnsignedInteger32 () == 2294967296);

				Assert (JSM.IsEqual (br.ReadFloat32 (), 42.0));
				Assert (JSM.IsEqual (br.ReadFloat32 (), -42.0));
				Assert (JSM.IsEqual (br.ReadFloat32 (), 12345.6787109375));
				Assert (JSM.IsEqual (br.ReadFloat32 (), -12345.6787109375));

				Assert (JSM.IsEqual (br.ReadDouble64 (), 42.0));
				Assert (JSM.IsEqual (br.ReadDouble64 (), -42.0));
				Assert (JSM.IsEqual (br.ReadDouble64 (), 12345.6789));
				Assert (JSM.IsEqual (br.ReadDouble64 (), -12345.6789));
				
				AddLogLine ('');
			});
		}
	
		function RunURLTest3ds (url)
		{
			AddLogLine ('url test (' + url + '):');
			JSM.GetArrayBufferFromURL (url, function (arrayBuffer) {
				JSM.Read3dsFile (arrayBuffer, callbacks = {		
					onLog: function (logText, logLevel) {
						var logDiv = document.getElementById ('log');
						logDiv.innerHTML += '<div style="margin-left:' + (logLevel * 20) + 'px;">' + logText + '</div>';
					},
					onError: function () {
						alert ('something is wrong');
					},
					onMesh : function (meshName) {

					},
					onVertex : function (x, y, z) {
						
					},
					onFace : function (v0, v1, v2, flags) {
						
					},
					onFaceMaterial : function (materialName, faceIndex) {
						
					}					
				});
			});
		}

		function RunFileTestExample (file)
		{
			AddLogLine ('file test (' + file.name + '):');
			JSM.GetArrayBufferFromFile (file, function (arrayBuffer) {
				var br = new JSM.BinaryReader (arrayBuffer, true);
				Assert (br.ReadBoolean () == true);
				Assert (br.ReadBoolean () == false);
				
				Assert (br.ReadCharacter () == 'a');
				Assert (br.ReadCharacter () == 'A');
				Assert (br.ReadUnsignedCharacter () == 'a');
				Assert (br.ReadUnsignedCharacter () == 'A');

				Assert (br.ReadInteger16 () == 42);
				Assert (br.ReadInteger16 () == -42);
				Assert (br.ReadInteger16 () == 32000);
				Assert (br.ReadInteger16 () == -32000);

				Assert (br.ReadUnsignedInteger16 () == 42);
				Assert (br.ReadUnsignedInteger16 () == 65494);
				Assert (br.ReadUnsignedInteger16 () == 32000);
				Assert (br.ReadUnsignedInteger16 () == 33536);

				Assert (br.ReadInteger32 () == 42);
				Assert (br.ReadInteger32 () == -42);
				Assert (br.ReadInteger32 () == 32000);
				Assert (br.ReadInteger32 () == -32000);
				Assert (br.ReadInteger32 () == 2000000000);
				Assert (br.ReadInteger32 () == -2000000000);

				Assert (br.ReadUnsignedInteger32 () == 42);
				Assert (br.ReadUnsignedInteger32 () == 4294967254);
				Assert (br.ReadUnsignedInteger32 () == 32000);
				Assert (br.ReadUnsignedInteger32 () == 4294935296);
				Assert (br.ReadUnsignedInteger32 () == 2000000000);
				Assert (br.ReadUnsignedInteger32 () == 2294967296);

				Assert (br.ReadInteger32 () == 42);
				Assert (br.ReadInteger32 () == -42);
				Assert (br.ReadInteger32 () == 32000);
				Assert (br.ReadInteger32 () == -32000);
				Assert (br.ReadInteger32 () == 2000000000);
				Assert (br.ReadInteger32 () == -2000000000);

				Assert (br.ReadUnsignedInteger32 () == 42);
				Assert (br.ReadUnsignedInteger32 () == 4294967254);
				Assert (br.ReadUnsignedInteger32 () == 32000);
				Assert (br.ReadUnsignedInteger32 () == 4294935296);
				Assert (br.ReadUnsignedInteger32 () == 2000000000);
				Assert (br.ReadUnsignedInteger32 () == 2294967296);

				Assert (JSM.IsEqual (br.ReadFloat32 (), 42.0));
				Assert (JSM.IsEqual (br.ReadFloat32 (), -42.0));
				Assert (JSM.IsEqual (br.ReadFloat32 (), 12345.6787109375));
				Assert (JSM.IsEqual (br.ReadFloat32 (), -12345.6787109375));

				Assert (JSM.IsEqual (br.ReadDouble64 (), 42.0));
				Assert (JSM.IsEqual (br.ReadDouble64 (), -42.0));
				Assert (JSM.IsEqual (br.ReadDouble64 (), 12345.6789));
				Assert (JSM.IsEqual (br.ReadDouble64 (), -12345.6789));
				
				AddLogLine ('');
			});
		}

		function FileSelected (event)
		{
			var file = event.target.files[0];
			if (file.name == 'result.bin') {
				RunFileTestExample (file);
			}
		}
		
		window.onload = function ()
		{
			//document.getElementById ('file').addEventListener ('change', FileSelected, false);
			//RunURLTestExample ('testfiles/result.bin');
			RunURLTest3ds ('testfiles/cube.3ds');
		}
	</script>
	
</head>

<body>

	<input type="file" id="file" name="file"/>
	<div id="log"></div>

</body>

</html>
