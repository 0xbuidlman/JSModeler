/* JSModeler 0.4 - http://www.github.com/kovacsv/JSModeler */ var JSM={mainVersion:0,subVersion:4};JSM.Eps=1e-8;JSM.Inf=9999999999;JSM.RadDeg=57.29577951308232;JSM.DegRad=0.017453292519943;JSM.IsZero=function(a){return Math.abs(a)<JSM.Eps;};JSM.IsPositive=function(a){return a>JSM.Eps;};JSM.IsNegative=function(a){return a<-JSM.Eps;};JSM.IsLower=function(a,b){return b-a>JSM.Eps;};JSM.IsGreater=function(a,b){return a-b>JSM.Eps;};JSM.IsEqual=function(a,b){return Math.abs(b-a)<JSM.Eps;};JSM.IsLowerOrEqual=function(a,b){return JSM.IsLower(a,b)||JSM.IsEqual(a,b);};JSM.IsGreaterOrEqual=function(a,b){return JSM.IsGreater(a,b)||JSM.IsEqual(a,b);};JSM.Minimum=function(a,b){return JSM.IsLower(a,b)?a:b;};JSM.Maximum=function(a,b){return JSM.IsGreater(a,b)?a:b;};JSM.ArcSin=function(value){if(JSM.IsGreaterOrEqual(value,1)){return Math.PI/2;}else{if(JSM.IsLowerOrEqual(value,-1)){return -Math.PI/2;}}return Math.asin(value);};JSM.ArcCos=function(value){if(JSM.IsGreaterOrEqual(value,1)){return 0;}else{if(JSM.IsLowerOrEqual(value,-1)){return Math.PI;}}return Math.acos(value);};JSM.MatrixDeterminant2x2=function(m00,m01,m10,m11){return m00*m11-m01*m10;};JSM.MatrixDeterminant3x3=function(m00,m01,m02,m10,m11,m12,m20,m21,m22){var subDet1=JSM.MatrixDeterminant2x2(m11,m12,m21,m22);var subDet2=JSM.MatrixDeterminant2x2(m10,m12,m20,m22);var subDet3=JSM.MatrixDeterminant2x2(m10,m11,m20,m21);return m00*subDet1-m01*subDet2+m02*subDet3;};JSM.MatrixDeterminant4x4=function(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){var subDet1=JSM.MatrixDeterminant3x3(m11,m12,m13,m21,m22,m23,m31,m32,m33);var subDet2=JSM.MatrixDeterminant3x3(m10,m12,m13,m20,m22,m23,m30,m32,m33);var subDet3=JSM.MatrixDeterminant3x3(m10,m11,m13,m20,m21,m23,m30,m31,m33);var subDet4=JSM.MatrixDeterminant3x3(m10,m11,m12,m20,m21,m22,m30,m31,m32);return subDet1*m00-subDet2*m01+subDet3*m02-subDet4*m03;};JSM.VectorMatrixMultiply4x4=function(vector,matrix){var result=[];var a00=vector[0];var a01=vector[1];var a02=vector[2];var a03=vector[3];var b00=matrix[0];var b01=matrix[1];var b02=matrix[2];var b03=matrix[3];var b10=matrix[4];var b11=matrix[5];var b12=matrix[6];var b13=matrix[7];var b20=matrix[8];var b21=matrix[9];var b22=matrix[10];var b23=matrix[11];var b30=matrix[12];var b31=matrix[13];var b32=matrix[14];var b33=matrix[15];result[0]=a00*b00+a01*b10+a02*b20+a03*b30;result[1]=a00*b01+a01*b11+a02*b21+a03*b31;result[2]=a00*b02+a01*b12+a02*b22+a03*b32;result[3]=a00*b03+a01*b13+a02*b23+a03*b33;return result;};JSM.MatrixMultiply4x4=function(matrix1,matrix2){var result=[];var a00=matrix1[0];var a01=matrix1[1];var a02=matrix1[2];var a03=matrix1[3];var a10=matrix1[4];var a11=matrix1[5];var a12=matrix1[6];var a13=matrix1[7];var a20=matrix1[8];var a21=matrix1[9];var a22=matrix1[10];var a23=matrix1[11];var a30=matrix1[12];var a31=matrix1[13];var a32=matrix1[14];var a33=matrix1[15];var b00=matrix2[0];var b01=matrix2[1];var b02=matrix2[2];var b03=matrix2[3];var b10=matrix2[4];var b11=matrix2[5];var b12=matrix2[6];var b13=matrix2[7];var b20=matrix2[8];var b21=matrix2[9];var b22=matrix2[10];var b23=matrix2[11];var b30=matrix2[12];var b31=matrix2[13];var b32=matrix2[14];var b33=matrix2[15];result[0]=a00*b00+a01*b10+a02*b20+a03*b30;result[1]=a00*b01+a01*b11+a02*b21+a03*b31;result[2]=a00*b02+a01*b12+a02*b22+a03*b32;result[3]=a00*b03+a01*b13+a02*b23+a03*b33;result[4]=a10*b00+a11*b10+a12*b20+a13*b30;result[5]=a10*b01+a11*b11+a12*b21+a13*b31;result[6]=a10*b02+a11*b12+a12*b22+a13*b32;result[7]=a10*b03+a11*b13+a12*b23+a13*b33;result[8]=a20*b00+a21*b10+a22*b20+a23*b30;result[9]=a20*b01+a21*b11+a22*b21+a23*b31;result[10]=a20*b02+a21*b12+a22*b22+a23*b32;result[11]=a20*b03+a21*b13+a22*b23+a23*b33;result[12]=a30*b00+a31*b10+a32*b20+a33*b30;result[13]=a30*b01+a31*b11+a32*b21+a33*b31;result[14]=a30*b02+a31*b12+a32*b22+a33*b32;result[15]=a30*b03+a31*b13+a32*b23+a33*b33;return result;};JSM.Coord2D=function(x,y){this.x=x||0;this.y=y||0;};JSM.Coord2D.prototype={Set:function(x,y){this.x=x||0;this.y=y||0;}};JSM.Coord=function(x,y,z){this.x=x||0;this.y=y||0;this.z=z||0;};JSM.Coord.prototype={Set:function(x,y,z){this.x=x;this.y=y;this.z=z;}};JSM.Vector2D=JSM.Coord2D;JSM.Vector=JSM.Coord;JSM.CoordIsEqual2D=function(a,b){return JSM.IsEqual(a.x,b.x)&&JSM.IsEqual(a.y,b.y);};JSM.CoordDistance2D=function(a,b){var x1=a.x;var y1=a.y;var x2=b.x;var y2=b.y;return Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1));};JSM.MidCoord2D=function(a,b){return new JSM.Coord2D((a.x+b.x)/2,(a.y+b.y)/2);};JSM.CoordIsEqual=function(a,b){return JSM.IsEqual(a.x,b.x)&&JSM.IsEqual(a.y,b.y)&&JSM.IsEqual(a.z,b.z);};JSM.CoordDistance=function(a,b){var x1=a.x;var y1=a.y;var z1=a.z;var x2=b.x;var y2=b.y;var z2=b.z;return Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)+(z2-z1)*(z2-z1));};JSM.CoordSignedDistance=function(a,b,direction){var abDirection=JSM.CoordSub(b,a);var distance=JSM.CoordDistance(a,b);var angle=JSM.GetVectorsAngle(abDirection,direction);if(JSM.IsEqual(angle,Math.PI)){distance=-distance;}return distance;};JSM.MidCoord=function(a,b){return new JSM.Coord((a.x+b.x)/2,(a.y+b.y)/2,(a.z+b.z)/2);};JSM.VectorMultiply=function(vector,scalar){var result=new JSM.Vector();result.x=vector.x*scalar;result.y=vector.y*scalar;result.z=vector.z*scalar;return result;};JSM.VectorDot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z;};JSM.VectorCross=function(a,b){var result=new JSM.Vector();result.x=a.y*b.z-a.z*b.y;result.y=a.z*b.x-a.x*b.z;result.z=a.x*b.y-a.y*b.x;return result;};JSM.VectorLength=function(vector){var x=vector.x;var y=vector.y;var z=vector.z;return Math.sqrt(x*x+y*y+z*z);};JSM.VectorNormalize=function(vector){var length=JSM.VectorLength(vector);var result=new JSM.Coord(0,0,0);if(JSM.IsGreater(length,0)){result=JSM.VectorMultiply(vector,1/length);}return result;};JSM.VectorSetLength=function(vector,length){var ratio=length/JSM.VectorLength(vector);var result=JSM.VectorMultiply(vector,ratio);return result;};JSM.GetVectorsAngle=function(a,b){var aDirection=JSM.VectorNormalize(a);var bDirection=JSM.VectorNormalize(b);if(JSM.CoordIsEqual(aDirection,bDirection)){return 0;}var product=JSM.VectorDot(aDirection,bDirection);return JSM.ArcCos(product);};JSM.GetVectorsFullAngle=function(referenceVector,currentVector,normal){var angle=JSM.GetVectorsAngle(referenceVector,currentVector);var origo=new JSM.Coord(0,0,0);if(JSM.CoordTurnType(currentVector,origo,referenceVector,normal)=="Clockwise"){angle=2*Math.PI-angle;}return angle;};JSM.VectorsAreCollinear=function(a,b){var angle=JSM.GetVectorsAngle(a,b);return JSM.IsEqual(angle,0)||JSM.IsEqual(angle,Math.PI);};JSM.CoordAdd=function(a,b){return new JSM.Vector(a.x+b.x,a.y+b.y,a.z+b.z);};JSM.CoordSub=function(a,b){return new JSM.Vector(a.x-b.x,a.y-b.y,a.z-b.z);};JSM.CoordOffset=function(coord,direction,distance){var normal=JSM.VectorNormalize(direction);var result=new JSM.Coord();result.x=coord.x+normal.x*distance;result.y=coord.y+normal.y*distance;result.z=coord.z+normal.z*distance;return result;};JSM.CoordRotate=function(coord,axis,angle,origo){var offseted=JSM.CoordSub(coord,origo);var normal=JSM.VectorNormalize(axis);var u=normal.x;var v=normal.y;var w=normal.z;var x=offseted.x;var y=offseted.y;var z=offseted.z;var result=new JSM.Coord();result.x=-u*(-u*x-v*y-w*z)*(1-Math.cos(angle))+x*Math.cos(angle)+(-w*y+v*z)*Math.sin(angle);result.y=-v*(-u*x-v*y-w*z)*(1-Math.cos(angle))+y*Math.cos(angle)+(w*x-u*z)*Math.sin(angle);result.z=-w*(-u*x-v*y-w*z)*(1-Math.cos(angle))+z*Math.cos(angle)+(-v*x+u*y)*Math.sin(angle);result=JSM.CoordAdd(result,origo);return result;};JSM.CoordTurnType2D=function(a,b,c){var m00=a.x;var m01=a.y;var m02=1;var m10=b.x;var m11=b.y;var m12=1;var m20=c.x;var m21=c.y;var m22=1;var determinant=JSM.MatrixDeterminant3x3(m00,m01,m02,m10,m11,m12,m20,m21,m22);if(JSM.IsPositive(determinant)){return"CounterClockwise";}else{if(JSM.IsNegative(determinant)){return"Clockwise";}else{return"Collinear";}}};JSM.PolarToCartesian=function(radius,theta){var result=new JSM.Coord2D();result.x=radius*Math.cos(theta);result.y=radius*Math.sin(theta);return result;};JSM.CoordTurnType=function(a,b,c,normal){var origo=new JSM.Coord(0,0,0);var a2=JSM.GetCoord2DFromCoord(a,origo,normal);var b2=JSM.GetCoord2DFromCoord(b,origo,normal);var c2=JSM.GetCoord2DFromCoord(c,origo,normal);var turnType=JSM.CoordTurnType2D(a2,b2,c2);var zNormal=new JSM.Vector(0,0,1);var angle=JSM.GetVectorsAngle(normal,zNormal);if(JSM.IsEqual(angle,Math.PI)){if(turnType==="CounterClockwise"){turnType="Clockwise";}else{if(turnType==="Clockwise"){turnType="CounterClockwise";}}}return turnType;};JSM.CalculateNormal=function(coords){var count=coords.length;var normal=new JSM.Vector(0,0,0);if(count>=3){for(var i=0;i<count;i++){var currentIndex=i%count;var nextIndex=(i+1)%count;var current=coords[currentIndex];var next=coords[nextIndex];normal.x+=(current.y-next.y)*(current.z+next.z);normal.y+=(current.z-next.z)*(current.x+next.x);normal.z+=(current.x-next.x)*(current.y+next.y);}}var normalized=JSM.VectorNormalize(normal);return normalized;};JSM.SphericalToCartesian=function(radius,theta,phi){var result=new JSM.Coord();result.x=radius*Math.sin(phi)*Math.cos(theta);result.y=radius*Math.sin(phi)*Math.sin(theta);result.z=radius*Math.cos(phi);return result;};JSM.CylindricalToCartesian=function(radius,theta,height){var result=new JSM.Coord();result.x=radius*Math.cos(theta);result.y=radius*Math.sin(theta);result.z=height;return result;};JSM.GetCoord2DFromCoord=function(coord,origo,normal){var zNormal=new JSM.Vector(0,0,1);var axis=JSM.VectorCross(normal,zNormal);var angle=JSM.GetVectorsAngle(normal,zNormal);var rotated=JSM.CoordRotate(coord,axis,angle,origo);return new JSM.Coord2D(rotated.x,rotated.y);};JSM.GetArcLength=function(a,b,radius){var angle=JSM.GetVectorsAngle(a,b);return angle*radius;};JSM.GetFullArcLength=function(referenceVector,currentVector,radius,normal){var angle=JSM.GetVectorsFullAngle(referenceVector,currentVector,normal);return angle*radius;};JSM.CoordSystem=function(origo,e1,e2,e3){this.origo=origo||new JSM.Coord();this.e1=e1||new JSM.Coord();this.e2=e2||new JSM.Coord();this.e3=e3||new JSM.Coord();};JSM.CoordSystem.prototype={Set:function(origo,e1,e2,e3){this.origo=origo||new JSM.Coord();this.e1=e1||new JSM.Coord();this.e2=e2||new JSM.Coord();this.e3=e3||new JSM.Coord();}};JSM.CoordSystemToDirectionVectors=function(system){return new JSM.CoordSystem(system.origo,JSM.CoordSub(system.e1,system.origo),JSM.CoordSub(system.e2,system.origo),JSM.CoordSub(system.e3,system.origo));};JSM.CoordSystemToAbsoluteCoords=function(system){return new JSM.CoordSystem(system.origo,JSM.CoordAdd(system.e1,system.origo),JSM.CoordAdd(system.e2,system.origo),JSM.CoordAdd(system.e3,system.origo));};JSM.ChangeCoordSystem=function(coord,from,to){var fromE1=JSM.VectorNormalize(from.e1);var fromE2=JSM.VectorNormalize(from.e2);var fromE3=JSM.VectorNormalize(from.e3);var toE1=JSM.VectorNormalize(to.e1);var toE2=JSM.VectorNormalize(to.e2);var toE3=JSM.VectorNormalize(to.e3);var offseted=JSM.CoordSub(coord,from.origo);var result=new JSM.Coord();result.x=JSM.VectorDot(toE1,fromE1)*offseted.x+JSM.VectorDot(toE1,fromE2)*offseted.y+JSM.VectorDot(toE1,fromE3)*offseted.z;result.y=JSM.VectorDot(toE2,fromE1)*offseted.x+JSM.VectorDot(toE2,fromE2)*offseted.y+JSM.VectorDot(toE2,fromE3)*offseted.z;result.z=JSM.VectorDot(toE3,fromE1)*offseted.x+JSM.VectorDot(toE3,fromE2)*offseted.y+JSM.VectorDot(toE3,fromE3)*offseted.z;result=JSM.CoordAdd(result,to.origo);return result;};JSM.Sector2D=function(beg,end){this.beg=beg||new JSM.Coord2D();this.end=end||new JSM.Coord2D();};JSM.Sector2D.prototype={Set:function(beg,end){this.beg=beg||new JSM.Coord2D();this.end=end||new JSM.Coord2D();}};JSM.Sector=function(beg,end){this.beg=beg||new JSM.Coord();this.end=end||new JSM.Coord();};JSM.Sector.prototype={Set:function(beg,end){this.beg=beg||0;this.end=end||0;}};JSM.CoordSectorPosition2D=function(coord,sector){var x=coord.x;var y=coord.y;var x1=sector.beg.x;var y1=sector.beg.y;var x2=sector.end.x;var y2=sector.end.y;var length=Math.pow(x2-x1,2)+Math.pow(y2-y1,2);if(JSM.IsZero(length)){if(JSM.CoordIsEqual2D(coord,sector.beg)){return"CoordOnSectorEndCoord";}return"CoordOutsideOfSector";}var u=((x-x1)*(x2-x1)+(y-y1)*(y2-y1))/length;if(JSM.IsLower(u,0)||JSM.IsGreater(u,1)){return"CoordOutsideOfSector";}var ux=x1+u*(x2-x1);var uy=y1+u*(y2-y1);if(!JSM.IsEqual(ux,x)||!JSM.IsEqual(uy,y)){return"CoordOutsideOfSector";}if(JSM.IsEqual(u,0)||JSM.IsEqual(u,1)){return"CoordOnSectorEndCoord";}return"CoordInsideOfSector";};JSM.SectorSectorPosition2D=function(aSector,bSector,intersection){var x1=aSector.beg.x;var y1=aSector.beg.y;var x2=aSector.end.x;var y2=aSector.end.y;var x3=bSector.beg.x;var y3=bSector.beg.y;var x4=bSector.end.x;var y4=bSector.end.y;var ux=(x4-x3)*(y1-y3)-(y4-y3)*(x1-x3);var uy=(x2-x1)*(y1-y3)-(y2-y1)*(x1-x3);if(JSM.IsZero(ux)&&JSM.IsZero(uy)){var aBeg=JSM.CoordSectorPosition2D(aSector.beg,bSector);var aEnd=JSM.CoordSectorPosition2D(aSector.end,bSector);var bBeg=JSM.CoordSectorPosition2D(bSector.beg,aSector);var bEnd=JSM.CoordSectorPosition2D(bSector.end,aSector);if(aBeg==="CoordInsideOfSector"||aEnd==="CoordInsideOfSector"||bBeg==="CoordInsideOfSector"||bEnd==="CoordInsideOfSector"){return"SectorsIntersectsCoincident";}else{if(aBeg==="CoordOnSectorEndCoord"&&aEnd==="CoordOnSectorEndCoord"&&bBeg==="CoordOnSectorEndCoord"&&bEnd==="CoordOnSectorEndCoord"){return"SectorsIntersectsCoincident";}else{if(aBeg==="CoordOnSectorEndCoord"||aEnd==="CoordOnSectorEndCoord"||bBeg==="CoordOnSectorEndCoord"||bEnd==="CoordOnSectorEndCoord"){if(intersection!==undefined){if(aBeg==="CoordOnSectorEndCoord"){intersection=aSector.beg;}else{if(aEnd==="CoordOnSectorEndCoord"){intersection=aSector.end;}else{if(bBeg==="CoordOnSectorEndCoord"){intersection=bSector.beg;}else{if(bEnd==="CoordOnSectorEndCoord"){intersection=bSector.end;}}}}}return"SectorsIntersectsEndPoint";}}}return"SectorsDontIntersects";}var denom=(y4-y3)*(x2-x1)-(x4-x3)*(y2-y1);if(JSM.IsZero(denom)){return"SectorsDontIntersects";}ux/=denom;uy/=denom;if(JSM.IsLower(ux,0)||JSM.IsGreater(ux,1)||JSM.IsLower(uy,0)||JSM.IsGreater(uy,1)){return"SectorsDontIntersects";}if(intersection!==undefined){intersection.x=x1+ux*(x2-x1);intersection.y=y1+ux*(y2-y1);}if(JSM.IsEqual(ux,0)||JSM.IsEqual(ux,1)||JSM.IsEqual(uy,0)||JSM.IsEqual(uy,1)){return"SectorsIntersectsEndPoint";}return"SectorsIntersectsOnePoint";};JSM.Line2D=function(start,direction){this.start=start||new JSM.Coord2D();this.direction=direction||new JSM.Vector2D();};JSM.Line2D.prototype={Set:function(start,direction){this.start=beg||new JSM.Coord2D();this.direction=end||new JSM.Vector2D();}};JSM.Line=function(start,direction){this.start=start||new JSM.Coord();this.direction=direction||new JSM.Vector();};JSM.Line.prototype={Set:function(start,direction){this.start=beg||new JSM.Coord();this.direction=end||new JSM.Vector();}};JSM.CoordLinePosition2D=function(coord,line){var x=coord.x;var y=coord.y;var a=line.start;var b=line.direction;var position=b.x*(y-a.y)-b.y*(x-a.x);if(JSM.IsPositive(position)){return"CoordAtLineLeft";}else{if(JSM.IsNegative(position)){return"CoordAtLineRight";}}return"CoordOnLine";};JSM.CoordLinePosition=function(coord,line,projected){var x=coord.x;var y=coord.y;var z=coord.z;var a=line.start;var b=line.direction;var x1=a.x;var y1=a.y;var z1=a.z;var x2=a.x+b.x;var y2=a.y+b.y;var z2=a.z+b.z;var denom=(x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)+(z2-z1)*(z2-z1);if(JSM.IsZero(denom)){if(projected!==undefined){projected.Set(a.x,a.y,a.z);}if(JSM.CoordIsEqual(a,coord)){return"CoordOnLine";}return"CoordOutsideOfLine";}var u=((x2-x1)*(x-x1)+(y2-y1)*(y-y1)+(z2-z1)*(z-z1))/denom;var c=JSM.CoordAdd(a,JSM.VectorMultiply(b,u));if(projected!==undefined){projected.Set(c.x,c.y,c.z);}var distance=JSM.CoordDistance(coord,c);if(JSM.IsZero(distance)){return"CoordOnLine";}return"CoordOutsideOfLine";};JSM.ProjectCoordToLine=function(coord,line){var result=new JSM.Coord();var x=coord.x;var y=coord.y;var z=coord.z;var a=line.start;var b=line.direction;var x1=a.x;var y1=a.y;var z1=a.z;var x2=a.x+b.x;var y2=a.y+b.y;var z2=a.z+b.z;var denom=(x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)+(z2-z1)*(z2-z1);if(JSM.IsZero(denom)){result.Set(a.x,a.y,a.z);return result;}var u=((x2-x1)*(x-x1)+(y2-y1)*(y-y1)+(z2-z1)*(z-z1))/denom;var c=JSM.CoordAdd(a,JSM.VectorMultiply(b,u));result.Set(c.x,c.y,c.z);return result;};JSM.Transformation=function(){this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0];};JSM.Transformation.prototype={Append:function(source){this.matrix=[source.matrix[0]*this.matrix[0]+source.matrix[1]*this.matrix[4]+source.matrix[2]*this.matrix[8],source.matrix[0]*this.matrix[1]+source.matrix[1]*this.matrix[5]+source.matrix[2]*this.matrix[9],source.matrix[0]*this.matrix[2]+source.matrix[1]*this.matrix[6]+source.matrix[2]*this.matrix[10],source.matrix[0]*this.matrix[3]+source.matrix[1]*this.matrix[7]+source.matrix[2]*this.matrix[11]+source.matrix[3],source.matrix[4]*this.matrix[0]+source.matrix[5]*this.matrix[4]+source.matrix[6]*this.matrix[8],source.matrix[4]*this.matrix[1]+source.matrix[5]*this.matrix[5]+source.matrix[6]*this.matrix[9],source.matrix[4]*this.matrix[2]+source.matrix[5]*this.matrix[6]+source.matrix[6]*this.matrix[10],source.matrix[4]*this.matrix[3]+source.matrix[5]*this.matrix[7]+source.matrix[6]*this.matrix[11]+source.matrix[7],source.matrix[8]*this.matrix[0]+source.matrix[9]*this.matrix[4]+source.matrix[10]*this.matrix[8],source.matrix[8]*this.matrix[1]+source.matrix[9]*this.matrix[5]+source.matrix[10]*this.matrix[9],source.matrix[8]*this.matrix[2]+source.matrix[9]*this.matrix[6]+source.matrix[10]*this.matrix[10],source.matrix[8]*this.matrix[3]+source.matrix[9]*this.matrix[7]+source.matrix[10]*this.matrix[11]+source.matrix[11]];},Apply:function(coord){var result=new JSM.Coord();result.x=this.matrix[0]*coord.x+this.matrix[1]*coord.y+this.matrix[2]*coord.z+this.matrix[3];result.y=this.matrix[4]*coord.x+this.matrix[5]*coord.y+this.matrix[6]*coord.z+this.matrix[7];result.z=this.matrix[8]*coord.x+this.matrix[9]*coord.y+this.matrix[10]*coord.z+this.matrix[11];return result;}};JSM.IdentityTransformation=function(){var transformation=new JSM.Transformation();transformation.matrix=[1,0,0,0,0,1,0,0,0,0,1,0];return transformation;};JSM.AdditionTransformation=function(offset){var transformation=new JSM.Transformation();transformation.matrix=[1,0,0,offset.x,0,1,0,offset.y,0,0,1,offset.z];return transformation;};JSM.TranslationTransformation=function(direction,distance){var normal=JSM.VectorNormalize(direction);var offset=JSM.VectorMultiply(normal,distance);return JSM.AdditionTransformation(offset);};JSM.RotationTransformation=function(axis,angle,origo){var transformation=new JSM.Transformation();var normal=JSM.VectorNormalize(axis);var u=normal.x;var v=normal.y;var w=normal.z;var u2=u*u;var v2=v*v;var w2=w*w;var si=Math.sin(angle);var co=Math.cos(angle);if(origo===undefined){transformation.matrix=[u2+(v2+w2)*co,u*v*(1-co)-w*si,u*w*(1-co)+v*si,0,u*v*(1-co)+w*si,v2+(u2+w2)*co,v*w*(1-co)-u*si,0,u*w*(1-co)-v*si,v*w*(1-co)+u*si,w2+(u2+v2)*co,0];}else{var a=origo.x;var b=origo.y;var c=origo.z;transformation.matrix=[u2+(v2+w2)*co,u*v*(1-co)-w*si,u*w*(1-co)+v*si,(a*(v2+w2)-u*(b*v+c*w))*(1-co)+(b*w-c*v)*si,u*v*(1-co)+w*si,v2+(u2+w2)*co,v*w*(1-co)-u*si,(b*(u2+w2)-v*(a*u+c*w))*(1-co)+(c*u-a*w)*si,u*w*(1-co)-v*si,v*w*(1-co)+u*si,w2+(u2+v2)*co,(c*(u2+v2)-w*(a*u+b*v))*(1-co)+(a*v-b*u)*si];}return transformation;};JSM.RotationXTransformation=function(angle){var transformation=new JSM.Transformation();var si=Math.sin(angle);var co=Math.cos(angle);transformation.matrix=[1,0,0,0,0,co,-si,0,0,si,co,0];return transformation;};JSM.RotationYTransformation=function(angle){var transformation=new JSM.Transformation();var si=Math.sin(angle);var co=Math.cos(angle);transformation.matrix=[co,0,si,0,0,1,0,0,-si,0,co,0];return transformation;};JSM.RotationZTransformation=function(angle){var transformation=new JSM.Transformation();var si=Math.sin(angle);var co=Math.cos(angle);transformation.matrix=[co,-si,0,0,si,co,0,0,0,0,1,0];return transformation;};JSM.SystemConversionTransformation=function(fromE1,fromE2,fromE3,toE1,toE2,toE3){var transformation=new JSM.Transformation();transformation.matrix=[JSM.VectorDot(toE1,fromE1),JSM.VectorDot(toE1,fromE2),JSM.VectorDot(toE1,fromE3),0,JSM.VectorDot(toE2,fromE1),JSM.VectorDot(toE2,fromE2),JSM.VectorDot(toE2,fromE3),0,JSM.VectorDot(toE3,fromE1),JSM.VectorDot(toE3,fromE2),JSM.VectorDot(toE3,fromE3),0];return transformation;};JSM.Polygon2D=function(source){if(source===undefined){this.vertices=[];}else{if(source instanceof JSM.Polygon2D){this.vertices=source.vertices;}else{if(source instanceof Array){this.vertices=source;}}}};JSM.Polygon2D.prototype={AddVertex:function(x,y){this.vertices.push(new JSM.Coord2D(x,y));},GetVertex:function(index){return this.vertices[index];},SetVertex:function(index,x,y){this.vertices[index].Set(x,y);},Count:function(){return this.vertices.length;},Clone:function(source){if(source instanceof JSM.Polygon2D){this.vertices=source.vertices.slice(0);}else{if(source instanceof Array){this.vertices=source.slice(0);}}},Clear:function(){this.vertices=[];}};JSM.Polygon=function(source){if(source===undefined){this.vertices=[];}else{if(source instanceof JSM.Polygon){this.vertices=source.vertices;}else{if(source instanceof Array){this.vertices=source;}}}};JSM.Polygon.prototype={AddVertex:function(x,y,z){this.vertices.push(new JSM.Coord(x,y,z));},GetVertex:function(index){return this.vertices[index];},SetVertex:function(index,x,y,z){this.vertices[index].Set(x,y,z);},Count:function(){return this.vertices.length;},Clone:function(source){if(source instanceof JSM.Polygon){this.vertices=source.vertices.slice(0);}else{if(source instanceof Array){this.vertices=source.slice(0);}}},Clear:function(){this.vertices=[];}};JSM.PolygonSignedArea2D=function(polygon){var count=polygon.Count();var area=0;var i,current,next;for(i=0;i<count;i++){current=polygon.GetVertex(i);next=polygon.GetVertex((i+1)%count);area+=current.x*next.y-next.x*current.y;}area/=2;return area;};JSM.PolygonArea2D=function(polygon){return Math.abs(JSM.PolygonSignedArea2D(polygon));};JSM.PolygonOrientation2D=function(polygon){var signedArea=JSM.PolygonSignedArea2D(polygon);if(JSM.IsPositive(signedArea)){return"CounterClockwise";}else{if(JSM.IsNegative(signedArea)){return"ClockWise";}}return"Invalid";};JSM.PolygonComplexity2D=function(polygon){var hasCounterClockwiseVertex=false;var hasClockWiseVertex=false;var count=polygon.Count();var i,prevIndex,currIndex,nextIndex;var prev,curr,next,turnType;for(i=0;i<count;i++){prevIndex=(i===0?count-1:i-1);currIndex=i;nextIndex=(i===count-1?0:i+1);prev=polygon.GetVertex(prevIndex);curr=polygon.GetVertex(currIndex);next=polygon.GetVertex(nextIndex);turnType=JSM.CoordTurnType2D(prev,curr,next);if(turnType==="CounterClockwise"){hasCounterClockwiseVertex=true;}else{if(turnType==="Clockwise"){hasClockWiseVertex=true;}}if(hasCounterClockwiseVertex&&hasClockWiseVertex){return"Concave";}}if(!hasCounterClockwiseVertex&&!hasClockWiseVertex){return"Invalid";}return"Convex";};JSM.CoordPolygonPosition2D=function(coord,polygon){var count=polygon.Count();var i,current,next,sector;for(i=0;i<count;i++){current=polygon.GetVertex(i);next=polygon.GetVertex((i+1)%count);sector=new JSM.Sector2D(current,next);if(JSM.CoordSectorPosition2D(coord,sector)!=="CoordOutsideOfSector"){return"CoordOnPolygonEdge";}}var maxHorizontalDistance=0;var currentDistance;for(i=0;i<count;i++){currentDistance=Math.abs(polygon.GetVertex(i).x-coord.x);if(JSM.IsGreater(currentDistance,maxHorizontalDistance)){maxHorizontalDistance=currentDistance;}}var ray=new JSM.Sector2D(coord,new JSM.Coord2D(coord.x+2*maxHorizontalDistance,coord.y));var intersections=0;var intersection,ssp;for(i=0;i<count;i++){current=polygon.GetVertex(i);next=polygon.GetVertex((i+1)%count);sector=new JSM.Sector2D(current,next);intersection=new JSM.Coord2D();ssp=JSM.SectorSectorPosition2D(ray,sector,intersection);if(ssp==="SectorsDontIntersects"){continue;}if(ssp==="SectorsIntersectsOnePoint"){intersections++;}else{if(ssp==="SectorsIntersectsEndPoint"){if(JSM.CoordIsEqual2D(intersection,sector.beg)){if(JSM.IsGreater(sector.beg.y,sector.end.y)){intersections++;}}else{if(JSM.CoordIsEqual2D(intersection,sector.end)){if(JSM.IsLower(sector.beg.y,sector.end.y)){intersections++;}}}}}}if(intersections%2===0){return"CoordOutsideOfPolygon";}return"CoordInsideOfPolygon";};JSM.IsPolygonVertexVisible2D=function(polygon,from,to){if(from===to){return false;}var count=polygon.Count();var prev=(from>0?from-1:count-1);var next=(from<count-1?from+1:0);if(to===prev||to===next){return false;}var endPointIntersectionCount=0;var diagonalSector=new JSM.Sector2D(polygon.GetVertex(from),polygon.GetVertex(to));var i,currentSector,position;for(i=0;i<count;i++){if(i===prev||i===from){continue;}currentSector=new JSM.Sector2D(polygon.GetVertex(i),polygon.GetVertex((i+1)%count));position=JSM.SectorSectorPosition2D(diagonalSector,currentSector);if(position==="SectorsIntersectsOnePoint"||position==="SectorsIntersectsCoincident"){return false;}else{if(position==="SectorsIntersectsEndPoint"){endPointIntersectionCount++;if(endPointIntersectionCount>2){return false;}}}}var midCoord=JSM.MidCoord2D(diagonalSector.beg,diagonalSector.end);if(JSM.CoordPolygonPosition2D(midCoord,polygon)==="CoordOutsideOfPolygon"){return false;}return true;};JSM.PolygonTriangulate2D=function(polygon){var Increase=function(value,count){if(value<count-1){return value+1;}else{return 0;}};var Decrease=function(value,count){if(value>0){return value-1;}else{return count-1;}};var GetResult=function(){var result=[];var i,j,resultPolygon,resultTriangle;for(i=0;i<resultPolygons.length;i++){resultPolygon=resultPolygons[i];if(resultPolygon.length!==3){continue;}if(orientation==="CounterClockwise"){result.push(resultPolygon);}else{resultTriangle=[];for(j=resultPolygon.length-1;j>=0;j--){resultTriangle.push(count-resultPolygon[j]-1);}result.push(resultTriangle);}}return result;};var IsVisibleVertex=function(currentPolygon2D,vertex1,vertex2){if(vertex1===vertex2){return false;}var currentVertexCount=currentPolygon2D.Count();if(Increase(vertex1,currentVertexCount)===vertex2||Decrease(vertex1,currentVertexCount)===vertex2){return false;}return JSM.IsPolygonVertexVisible2D(currentPolygon2D,vertex1,vertex2);};var SplitPolygon=function(currentPolygon,vertex1,vertex2){var currentVertexCount=currentPolygon.length;if(currentVertexCount<=3){return true;}var i,j,start,end,resultPolygon;for(i=0;i<2;i++){start=-1;end=-1;if(i===0){start=vertex1;end=vertex2;}else{if(i===1){start=vertex2;end=vertex1;}}resultPolygon=[];resultPolygon.push(currentPolygon[end]);for(j=start;j!==end;j=Increase(j,currentVertexCount)){resultPolygon.push(currentPolygon[j]);}resultPolygons.push(resultPolygon);}return true;};var poly=new JSM.Polygon2D();poly.Clone(polygon);poly.Clone(polygon.vertices);var count=poly.Count();if(count<3){return[];}var resultPolygons=[];var firstPolygon=[];var i,j,k;for(i=0;i<count;i++){firstPolygon.push(i);}resultPolygons.push(firstPolygon);if(count===3){return GetResult();}var complexity=JSM.PolygonComplexity2D(poly);var orientation=JSM.PolygonOrientation2D(poly);if(complexity==="Invalid"||orientation==="Invalid"){return[];}if(orientation!=="CounterClockwise"){var i1,i2,tmp;for(i=0;i<count/2;i++){i1=i;i2=count-i-1;tmp=poly.vertices[i1];poly.vertices[i1]=poly.vertices[i2];poly.vertices[i2]=tmp;}}if(complexity==="Convex"){var triangle;for(i=0;i<count-2;i++){triangle=[];triangle.push(0);triangle.push((i+1)%count);triangle.push((i+2)%count);resultPolygons.push(triangle);}return GetResult();}var currentPolygon,currentVertexCount,currentPolygon2D,createdNewPolygons,vertex;for(i=0;i<resultPolygons.length;i++){currentPolygon=resultPolygons[i];currentVertexCount=currentPolygon.length;if(currentVertexCount===3){continue;}currentPolygon2D=new JSM.Polygon2D();for(j=0;j<currentVertexCount;j++){vertex=poly.GetVertex(currentPolygon[j]);currentPolygon2D.AddVertex(vertex.x,vertex.y);}createdNewPolygons=false;for(j=0;j<currentVertexCount;j++){for(k=0;k<currentVertexCount;k++){if(IsVisibleVertex(currentPolygon2D,j,k)){SplitPolygon(currentPolygon,j,k);createdNewPolygons=true;break;}}if(createdNewPolygons){break;}}}return GetResult();};JSM.CheckTriangulation2D=function(polygon,triangles){var polygonArea=JSM.PolygonSignedArea2D(polygon);var trianglesArea=0;var i,j,triangle,currentTriangle,vertex;for(i=0;i<triangles.length;i++){triangle=triangles[i];if(triangle.length!==3){return false;}currentTriangle=new JSM.Polygon2D();for(j=0;j<triangle.length;j++){vertex=polygon.GetVertex(triangle[j]);currentTriangle.AddVertex(vertex.x,vertex.y);}trianglesArea+=JSM.PolygonSignedArea2D(currentTriangle);}if(!JSM.IsEqual(polygonArea,trianglesArea)){return false;}return true;};JSM.PolygonTriangulate=function(polygon){var polygon2D=new JSM.Polygon2D();var normal=JSM.CalculateNormal(polygon.vertices);var origo=new JSM.Coord(0,0,0);var vertexCount=polygon.Count();var i,vertex;for(i=0;i<vertexCount;i++){vertex=JSM.GetCoord2DFromCoord(polygon.GetVertex(i),origo,normal);polygon2D.AddVertex(vertex.x,vertex.y);}return JSM.PolygonTriangulate2D(polygon2D);};JSM.Plane=function(a,b,c,d){this.a=a||0;this.b=b||0;this.c=c||0;this.d=d||0;};JSM.Plane.prototype={Set:function(a,b,c,d){this.a=a||0;this.b=b||0;this.c=c||0;this.d=d||0;},SetFromCoordAndDirection:function(coord,direction){var normal=JSM.VectorNormalize(direction);this.a=normal.x;this.b=normal.y;this.c=normal.z;this.d=-(this.a*coord.x+this.b*coord.y+this.c*coord.z);}};JSM.CoordPlanePosition=function(coord,plane){var a=plane.a;var b=plane.b;var c=plane.c;var d=plane.d;var x=coord.x;var y=coord.y;var z=coord.z;var s=a*x+b*y+c*z+d;if(JSM.IsPositive(s)){return"CoordInFrontOfPlane";}else{if(JSM.IsNegative(s)){return"CoordAtBackOfPlane";}}return"CoordOnPlane";};JSM.LinePlanePosition=function(line,plane,intersection){var direction=JSM.VectorNormalize(line.direction);var x1=line.start.x;var y1=line.start.y;var z1=line.start.z;var x2=line.start.x+direction.x;var y2=line.start.y+direction.y;var z2=line.start.z+direction.z;var a=plane.a;var b=plane.b;var c=plane.c;var d=plane.d;var denom=(a*(x1-x2)+b*(y1-y2)+c*(z1-z2));if(JSM.IsZero(denom)){return"LineParallelToPlane";}var u=(a*x1+b*y1+c*z1+d)/denom;if(intersection!==undefined){var i=JSM.CoordAdd(line.start,JSM.VectorMultiply(direction,u));intersection.Set(i.x,i.y,i.z);}return"LineIntersectsPlane";};JSM.LinePlaneIntersection=function(line,plane){var direction=JSM.VectorNormalize(line.direction);var x1=line.start.x;var y1=line.start.y;var z1=line.start.z;var x2=line.start.x+direction.x;var y2=line.start.y+direction.y;var z2=line.start.z+direction.z;var a=plane.a;var b=plane.b;var c=plane.c;var d=plane.d;var result=new JSM.Coord(0,0,0);var denom=(a*(x1-x2)+b*(y1-y2)+c*(z1-z2));if(JSM.IsZero(denom)){return result;}var u=(a*x1+b*y1+c*z1+d)/denom;result=JSM.CoordAdd(line.start,JSM.VectorMultiply(direction,u));return result;};JSM.CoordPlaneSignedDistance=function(coord,plane){var x=coord.x;var y=coord.y;var z=coord.z;var a=plane.a;var b=plane.b;var c=plane.c;var d=plane.d;var distance=(a*x+b*y+c*z+d)/Math.sqrt(a*a+b*b+c*c);return distance;};JSM.CoordPlaneDistance=function(coord,plane){return Math.abs(JSM.CoordPlaneSignedDistance(coord,plane));};JSM.CoordPlaneSignedDirectionalDistance=function(coord,direction,plane){var normal=JSM.VectorNormalize(direction);var x1=coord.x;var y1=coord.y;var z1=coord.z;var x2=coord.x+normal.x;var y2=coord.y+normal.y;var z2=coord.z+normal.z;var a=plane.a;var b=plane.b;var c=plane.c;var d=plane.d;var denom=(a*(x1-x2)+b*(y1-y2)+c*(z1-z2));if(JSM.IsZero(denom)){return 0;}var u=(a*x1+b*y1+c*z1+d)/denom;var intersection=JSM.CoordAdd(coord,JSM.VectorMultiply(normal,u));var distance=JSM.CoordDistance(coord,intersection);var s=a*x1+b*y1+c*z1+d;if(JSM.IsNegative(s)){distance=-distance;}return distance;};JSM.CoordPlaneDirectionalDistance=function(coord,direction,plane){return Math.abs(JSM.CoordPlaneSignedDirectionalDistance(coord,direction,plane));};JSM.ProjectCoordToPlane=function(coord,plane){var x=coord.x;var y=coord.y;var z=coord.z;var a=plane.a;var b=plane.b;var c=plane.c;var d=plane.d;var distance=JSM.CoordPlaneDistance(coord,plane);var side=a*x+b*y+c*z+d;if(JSM.IsGreater(side,0)){distance=-distance;}var normal=JSM.VectorNormalize(new JSM.Coord(a,b,c));var result=JSM.CoordOffset(coord,normal,distance);return result;};JSM.CalculateModelViewMatrix=function(eye,center,up){var d=JSM.VectorNormalize(JSM.CoordSub(center,eye));var c=JSM.VectorNormalize(JSM.VectorCross(d,up));var u=JSM.VectorNormalize(JSM.VectorCross(c,d));var result=[];result[0]=c.x;result[1]=u.x;result[2]=-d.x;result[3]=0;result[4]=c.y;result[5]=u.y;result[6]=-d.y;result[7]=0;result[8]=c.z;result[9]=u.z;result[10]=-d.z;result[11]=0;result[12]=-(c.x*eye.x+c.y*eye.y+c.z*eye.z);result[13]=-(u.x*eye.x+u.y*eye.y+u.z*eye.z);result[14]=(d.x*eye.x+d.y*eye.y+d.z*eye.z);result[15]=1;return result;};JSM.CalculateProjectionMatrix=function(fieldOfView,aspectRatio,nearPlane,farPlane){var e=1/Math.tan(fieldOfView/2);var a=1/aspectRatio;var n=nearPlane;var f=farPlane;var result=[];result[0]=e;result[1]=0;result[2]=0;result[3]=0;result[4]=0;result[5]=e/a;result[6]=0;result[7]=0;result[8]=0;result[9]=0;result[10]=-((f+n)/(f-n));result[11]=-1;result[12]=0;result[13]=0;result[14]=-((2*f*n)/(f-n));result[15]=0;return result;};JSM.ProjectWithMatrices=function(coord,modelView,projection,viewPort){var result=new JSM.Coord();var input=[];var output=[];input[0]=coord.x;input[1]=coord.y;input[2]=coord.z;input[3]=1;output=JSM.VectorMatrixMultiply4x4(JSM.VectorMatrixMultiply4x4(input,modelView),projection);var denom=output[3];if(JSM.IsZero(denom)){return result;}output[0]=output[0]/denom*0.5+0.5;output[1]=output[1]/denom*0.5+0.5;output[2]=output[2]/denom*0.5+0.5;output[0]=output[0]*viewPort[2]+viewPort[0];output[1]=output[1]*viewPort[3]+viewPort[1];result.x=output[0];result.y=output[1];result.z=output[2];return result;};JSM.Project=function(coord,eye,center,up,fieldOfView,aspectRatio,nearPlane,farPlane,viewPort){var modelView=JSM.CalculateModelViewMatrix(eye,center,up);var projection=JSM.CalculateProjectionMatrix(fieldOfView,aspectRatio,nearPlane,farPlane);return JSM.ProjectWithMatrices(coord,modelView,projection,viewPort);};JSM.BodyVertex=function(position){this.position=position||new JSM.Coord();};JSM.BodyPolygon=function(vertices){this.vertices=vertices||[];this.material=-1;this.curved=-1;};JSM.Body=function(){this.vertices=[];this.polygons=[];this.projection=null;this.coords=null;};JSM.BodyVertex.prototype={GetPosition:function(){return this.position;},SetPosition:function(position){this.position=position;}};JSM.BodyPolygon.prototype={AddVertexIndex:function(index){this.vertices.push(index);},GetVertexIndex:function(index){return this.vertices[index];},VertexIndexCount:function(){return this.vertices.length;},HasMaterialIndex:function(){return this.material!==-1;},GetMaterialIndex:function(){return this.material;},SetMaterialIndex:function(material){this.material=material;},HasCurveGroup:function(){return this.curved!==-1;},GetCurveGroup:function(){return this.curved;},SetCurveGroup:function(group){this.curved=group;},InheritAttributes:function(source){this.material=source.material;this.curved=source.curved;}};JSM.Body.prototype={AddVertex:function(vertex){this.vertices.push(vertex);return this.vertices.length-1;},AddPolygon:function(polygon){this.polygons.push(polygon);return this.polygons.length-1;},GetVertex:function(index){return this.vertices[index];},GetVertexPosition:function(index){return this.vertices[index].position;},GetPolygon:function(index){return this.polygons[index];},VertexCount:function(){return this.vertices.length;},PolygonCount:function(){return this.polygons.length;},SetVertexPosition:function(index,position){this.vertices[index].position=position;},SetPolygonsMaterialIndex:function(material){var i;for(i=0;i<this.polygons.length;i++){this.polygons[i].SetMaterialIndex(material);}},SetPolygonsCurveGroup:function(group){var i;for(i=0;i<this.polygons.length;i++){this.polygons[i].SetCurveGroup(group);}},GetTextureProjectionType:function(){return this.projection;},SetTextureProjectionType:function(projection){this.projection=projection;},GetTextureProjectionCoords:function(){return this.coords;},SetTextureProjectionCoords:function(coords){this.coords=coords;},Transform:function(transformation){var i;for(i=0;i<this.vertices.length;i++){this.vertices[i].position=transformation.Apply(this.vertices[i].position);}if(this.coords!==null){var absoluteSystem=JSM.CoordSystemToAbsoluteCoords(this.coords);absoluteSystem.origo=transformation.Apply(absoluteSystem.origo);absoluteSystem.e1=transformation.Apply(absoluteSystem.e1);absoluteSystem.e2=transformation.Apply(absoluteSystem.e2);absoluteSystem.e3=transformation.Apply(absoluteSystem.e3);this.coords=JSM.CoordSystemToDirectionVectors(absoluteSystem);}},GetCenter:function(){var boundingBox=this.GetBoundingBox();return JSM.MidCoord(boundingBox[0],boundingBox[1]);},GetBoundingBox:function(){var min=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf);var max=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf);var i,coord;for(i=0;i<this.vertices.length;i++){coord=this.vertices[i].position;min.x=JSM.Minimum(min.x,coord.x);min.y=JSM.Minimum(min.y,coord.y);min.z=JSM.Minimum(min.z,coord.z);max.x=JSM.Maximum(max.x,coord.x);max.y=JSM.Maximum(max.y,coord.y);max.z=JSM.Maximum(max.z,coord.z);}return[min,max];},GetBoundingSphereRadius:function(){var center=this.GetCenter();var radius=0;var i,current;for(i=0;i<this.vertices.length;i++){current=JSM.CoordDistance(center,this.vertices[i].position);if(JSM.IsGreater(current,radius)){radius=current;}}return radius;},OffsetToOrigo:function(){var center=this.GetCenter();center=JSM.VectorMultiply(center,-1);var i;for(i=0;i<this.vertices.length;i++){this.vertices[i].position=JSM.CoordAdd(this.vertices[i].position,center);}},Clear:function(){this.vertices=[];this.polygons=[];this.projection=null;this.coords=null;}};JSM.AddVertexToBody=function(body,x,y,z){body.AddVertex(new JSM.BodyVertex(new JSM.Coord(x,y,z)));};JSM.AddPolygonToBody=function(body,vertices){body.AddPolygon(new JSM.BodyPolygon(vertices));};JSM.CalculateBodyVertexToPolygon=function(body){var result=[];var i,j;for(i=0;i<body.VertexCount();i++){result[i]=[];}var polygon;for(i=0;i<body.PolygonCount();i++){polygon=body.GetPolygon(i);for(j=0;j<polygon.VertexIndexCount();j++){result[polygon.GetVertexIndex(j)].push(i);}}return result;};JSM.CalculateBodyPolygonNormal=function(body,index){var polygon=body.GetPolygon(index);var count=polygon.VertexIndexCount();var normal=new JSM.Vector(0,0,0);if(count>=3){var i,currentIndex,nextIndex,current,next;for(i=0;i<count;i++){currentIndex=i;nextIndex=(i+1)%count;current=body.GetVertexPosition(polygon.GetVertexIndex(currentIndex));next=body.GetVertexPosition(polygon.GetVertexIndex(nextIndex));normal.x+=(current.y-next.y)*(current.z+next.z);normal.y+=(current.z-next.z)*(current.x+next.x);normal.z+=(current.x-next.x)*(current.y+next.y);}}var normalized=JSM.VectorNormalize(normal);return normalized;};JSM.CalculateBodyPolygonNormals=function(body){var result=[];var i;for(i=0;i<body.PolygonCount();i++){result.push(JSM.CalculateBodyPolygonNormal(body,i));}return result;};JSM.CalculateBodyVertexNormals=function(body){var result=[];var polygonNormals=JSM.CalculateBodyPolygonNormals(body);var vertexToPolygon=JSM.CalculateBodyVertexToPolygon(body);var i,j,k,polygon,normal;var average,count,neighbourPolygons,neighbourPolygon;for(i=0;i<body.PolygonCount();i++){polygon=body.GetPolygon(i);result[i]=[];if(polygon.HasCurveGroup()){for(j=0;j<polygon.VertexIndexCount();j++){average=new JSM.Vector(0,0,0);count=0;neighbourPolygons=vertexToPolygon[polygon.GetVertexIndex(j)];for(k=0;k<neighbourPolygons.length;k++){neighbourPolygon=body.GetPolygon(neighbourPolygons[k]);if(neighbourPolygon.GetCurveGroup()===polygon.GetCurveGroup()){average=JSM.CoordAdd(average,polygonNormals[neighbourPolygons[k]]);count++;}}average=JSM.VectorMultiply(average,1/count);average=JSM.VectorNormalize(average);result[i].push(average);}}else{normal=polygonNormals[i];for(j=0;j<polygon.VertexIndexCount();j++){result[i].push(new JSM.Vector(normal.x,normal.y,normal.z));}}}return result;};JSM.CutPolygonByPlane=function(polygon,plane,indexTable){var AddOriginalVertex=function(index){rawResult.push(new JSM.Coord(vertex.x,vertex.y,vertex.z));rawIndexTable.push(index);};var AddIntersectionVertex=function(from,to){direction=JSM.VectorNormalize(JSM.CoordSub(polygon[to],polygon[from]));line=new JSM.Line(polygon[from],direction);intersection=JSM.LinePlaneIntersection(line,plane);rawResult.push(new JSM.Coord(intersection.x,intersection.y,intersection.z));rawIndexTable.push(-1);};var hasIndexTable=(indexTable!==undefined&&indexTable!==null);var count=polygon.length;var result=[];var front=[];var needCut=false;var i,position,vertex;for(i=0;i<count;i++){vertex=polygon[i];position=JSM.CoordPlanePosition(vertex,plane);front.push(position!=="CoordAtBackOfPlane");if(i>0&&front[i-1]!==front[i]){needCut=true;}}if(!needCut){if(front[0]===false){return result;}for(i=0;i<count;i++){vertex=polygon[i];result.push(new JSM.Coord(vertex.x,vertex.y,vertex.z));if(hasIndexTable){indexTable.push(i);}}return result;}var rawResult=[];var rawIndexTable=[];var from,to;var direction,line,intersection;for(i=0;i<count;i++){from=i-1;to=i;if(i===0){from=count-1;}vertex=polygon[to];if(front[to]){if(!front[from]){AddIntersectionVertex(from,to);}AddOriginalVertex(to);}else{if(front[from]){AddIntersectionVertex(from,to);}}}var currentVertex;var currentIndex;var lastVertex;var lastIndex;for(i=0;i<rawResult.length;i++){var currentVertex=rawResult[i];var lastVertex=result[result.length-1];if(i==0||!JSM.CoordIsEqual(lastVertex,currentVertex)){result.push(new JSM.Coord(currentVertex.x,currentVertex.y,currentVertex.z));if(hasIndexTable){currentIndex=rawIndexTable[i];indexTable.push(currentIndex);}}else{if(hasIndexTable){currentIndex=rawIndexTable[i];lastIndex=rawIndexTable[i-1];if(currentIndex!==-1){indexTable[indexTable.length-1]=currentIndex;}else{if(lastIndex!==-1){indexTable[indexTable.length-1]=lastIndex;}}}}}return result;};JSM.CutBodyByPlane=function(body,plane){var GetInsertedVertexIndex=function(vertex){var index=-1;var i;for(i=originalVertexCount;i<result.VertexCount();i++){if(JSM.CoordIsEqual(result.GetVertexPosition(i),vertex)){index=i;break;}}if(index===-1){index=result.AddVertex(new JSM.BodyVertex(new JSM.Coord(vertex.x,vertex.y,vertex.z)));}return index;};var result=new JSM.Body();var cuttedPolygons=[];var cuttedIndexTables=[];var remainsVertex=[];var originalOldToNewIndex=[];var i,j,polygon,polygon3D,vertexPosition;var cuttedPolygon,indexTable;for(i=0;i<body.PolygonCount();i++){polygon=body.GetPolygon(i);polygon3D=[];for(j=0;j<polygon.VertexIndexCount();j++){vertexPosition=body.GetVertexPosition(polygon.GetVertexIndex(j));polygon3D.push(new JSM.Coord(vertexPosition.x,vertexPosition.y,vertexPosition.z));}indexTable=[];cuttedPolygon=JSM.CutPolygonByPlane(polygon3D,plane,indexTable);for(j=0;j<indexTable.length;j++){if(indexTable[j]!==-1){remainsVertex[polygon.GetVertexIndex(indexTable[j])]=true;}}cuttedPolygons.push(cuttedPolygon);cuttedIndexTables.push(indexTable);}var vertex;for(i=0;i<body.VertexCount();i++){if(remainsVertex[i]){vertex=body.GetVertexPosition(i);originalOldToNewIndex[i]=result.AddVertex(new JSM.BodyVertex(new JSM.Coord(vertex.x,vertex.y,vertex.z)));}}var originalVertexCount=result.VertexCount();var newPolygon,newPolygonVertices;for(i=0;i<body.PolygonCount();i++){polygon=body.GetPolygon(i);cuttedPolygon=cuttedPolygons[i];indexTable=cuttedIndexTables[i];if(indexTable.length==0){continue;}newPolygonVertices=[];for(j=0;j<indexTable.length;j++){if(indexTable[j]!==-1){newPolygonVertices.push(originalOldToNewIndex[polygon.GetVertexIndex(indexTable[j])]);}else{vertex=cuttedPolygon[j];newPolygonVertices.push(GetInsertedVertexIndex(vertex));}}newPolygon=new JSM.BodyPolygon(newPolygonVertices);newPolygon.InheritAttributes(polygon);result.AddPolygon(newPolygon);}return result;};JSM.CalculatePlanarTextureCoord=function(coord,system){var result=new JSM.Coord2D();var e1=JSM.VectorNormalize(system.e1);var e2=JSM.VectorNormalize(system.e2);var e3=JSM.VectorNormalize(system.e3);var xyPlane=new JSM.Plane();var xzPlane=new JSM.Plane();var yzPlane=new JSM.Plane();xyPlane.SetFromCoordAndDirection(system.origo,e3);xzPlane.SetFromCoordAndDirection(system.origo,e2);yzPlane.SetFromCoordAndDirection(system.origo,e1);var projected=JSM.ProjectCoordToPlane(coord,xyPlane);result.x=JSM.CoordPlaneSignedDistance(projected,xzPlane);result.y=JSM.CoordPlaneSignedDistance(projected,yzPlane);return result;};JSM.CalculatePolygonPlanarTextureCoords=function(body,index){var result=[];var polygon=body.GetPolygon(index);var system=body.GetTextureProjectionCoords();var i,coord;for(i=0;i<polygon.VertexIndexCount();i++){coord=body.GetVertexPosition(polygon.GetVertexIndex(i));result.push(JSM.CalculatePlanarTextureCoord(coord,system));}return result;};JSM.CalculateCubicTextureCoord=function(coord,normal,system){var result=new JSM.Coord2D();var e1=JSM.VectorNormalize(system.e1);var e2=JSM.VectorNormalize(system.e2);var e3=JSM.VectorNormalize(system.e3);var correctPlane=-1;var maxProduct=0;var i,currentDirection,product;for(i=0;i<3;i++){if(i===0){currentDirection=e1;}else{if(i===1){currentDirection=e2;}else{if(i===2){currentDirection=e3;}}}product=Math.abs(JSM.VectorDot(normal,currentDirection));if(JSM.IsGreater(product,maxProduct)){correctPlane=i;maxProduct=product;}}if(correctPlane===-1){return result;}var planeSystem=null;if(correctPlane===0){planeSystem=new JSM.CoordSystem(system.origo,e3,e2,JSM.VectorMultiply(e1,-1));}else{if(correctPlane===1){planeSystem=new JSM.CoordSystem(system.origo,e3,e1,e2);}else{if(correctPlane===2){planeSystem=new JSM.CoordSystem(system.origo,e2,e1,JSM.VectorMultiply(e3,-1));}}}if(planeSystem===null){return result;}return JSM.CalculatePlanarTextureCoord(coord,planeSystem);};JSM.CalculatePolygonCubicTextureCoords=function(body,index,normal){var result=[];var polygon=body.GetPolygon(index);var system=body.GetTextureProjectionCoords();var i,coord;for(i=0;i<polygon.VertexIndexCount();i++){coord=body.GetVertexPosition(polygon.GetVertexIndex(i));result.push(JSM.CalculateCubicTextureCoord(coord,normal,system));}return result;};JSM.CalculateCylindricalTextureCoord=function(coord,normal,system){var result=new JSM.Coord2D();var e3Direction=JSM.VectorNormalize(system.e3);if(JSM.VectorsAreCollinear(e3Direction,normal)){result=JSM.CalculateCubicTextureCoord(coord,normal,system);return[result,0];}var baseLine=new JSM.Line(system.origo,e3Direction);var projectedCoord=JSM.ProjectCoordToLine(coord,baseLine);var projectedDistance=JSM.CoordSignedDistance(system.origo,projectedCoord,system.e3);var e1Direction=JSM.VectorNormalize(system.e1);var coordDirection=JSM.CoordSub(coord,projectedCoord);var angle=JSM.GetVectorsFullAngle(e1Direction,coordDirection,e3Direction);var radius=JSM.VectorLength(system.e1);result.x=angle*radius;result.y=projectedDistance;return[result,angle];};JSM.CalculatePolygonCylindricalTextureCoords=function(body,index,normal){var result=[];var angles=[];var polygon=body.GetPolygon(index);var system=body.GetTextureProjectionCoords();var angle=0;var i,j,coord,textureValues;for(i=0;i<polygon.VertexIndexCount();i++){coord=body.GetVertexPosition(polygon.GetVertexIndex(i));textureValues=JSM.CalculateCylindricalTextureCoord(coord,normal,system);result.push(textureValues[0]);angles.push(textureValues[1]);}var e3Direction=JSM.VectorNormalize(system.e3);if(JSM.VectorsAreCollinear(e3Direction,normal)){return result;}var needRepair=false;for(i=0;i<angles.length;i++){for(j=i+1;j<angles.length;j++){if(JSM.IsGreater(Math.abs(angles[i]-angles[j]),Math.PI)){needRepair=true;break;}}if(needRepair){break;}}if(needRepair){var radius=JSM.VectorLength(system.e1);for(i=0;i<angles.length;i++){if(JSM.IsLower(angles[i],Math.PI)){result[i].x=radius*(angles[i]+2*Math.PI);}}}return result;};JSM.CalculatePolygonTextureCoords=function(body,polygonNormals,index){var result=[];var projection=body.GetTextureProjectionType();var system=body.GetTextureProjectionCoords();var polygon=body.GetPolygon(index);var normal=polygonNormals[index];if(projection==="Planar"){result=JSM.CalculatePolygonPlanarTextureCoords(body,index);}else{if(projection==="Cubic"){result=JSM.CalculatePolygonCubicTextureCoords(body,index,normal);}else{if(projection==="Cylindrical"){result=JSM.CalculatePolygonCylindricalTextureCoords(body,index,normal);}}}return result;};JSM.CalculateBodyTextureCoords=function(body){var result=[];var system=body.GetTextureProjectionCoords();var polygonNormals=JSM.CalculateBodyPolygonNormals(body);var i,j,polygon,coord;for(i=0;i<body.PolygonCount();i++){result[i]=JSM.CalculatePolygonTextureCoords(body,polygonNormals,i);}return result;};JSM.Model=function(){this.bodies=[];};JSM.Model.prototype={AddBody:function(body){this.bodies.push(body);return this.bodies.length-1;},GetBody:function(index){return this.bodies[index];},BodyCount:function(){return this.bodies.length;}};JSM.Material=function(ambient,diffuse,opacity,texture,textureWidth,textureHeight){this.ambient=ambient||13369344;this.diffuse=diffuse||13369344;this.opacity=opacity||1;this.texture=texture||null;this.textureWidth=textureWidth||1;this.textureHeight=textureHeight||1;};JSM.Material.prototype={};JSM.Materials=function(){this.materials=[];};JSM.Materials.prototype={AddMaterial:function(material){this.materials.push(material);},GetMaterial:function(index){return this.materials[index];},Count:function(){return this.materials.length;}};JSM.GenerateCuboid=function(xSize,ySize,zSize){var result=new JSM.Body();var x=xSize/2;var y=ySize/2;var z=zSize/2;result.AddVertex(new JSM.BodyVertex(new JSM.Coord(-x,-y,-z)));result.AddVertex(new JSM.BodyVertex(new JSM.Coord(x,-y,-z)));result.AddVertex(new JSM.BodyVertex(new JSM.Coord(x,-y,z)));result.AddVertex(new JSM.BodyVertex(new JSM.Coord(-x,-y,z)));result.AddVertex(new JSM.BodyVertex(new JSM.Coord(-x,y,-z)));result.AddVertex(new JSM.BodyVertex(new JSM.Coord(x,y,-z)));result.AddVertex(new JSM.BodyVertex(new JSM.Coord(x,y,z)));result.AddVertex(new JSM.BodyVertex(new JSM.Coord(-x,y,z)));result.AddPolygon(new JSM.BodyPolygon([0,1,2,3]));result.AddPolygon(new JSM.BodyPolygon([1,5,6,2]));result.AddPolygon(new JSM.BodyPolygon([5,4,7,6]));result.AddPolygon(new JSM.BodyPolygon([4,0,3,7]));result.AddPolygon(new JSM.BodyPolygon([0,4,5,1]));result.AddPolygon(new JSM.BodyPolygon([3,2,6,7]));result.SetTextureProjectionType("Cubic");result.SetTextureProjectionCoords(new JSM.CoordSystem(new JSM.Coord(-x,-y,-z),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1)));return result;};JSM.GenerateSphere=function(radius,segmentation,isCurved){var result=new JSM.Body();var segments=segmentation;var circle=segments*2;var topIndex=result.AddVertex(new JSM.BodyVertex(JSM.SphericalToCartesian(radius,0,0)));var step=Math.PI/segments;var phi=step;var i,j,theta;for(i=1;i<segments;i++){theta=0;for(j=0;j<circle;j++){result.AddVertex(new JSM.BodyVertex(JSM.SphericalToCartesian(radius,theta,phi)));theta+=step;}phi+=step;}var bottomIndex=result.AddVertex(new JSM.BodyVertex(JSM.SphericalToCartesian(-radius,0,0)));var offset,current,next,top,ntop,polygon;for(i=1;i<=segments;i++){if(i===1){offset=1;for(j=0;j<circle;j++){current=offset+j;next=current+1;if(j===circle-1){next=offset;}polygon=new JSM.BodyPolygon([current,next,topIndex]);if(isCurved){polygon.SetCurveGroup(0);}result.AddPolygon(polygon);}}else{if(i<segments){offset=(i-1)*circle+1;for(j=0;j<circle;j++){current=offset+j;next=current+1;top=current-circle;ntop=top+1;if(j===circle-1){next=offset;ntop=offset-circle;}polygon=new JSM.BodyPolygon([current,next,ntop,top]);if(isCurved){polygon.SetCurveGroup(0);}result.AddPolygon(polygon);}}else{if(i===segments){offset=(i-2)*circle+1;for(j=0;j<circle;j++){current=offset+j;next=current+1;if(j===circle-1){next=offset;}polygon=new JSM.BodyPolygon([current,bottomIndex,next]);if(isCurved){polygon.SetCurveGroup(0);}result.AddPolygon(polygon);}}}}}result.SetTextureProjectionType("Cubic");result.SetTextureProjectionCoords(new JSM.CoordSystem(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1)));return result;};JSM.GenerateCylinder=function(radius,height,segmentation,withTopAndBottom,isCurved){var result=new JSM.Body();var segments=segmentation;var theta=2*Math.PI;var step=2*Math.PI/segments;var i;for(i=0;i<segments;i++){result.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(radius,theta,height/2)));result.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(radius,theta,-height/2)));theta-=step;}var current,next,polygon;for(i=0;i<segments;i++){current=2*i;next=current+2;if(i===segments-1){next=0;}polygon=new JSM.BodyPolygon([current,next,next+1,current+1]);if(isCurved){polygon.SetCurveGroup(0);}result.AddPolygon(polygon);}if(withTopAndBottom){var topPolygon=new JSM.BodyPolygon();var bottomPolygon=new JSM.BodyPolygon();for(i=0;i<segments;i++){topPolygon.AddVertexIndex(2*(segments-i-1));bottomPolygon.AddVertexIndex(2*i+1);}result.AddPolygon(topPolygon);result.AddPolygon(bottomPolygon);}result.SetTextureProjectionType("Cylindrical");result.SetTextureProjectionCoords(new JSM.CoordSystem(new JSM.Coord(0,0,-(height/2)),new JSM.Coord(radius,0,0),new JSM.Coord(0,radius,0),new JSM.Coord(0,0,1)));return result;};JSM.GenerateCone=function(topRadius,bottomRadius,height,segmentation,withTopAndBottom,isCurved){var result=new JSM.Body();var segments=segmentation;var topDegenerated=(JSM.IsZero(topRadius));var bottomDegenerated=(JSM.IsZero(bottomRadius));var theta=2*Math.PI;var step=2*Math.PI/segments;if(topDegenerated){result.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(0,0,height/2)));}var i;for(i=0;i<segments;i++){if(!topDegenerated){result.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(topRadius,theta,height/2)));}if(!bottomDegenerated){result.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(bottomRadius,theta,-height/2)));}theta-=step;}if(bottomDegenerated){result.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(0,0,-height/2)));}var current,next,polygon;for(i=0;i<segments;i++){if(topDegenerated){current=i+1;next=current+1;if(i===segments-1){next=1;}polygon=new JSM.BodyPolygon([0,next,current]);if(isCurved){polygon.SetCurveGroup(0);}result.AddPolygon(polygon);}else{if(bottomDegenerated){current=i;next=current+1;if(i===segments-1){next=0;}polygon=new JSM.BodyPolygon([current,next,segments]);if(isCurved){polygon.SetCurveGroup(0);}result.AddPolygon(polygon);}else{current=2*i;next=current+2;if(i===segments-1){next=0;}polygon=new JSM.BodyPolygon([current,next,next+1,current+1]);if(isCurved){polygon.SetCurveGroup(0);}result.AddPolygon(polygon);}}}var topPolygon,bottomPolygon;if(withTopAndBottom){if(topDegenerated){bottomPolygon=new JSM.BodyPolygon();for(i=0;i<segments;i++){bottomPolygon.AddVertexIndex(i+1);}result.AddPolygon(bottomPolygon);}else{if(bottomDegenerated){topPolygon=new JSM.BodyPolygon();for(i=0;i<segments;i++){topPolygon.AddVertexIndex(segments-i-1);}result.AddPolygon(topPolygon);}else{topPolygon=new JSM.BodyPolygon();bottomPolygon=new JSM.BodyPolygon();for(i=0;i<segments;i++){topPolygon.AddVertexIndex(2*(segments-i-1));bottomPolygon.AddVertexIndex(2*i+1);}result.AddPolygon(topPolygon);result.AddPolygon(bottomPolygon);}}}var avgRadius=(topRadius+bottomRadius)/2;result.SetTextureProjectionType("Cylindrical");result.SetTextureProjectionCoords(new JSM.CoordSystem(new JSM.Coord(0,0,-(height/2)),new JSM.Coord(avgRadius,0,0),new JSM.Coord(0,avgRadius,0),new JSM.Coord(0,0,1)));return result;};JSM.GeneratePrism=function(basePolygon,direction,height,withTopAndBottom){var result=new JSM.Body();var count=basePolygon.length;var i;for(i=0;i<count;i++){result.AddVertex(new JSM.BodyVertex(basePolygon[i]));result.AddVertex(new JSM.BodyVertex(JSM.CoordOffset(basePolygon[i],direction,height)));}var current,next;for(i=0;i<count;i++){current=2*i;next=current+2;if(i===count-1){next=0;}result.AddPolygon(new JSM.BodyPolygon([current,next,next+1,current+1]));}if(withTopAndBottom){var topPolygon=new JSM.BodyPolygon();var bottomPolygon=new JSM.BodyPolygon();for(i=0;i<count;i++){topPolygon.AddVertexIndex(2*i+1);bottomPolygon.AddVertexIndex(2*(count-i-1));}result.AddPolygon(topPolygon);result.AddPolygon(bottomPolygon);}var firstDirection=JSM.VectorNormalize(JSM.CoordSub(basePolygon[1],basePolygon[0]));var origo=new JSM.Coord(basePolygon[0].x,basePolygon[0].y,basePolygon[0].z);var e3=JSM.VectorNormalize(direction);var e2=JSM.VectorCross(e3,firstDirection);var e1=JSM.VectorCross(e2,e3);result.SetTextureProjectionType("Cubic");result.SetTextureProjectionCoords(new JSM.CoordSystem(origo,e1,e2,e3));return result;};JSM.GeneratePrismShell=function(basePolygon,direction,height,width,withTopAndBottom){var result=new JSM.Body();var count=basePolygon.length;var angles=[];var i,prev,curr,next;var prevDir,nextDir,angle;for(i=0;i<count;i++){prev=(i===0?count-1:i-1);curr=i;next=(i===count-1?0:i+1);nextDir=JSM.CoordSub(basePolygon[next],basePolygon[curr]);prevDir=JSM.CoordSub(basePolygon[prev],basePolygon[curr]);angle=JSM.GetVectorsAngle(nextDir,prevDir)/2;if(JSM.CoordTurnType(basePolygon[prev],basePolygon[curr],basePolygon[next],direction)==="Clockwise"){angle=Math.PI-angle;}angles.push(angle);}var innerBasePolygon=[];var distance,innerCoord,offsetDirection;for(i=0;i<count;i++){curr=i;next=(i+1)%count;angle=angles[curr];distance=width/Math.sin(angle);offsetDirection=JSM.CoordSub(basePolygon[curr],basePolygon[next]);innerCoord=JSM.CoordOffset(basePolygon[curr],offsetDirection,distance);innerCoord=JSM.CoordRotate(innerCoord,direction,-(Math.PI-angle),basePolygon[curr]);innerBasePolygon.push(innerCoord);}for(i=0;i<count;i++){result.AddVertex(new JSM.BodyVertex(basePolygon[i]));}for(i=0;i<count;i++){result.AddVertex(new JSM.BodyVertex(innerBasePolygon[i]));}var offseted;for(i=0;i<count;i++){offseted=JSM.CoordOffset(basePolygon[i],direction,height);result.AddVertex(new JSM.BodyVertex(offseted));}for(i=0;i<count;i++){offseted=JSM.CoordOffset(innerBasePolygon[i],direction,height);result.AddVertex(new JSM.BodyVertex(offseted));}var top,ntop;for(i=0;i<count;i++){curr=i;next=curr+1;top=curr+2*count;ntop=top+1;if(i===count-1){next=0;ntop=2*count;}result.AddPolygon(new JSM.BodyPolygon([curr,next,ntop,top]));result.AddPolygon(new JSM.BodyPolygon([curr+count,top+count,ntop+count,next+count]));}if(withTopAndBottom){for(i=0;i<count;i++){curr=i;next=curr+1;top=i+count;ntop=top+1;if(i===count-1){next=0;ntop=count;}result.AddPolygon(new JSM.BodyPolygon([curr,top,ntop,next]));result.AddPolygon(new JSM.BodyPolygon([curr+2*count,next+2*count,ntop+2*count,top+2*count]));}}var firstDirection=JSM.VectorNormalize(JSM.CoordSub(basePolygon[1],basePolygon[0]));var origo=new JSM.Coord(basePolygon[0].x,basePolygon[0].y,basePolygon[0].z);var e3=JSM.VectorNormalize(direction);var e2=JSM.VectorCross(e3,firstDirection);var e1=JSM.VectorCross(e2,e3);result.SetTextureProjectionType("Cubic");result.SetTextureProjectionCoords(new JSM.CoordSystem(origo,e1,e2,e3));return result;};JSM.GenerateLineShell=function(basePolyLine,direction,height,width,withStartAndEnd,withTopAndBottom){var result=new JSM.Body();var count=basePolyLine.length;var angles=[];var i,prev,curr,next;var prevDir,nextDir,angle;for(i=0;i<count;i++){if(i===0||i===count-1){angle=Math.PI/2;}else{prev=i-1;curr=i;next=i+1;nextDir=JSM.CoordSub(basePolyLine[next],basePolyLine[curr]);prevDir=JSM.CoordSub(basePolyLine[prev],basePolyLine[curr]);angle=JSM.GetVectorsAngle(nextDir,prevDir)/2;if(JSM.CoordTurnType(basePolyLine[prev],basePolyLine[curr],basePolyLine[next],direction)==="Clockwise"){angle=Math.PI-angle;}}angles.push(angle);}var innerBasePolyLine=[];var distance,innerCoord,offsetDirection;for(i=0;i<count;i++){curr=i;if(i===count-1){offsetDirection=JSM.CoordSub(basePolyLine[curr-1],basePolyLine[curr]);}else{next=(i+1)%count;offsetDirection=JSM.CoordSub(basePolyLine[curr],basePolyLine[next]);}angle=angles[curr];distance=width/Math.sin(angle);innerCoord=JSM.CoordOffset(basePolyLine[curr],offsetDirection,distance);innerCoord=JSM.CoordRotate(innerCoord,direction,-(Math.PI-angle),basePolyLine[curr]);innerBasePolyLine.push(innerCoord);}for(i=0;i<count;i++){result.AddVertex(new JSM.BodyVertex(basePolyLine[i]));}for(i=0;i<count;i++){result.AddVertex(new JSM.BodyVertex(innerBasePolyLine[i]));}var offseted;for(i=0;i<count;i++){offseted=JSM.CoordOffset(basePolyLine[i],direction,height);result.AddVertex(new JSM.BodyVertex(offseted));}for(i=0;i<count;i++){offseted=JSM.CoordOffset(innerBasePolyLine[i],direction,height);result.AddVertex(new JSM.BodyVertex(offseted));}var top,ntop;for(i=0;i<count-1;i++){curr=i;next=curr+1;top=curr+2*count;ntop=top+1;result.AddPolygon(new JSM.BodyPolygon([curr,next,ntop,top]));result.AddPolygon(new JSM.BodyPolygon([curr+count,top+count,ntop+count,next+count]));}if(withStartAndEnd){curr=0;next=curr+count;top=curr+2*count;ntop=curr+3*count;result.AddPolygon(new JSM.BodyPolygon([curr,top,ntop,next]));curr=count-1;next=curr+count;top=curr+2*count;ntop=curr+3*count;result.AddPolygon(new JSM.BodyPolygon([curr,next,ntop,top]));}if(withTopAndBottom){for(i=0;i<count-1;i++){curr=i;next=curr+1;top=i+count;ntop=top+1;result.AddPolygon(new JSM.BodyPolygon([curr,top,ntop,next]));result.AddPolygon(new JSM.BodyPolygon([curr+2*count,next+2*count,ntop+2*count,top+2*count]));}}var firstDirection=JSM.VectorNormalize(JSM.CoordSub(basePolyLine[1],basePolyLine[0]));var origo=new JSM.Coord(basePolyLine[0].x,basePolyLine[0].y,basePolyLine[0].z);var e3=JSM.VectorNormalize(direction);var e2=JSM.VectorCross(e3,firstDirection);var e1=JSM.VectorCross(e2,e3);result.SetTextureProjectionType("Cubic");result.SetTextureProjectionCoords(new JSM.CoordSystem(origo,e1,e2,e3));return result;};JSM.GenerateTorus=function(outerRadius,innerRadius,outerSegmentation,innerSegmentation,isCurved){var result=new JSM.Body();var theta=2*Math.PI;var step=2*Math.PI/innerSegmentation;var circle=[];var i,coord2D,coord;for(i=0;i<innerSegmentation;i++){coord2D=JSM.PolarToCartesian(innerRadius,theta);coord=new JSM.Coord(coord2D.x+outerRadius,0,coord2D.y);circle.push(coord);theta-=step;}var axisDir=new JSM.Coord(0,0,1);var origo=new JSM.Coord(0,0,0);step=(2*Math.PI)/outerSegmentation;var j,rotated;for(i=0;i<outerSegmentation;i++){for(j=0;j<innerSegmentation;j++){rotated=JSM.CoordRotate(circle[j],axisDir,i*step,origo);result.AddVertex(new JSM.BodyVertex(rotated));}}var polygon,current,top,next,ntop,polygon;for(i=0;i<outerSegmentation;i++){polygon=new JSM.BodyPolygon();for(j=0;j<innerSegmentation;j++){current=i*innerSegmentation+j;next=current+innerSegmentation;top=current+1;ntop=next+1;if(j===innerSegmentation-1){top=(i*innerSegmentation);ntop=(i+1)*innerSegmentation;}if(i===outerSegmentation-1){next=j;ntop=j+1;if(j===innerSegmentation-1){ntop=0;}}polygon=new JSM.BodyPolygon([current,next,ntop,top]);if(isCurved){polygon.SetCurveGroup(0);}result.AddPolygon(polygon);}}result.SetTextureProjectionType("Cubic");result.SetTextureProjectionCoords(new JSM.CoordSystem(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1)));return result;};JSM.GeneratePolyTorus=function(basePolygon,outerRadius,outerSegmentation,isCurved){var result=new JSM.Body();var innerSegmentation=basePolygon.length;var theta=2*Math.PI;var step=2*Math.PI/innerSegmentation;var circle=[];var i,coord2D,coord;for(i=0;i<innerSegmentation;i++){coord2D=basePolygon[i];coord=new JSM.Coord(coord2D.x+outerRadius,0,coord2D.y);circle.push(coord);theta-=step;}var axisDir=new JSM.Coord(0,0,1);var origo=new JSM.Coord(0,0,0);step=(2*Math.PI)/outerSegmentation;var j,rotated;for(i=0;i<outerSegmentation;i++){for(j=0;j<innerSegmentation;j++){rotated=JSM.CoordRotate(circle[j],axisDir,i*step,origo);result.AddVertex(new JSM.BodyVertex(rotated));}}var polygon,current,top,next,ntop,polygon;for(i=0;i<outerSegmentation;i++){polygon=new JSM.BodyPolygon();for(j=0;j<innerSegmentation;j++){current=i*innerSegmentation+j;next=current+innerSegmentation;top=current+1;ntop=next+1;if(j===innerSegmentation-1){top=(i*innerSegmentation);ntop=(i+1)*innerSegmentation;}if(i===outerSegmentation-1){next=j;ntop=j+1;if(j===innerSegmentation-1){ntop=0;}}polygon=new JSM.BodyPolygon([current,next,ntop,top]);if(isCurved){polygon.SetCurveGroup(j);}result.AddPolygon(polygon);}}result.SetTextureProjectionType("Cubic");result.SetTextureProjectionCoords(new JSM.CoordSystem(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1)));return result;};JSM.GetLineSegmentation=function(begin,end,segmentation,coords){var direction=JSM.CoordSub(end,begin);var length=JSM.CoordDistance(begin,end);var step=length/segmentation;var distance=0;var i;for(i=0;i<=segmentation;i++){coords.push(JSM.CoordOffset(begin,direction,distance));distance+=step;}};JSM.GetRuledMesh=function(aCoords,bCoords,segmentation,vertices,polygons){if(aCoords.length!==bCoords.length){return;}var lineSegmentation=aCoords.length-1;var meshSegmentation=segmentation;var directions=[];var lengths=[];var i,j;for(i=0;i<=lineSegmentation;i++){directions.push(JSM.CoordSub(bCoords[i],aCoords[i]));lengths.push(JSM.CoordDistance(aCoords[i],bCoords[i]));}var step,coord;for(i=0;i<=lineSegmentation;i++){step=lengths[i]/meshSegmentation;for(j=0;j<=meshSegmentation;j++){coord=JSM.CoordOffset(aCoords[i],directions[i],step*j);vertices.push(coord);}}var current,top,next,ntop,polygon;for(i=0;i<lineSegmentation;i++){for(j=0;j<meshSegmentation;j++){current=i*(meshSegmentation+1)+j;top=current+meshSegmentation+1;next=current+1;ntop=top+1;polygon=[current,next,ntop,top];polygons.push(polygon);}}};JSM.GenerateRuledFromSectors=function(aSector,bSector,lineSegmentation,meshSegmentation,isCurved){var result=new JSM.Body();var aCoords=[];var bCoords=[];JSM.GetLineSegmentation(aSector.beg,aSector.end,lineSegmentation,aCoords);JSM.GetLineSegmentation(bSector.beg,bSector.end,lineSegmentation,bCoords);var vertices=[];var polygons=[];JSM.GetRuledMesh(aCoords,bCoords,meshSegmentation,vertices,polygons);var i;for(i=0;i<vertices.length;i++){result.AddVertex(new JSM.BodyVertex(vertices[i]));}var polygon;for(i=0;i<polygons.length;i++){vertexIndices=polygons[i];polygon=new JSM.BodyPolygon(vertexIndices);if(isCurved){polygon.SetCurveGroup(0);}result.AddPolygon(polygon);}result.SetTextureProjectionType("Cubic");result.SetTextureProjectionCoords(new JSM.CoordSystem(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1)));return result;};JSM.GenerateRuledFromSectorsWithHeight=function(aSector,bSector,lineSegmentation,meshSegmentation,isCurved,height){var result=new JSM.Body();var aCoords=[];var bCoords=[];JSM.GetLineSegmentation(aSector.beg,aSector.end,lineSegmentation,aCoords);JSM.GetLineSegmentation(bSector.beg,bSector.end,lineSegmentation,bCoords);var vertices=[];var polygons=[];JSM.GetRuledMesh(aCoords,bCoords,meshSegmentation,vertices,polygons);var i;for(i=0;i<vertices.length;i++){result.AddVertex(new JSM.BodyVertex(vertices[i]));}var polygon;for(i=0;i<polygons.length;i++){vertexIndices=polygons[i];polygon=new JSM.BodyPolygon(vertexIndices);if(isCurved){polygon.SetCurveGroup(0);}result.AddPolygon(polygon);}var topVertexCount=result.VertexCount();var newVertex;for(i=0;i<vertices.length;i++){vertex=vertices[i];newVertex=new JSM.Coord(vertex.x,vertex.y,vertex.z);newVertex.z-=height;result.AddVertex(new JSM.BodyVertex(newVertex));}var j,newVertexIndices;for(i=0;i<polygons.length;i++){vertexIndices=polygons[i];newVertexIndices=[];for(j=vertexIndices.length-1;j>=0;j--){newVertexIndices.push(vertexIndices[j]+topVertexCount);}polygon=new JSM.BodyPolygon(newVertexIndices);if(isCurved){polygon.SetCurveGroup(0);}result.AddPolygon(polygon);}var current,next,top,ntop;for(i=0;i<meshSegmentation;i++){current=i+topVertexCount;next=current+1;top=current-topVertexCount;ntop=top+1;polygon=new JSM.BodyPolygon([current,next,ntop,top]);result.AddPolygon(polygon);}for(i=0;i<meshSegmentation;i++){current=i+(lineSegmentation*(meshSegmentation+1))+topVertexCount;next=current+1;top=current-topVertexCount;ntop=top+1;polygon=new JSM.BodyPolygon([current,top,ntop,next]);result.AddPolygon(polygon);}for(i=0;i<lineSegmentation;i++){current=i*(meshSegmentation+1)+topVertexCount;next=current+meshSegmentation+1;top=current-topVertexCount;ntop=top+meshSegmentation+1;polygon=new JSM.BodyPolygon([current,top,ntop,next]);result.AddPolygon(polygon);}for(i=0;i<lineSegmentation;i++){current=(i+1)*meshSegmentation+i+topVertexCount;next=current+meshSegmentation+1;top=current-topVertexCount;ntop=top+meshSegmentation+1;polygon=new JSM.BodyPolygon([current,next,ntop,top]);result.AddPolygon(polygon);}result.SetTextureProjectionType("Cubic");result.SetTextureProjectionCoords(new JSM.CoordSystem(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1)));return result;};JSM.GenerateRuledFromCoords=function(aCoords,bCoords,meshSegmentation,isCurved){var result=new JSM.Body();if(aCoords.length!==bCoords.length){return;}var vertices=[];var polygons=[];JSM.GetRuledMesh(aCoords,bCoords,meshSegmentation,vertices,polygons);var i;for(i=0;i<vertices.length;i++){result.AddVertex(new JSM.BodyVertex(vertices[i]));}var polygon;for(i=0;i<polygons.length;i++){vertices=polygons[i];polygon=new JSM.BodyPolygon(vertices);if(isCurved){polygon.SetCurveGroup(0);}result.AddPolygon(polygon);}result.SetTextureProjectionType("Cubic");result.SetTextureProjectionCoords(new JSM.CoordSystem(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1)));return result;};JSM.GenerateRevolved=function(polyLine,axis,angle,segmentation,withTopAndBottom,isCurved){var result=new JSM.Body();var circular=JSM.IsEqual(angle,2*Math.PI);var count=polyLine.length;var step=angle/segmentation;var axisDir=JSM.CoordSub(axis.end,axis.beg);var i,j,rotated;for(i=0;i<count;i++){for(j=0;j<=segmentation;j++){if(circular&&j===segmentation){continue;}rotated=JSM.CoordRotate(polyLine[i],axisDir,j*step,axis.beg);result.AddVertex(new JSM.BodyVertex(rotated));}}var current,top,next,ntop,polygon;for(i=0;i<count-1;i++){for(j=0;j<segmentation;j++){current=i*(segmentation+1)+j;top=current+segmentation+1;next=current+1;ntop=top+1;if(circular){current=i*segmentation+j;top=current+segmentation;next=current+1;ntop=top+1;if(j===segmentation-1){next=i*segmentation;ntop=(i+1)*segmentation;}}polygon=new JSM.BodyPolygon([current,next,ntop,top]);if(isCurved){polygon.SetCurveGroup(i);}result.AddPolygon(polygon);}}if(circular&&withTopAndBottom){var topPolygon=new JSM.BodyPolygon();var bottomPolygon=new JSM.BodyPolygon();for(i=0;i<segmentation;i++){topPolygon.AddVertexIndex(segmentation*(count-1)+i);bottomPolygon.AddVertexIndex(segmentation-i-1);}result.AddPolygon(topPolygon);result.AddPolygon(bottomPolygon);}var axisLine=new JSM.Line(axis.beg,JSM.VectorNormalize(axisDir));var avgRadius=0;var projected;for(i=0;i<count;i++){projected=JSM.ProjectCoordToLine(polyLine[i],axisLine);avgRadius=avgRadius+JSM.CoordDistance(projected,polyLine[i]);}avgRadius=avgRadius/count;var origo=new JSM.Coord(axis.beg.x,axis.beg.y,axis.beg.z);var e3=JSM.VectorNormalize(axisDir);var baseLine=new JSM.Line(origo,axisDir);var projected=JSM.ProjectCoordToLine(polyLine[0],baseLine);var e1=JSM.VectorSetLength(JSM.CoordSub(polyLine[0],projected),avgRadius);var e2=JSM.VectorSetLength(JSM.VectorCross(e3,e1),avgRadius);result.SetTextureProjectionType("Cylindrical");result.SetTextureProjectionCoords(new JSM.CoordSystem(origo,e1,e2,e3));return result;};JSM.GenerateFunctionSurface=function(function3D,intervalMin,intervalMax,segmentation,isCurved){var aSector=new JSM.Sector(new JSM.Coord(intervalMax.x,intervalMin.y,0),new JSM.Coord(intervalMin.x,intervalMin.y,0));var bSector=new JSM.Sector(new JSM.Coord(intervalMax.x,intervalMax.y,0),new JSM.Coord(intervalMin.x,intervalMax.y,0));var result=JSM.GenerateRuledFromSectors(aSector,bSector,segmentation,segmentation,isCurved);var i,coord,functionValue;for(i=0;i<result.VertexCount();i++){coord=result.GetVertexPosition(i);coord.z=function3D(coord.x,coord.y);}result.SetTextureProjectionType("Cubic");result.SetTextureProjectionCoords(new JSM.CoordSystem(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1)));return result;};JSM.GenerateFunctionSurfaceSolid=function(function3D,intervalMin,intervalMax,segmentation,isCurved,bottomZ){var aSector=new JSM.Sector(new JSM.Coord(intervalMax.x,intervalMin.y,0),new JSM.Coord(intervalMin.x,intervalMin.y,0));var bSector=new JSM.Sector(new JSM.Coord(intervalMax.x,intervalMax.y,0),new JSM.Coord(intervalMin.x,intervalMax.y,0));var result=JSM.GenerateRuledFromSectorsWithHeight(aSector,bSector,segmentation,segmentation,isCurved,bottomZ);var i,coord,functionValue;var topVertexCount=(segmentation+1)*(segmentation+1);for(i=0;i<topVertexCount;i++){coord=result.GetVertexPosition(i);coord.z=function3D(coord.x,coord.y);}result.SetTextureProjectionType("Cubic");result.SetTextureProjectionCoords(new JSM.CoordSystem(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1)));return result;};JSM.GenerateSolidWithRadius=function(solidName,radius){var result=new JSM.Body();if(solidName==="Tetrahedron"){result=JSM.GenerateTetrahedron();}else{if(solidName==="Hexahedron"){result=JSM.GenerateHexahedron();}else{if(solidName==="Octahedron"){result=JSM.GenerateOctahedron();}else{if(solidName==="Dodecahedron"){result=JSM.GenerateDodecahedron();}else{if(solidName==="Icosahedron"){result=JSM.GenerateIcosahedron();}else{if(solidName==="TruncatedTetrahedron"){result=JSM.GenerateTruncatedTetrahedron();}else{if(solidName==="Cuboctahedron"){result=JSM.GenerateCuboctahedron();}else{if(solidName==="TruncatedCube"){result=JSM.GenerateTruncatedCube();}else{if(solidName==="TruncatedOctahedron"){result=JSM.GenerateTruncatedOctahedron();}else{if(solidName==="Rhombicuboctahedron"){result=JSM.GenerateRhombicuboctahedron();}else{if(solidName==="TruncatedCuboctahedron"){result=JSM.GenerateTruncatedCuboctahedron();}else{if(solidName==="SnubCube"){result=JSM.GenerateSnubCube();}else{if(solidName==="Icosidodecahedron"){result=JSM.GenerateIcosidodecahedron();}else{if(solidName==="TruncatedDodecahedron"){result=JSM.GenerateTruncatedDodecahedron();}else{if(solidName==="TruncatedIcosahedron"){result=JSM.GenerateTruncatedIcosahedron();}else{if(solidName==="Rhombicosidodecahedron"){result=JSM.GenerateRhombicosidodecahedron();}else{if(solidName==="TruncatedIcosidodecahedron"){result=JSM.GenerateTruncatedIcosidodecahedron();}else{if(solidName==="SnubDodecahedron"){result=JSM.GenerateSnubDodecahedron();}}}}}}}}}}}}}}}}}}if(result.VertexCount()>0){var currentRadius=JSM.VectorLength(result.GetVertexPosition(0));var scale=radius/currentRadius;var i,vertex;for(i=0;i<result.VertexCount();i++){vertex=result.GetVertex(i);vertex.SetPosition(JSM.VectorMultiply(vertex.GetPosition(),scale));}}return result;};JSM.GenerateTetrahedron=function(){var result=new JSM.Body();var a=1;result.AddVertex(new JSM.BodyVertex(new JSM.Coord(+a,+a,+a)));result.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,-a,+a)));result.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,+a,-a)));result.AddVertex(new JSM.BodyVertex(new JSM.Coord(+a,-a,-a)));result.AddPolygon(new JSM.BodyPolygon([0,1,3]));result.AddPolygon(new JSM.BodyPolygon([0,2,1]));result.AddPolygon(new JSM.BodyPolygon([0,3,2]));result.AddPolygon(new JSM.BodyPolygon([1,2,3]));return result;};JSM.GenerateHexahedron=function(){var result=new JSM.Body();var a=1;JSM.AddVertexToBody(result,+a,+a,+a);JSM.AddVertexToBody(result,+a,+a,-a);JSM.AddVertexToBody(result,+a,-a,+a);JSM.AddVertexToBody(result,-a,+a,+a);JSM.AddVertexToBody(result,+a,-a,-a);JSM.AddVertexToBody(result,-a,+a,-a);JSM.AddVertexToBody(result,-a,-a,+a);JSM.AddVertexToBody(result,-a,-a,-a);JSM.AddPolygonToBody(result,[0,1,5,3]);JSM.AddPolygonToBody(result,[0,2,4,1]);JSM.AddPolygonToBody(result,[0,3,6,2]);JSM.AddPolygonToBody(result,[1,4,7,5]);JSM.AddPolygonToBody(result,[2,6,7,4]);JSM.AddPolygonToBody(result,[3,5,7,6]);return result;};JSM.GenerateOctahedron=function(){var result=new JSM.Body();var a=1;var b=0;JSM.AddVertexToBody(result,+a,+b,+b);JSM.AddVertexToBody(result,-a,+b,+b);JSM.AddVertexToBody(result,+b,+a,+b);JSM.AddVertexToBody(result,+b,-a,+b);JSM.AddVertexToBody(result,+b,+b,+a);JSM.AddVertexToBody(result,+b,+b,-a);JSM.AddPolygonToBody(result,[0,2,4]);JSM.AddPolygonToBody(result,[0,3,5]);JSM.AddPolygonToBody(result,[0,4,3]);JSM.AddPolygonToBody(result,[0,5,2]);JSM.AddPolygonToBody(result,[1,2,5]);JSM.AddPolygonToBody(result,[1,3,4]);JSM.AddPolygonToBody(result,[1,4,2]);JSM.AddPolygonToBody(result,[1,5,3]);return result;};JSM.GenerateDodecahedron=function(){var result=new JSM.Body();var a=1;var b=0;var c=(1+Math.sqrt(5))/2;var d=1/c;JSM.AddVertexToBody(result,+a,+a,+a);JSM.AddVertexToBody(result,+a,+a,-a);JSM.AddVertexToBody(result,+a,-a,+a);JSM.AddVertexToBody(result,-a,+a,+a);JSM.AddVertexToBody(result,+a,-a,-a);JSM.AddVertexToBody(result,-a,+a,-a);JSM.AddVertexToBody(result,-a,-a,+a);JSM.AddVertexToBody(result,-a,-a,-a);JSM.AddVertexToBody(result,+b,+d,+c);JSM.AddVertexToBody(result,+b,+d,-c);JSM.AddVertexToBody(result,+b,-d,+c);JSM.AddVertexToBody(result,+b,-d,-c);JSM.AddVertexToBody(result,+d,+c,+b);JSM.AddVertexToBody(result,+d,-c,+b);JSM.AddVertexToBody(result,-d,+c,+b);JSM.AddVertexToBody(result,-d,-c,+b);JSM.AddVertexToBody(result,+c,+b,+d);JSM.AddVertexToBody(result,-c,+b,+d);JSM.AddVertexToBody(result,+c,+b,-d);JSM.AddVertexToBody(result,-c,+b,-d);JSM.AddPolygonToBody(result,[0,8,10,2,16]);JSM.AddPolygonToBody(result,[0,16,18,1,12]);JSM.AddPolygonToBody(result,[0,12,14,3,8]);JSM.AddPolygonToBody(result,[1,9,5,14,12]);JSM.AddPolygonToBody(result,[1,18,4,11,9]);JSM.AddPolygonToBody(result,[2,10,6,15,13]);JSM.AddPolygonToBody(result,[2,13,4,18,16]);JSM.AddPolygonToBody(result,[3,14,5,19,17]);JSM.AddPolygonToBody(result,[3,17,6,10,8]);JSM.AddPolygonToBody(result,[4,13,15,7,11]);JSM.AddPolygonToBody(result,[5,9,11,7,19]);JSM.AddPolygonToBody(result,[6,17,19,7,15]);return result;};JSM.GenerateIcosahedron=function(){var result=new JSM.Body();var a=1;var b=0;var c=(1+Math.sqrt(5))/2;JSM.AddVertexToBody(result,+b,+a,+c);JSM.AddVertexToBody(result,+b,+a,-c);JSM.AddVertexToBody(result,+b,-a,+c);JSM.AddVertexToBody(result,+b,-a,-c);JSM.AddVertexToBody(result,+a,+c,+b);JSM.AddVertexToBody(result,+a,-c,+b);JSM.AddVertexToBody(result,-a,+c,+b);JSM.AddVertexToBody(result,-a,-c,+b);JSM.AddVertexToBody(result,+c,+b,+a);JSM.AddVertexToBody(result,-c,+b,+a);JSM.AddVertexToBody(result,+c,+b,-a);JSM.AddVertexToBody(result,-c,+b,-a);JSM.AddPolygonToBody(result,[0,2,8]);JSM.AddPolygonToBody(result,[0,4,6]);JSM.AddPolygonToBody(result,[0,6,9]);JSM.AddPolygonToBody(result,[0,8,4]);JSM.AddPolygonToBody(result,[0,9,2]);JSM.AddPolygonToBody(result,[1,3,11]);JSM.AddPolygonToBody(result,[1,4,10]);JSM.AddPolygonToBody(result,[1,6,4]);JSM.AddPolygonToBody(result,[1,10,3]);JSM.AddPolygonToBody(result,[1,11,6]);JSM.AddPolygonToBody(result,[2,5,8]);JSM.AddPolygonToBody(result,[2,7,5]);JSM.AddPolygonToBody(result,[2,9,7]);JSM.AddPolygonToBody(result,[3,5,7]);JSM.AddPolygonToBody(result,[3,7,11]);JSM.AddPolygonToBody(result,[3,10,5]);JSM.AddPolygonToBody(result,[4,8,10]);JSM.AddPolygonToBody(result,[6,11,9]);JSM.AddPolygonToBody(result,[5,10,8]);JSM.AddPolygonToBody(result,[7,9,11]);return result;};JSM.GenerateTruncatedTetrahedron=function(){var result=new JSM.Body();var a=1;var b=3;JSM.AddVertexToBody(result,+a,+a,+b);JSM.AddVertexToBody(result,+a,-a,-b);JSM.AddVertexToBody(result,-a,-a,+b);JSM.AddVertexToBody(result,-a,+a,-b);JSM.AddVertexToBody(result,+a,+b,+a);JSM.AddVertexToBody(result,+a,-b,-a);JSM.AddVertexToBody(result,-a,-b,+a);JSM.AddVertexToBody(result,-a,+b,-a);JSM.AddVertexToBody(result,+b,+a,+a);JSM.AddVertexToBody(result,+b,-a,-a);JSM.AddVertexToBody(result,-b,-a,+a);JSM.AddVertexToBody(result,-b,+a,-a);JSM.AddPolygonToBody(result,[0,8,4]);JSM.AddPolygonToBody(result,[1,9,5]);JSM.AddPolygonToBody(result,[2,10,6]);JSM.AddPolygonToBody(result,[3,11,7]);JSM.AddPolygonToBody(result,[0,2,6,5,9,8]);JSM.AddPolygonToBody(result,[0,4,7,11,10,2]);JSM.AddPolygonToBody(result,[1,3,7,4,8,9]);JSM.AddPolygonToBody(result,[1,5,6,10,11,3]);return result;};JSM.GenerateCuboctahedron=function(){var result=new JSM.Body();var a=1;var b=0;JSM.AddVertexToBody(result,+a,+a,+b);JSM.AddVertexToBody(result,+a,-a,+b);JSM.AddVertexToBody(result,-a,-a,+b);JSM.AddVertexToBody(result,-a,+a,+b);JSM.AddVertexToBody(result,+a,+b,+a);JSM.AddVertexToBody(result,+a,+b,-a);JSM.AddVertexToBody(result,-a,+b,+a);JSM.AddVertexToBody(result,-a,+b,-a);JSM.AddVertexToBody(result,+b,+a,+a);JSM.AddVertexToBody(result,+b,-a,-a);JSM.AddVertexToBody(result,+b,-a,+a);JSM.AddVertexToBody(result,+b,+a,-a);JSM.AddPolygonToBody(result,[0,5,11]);JSM.AddPolygonToBody(result,[0,8,4]);JSM.AddPolygonToBody(result,[1,4,10]);JSM.AddPolygonToBody(result,[1,9,5]);JSM.AddPolygonToBody(result,[2,7,9]);JSM.AddPolygonToBody(result,[2,10,6]);JSM.AddPolygonToBody(result,[3,6,8]);JSM.AddPolygonToBody(result,[3,11,7]);JSM.AddPolygonToBody(result,[0,4,1,5]);JSM.AddPolygonToBody(result,[0,11,3,8]);JSM.AddPolygonToBody(result,[1,10,2,9]);JSM.AddPolygonToBody(result,[2,6,3,7]);JSM.AddPolygonToBody(result,[4,8,6,10]);JSM.AddPolygonToBody(result,[5,9,7,11]);return result;};JSM.GenerateTruncatedCube=function(){var result=new JSM.Body();var a=1;var b=Math.sqrt(2)-1;JSM.AddVertexToBody(result,+a,+a,+b);JSM.AddVertexToBody(result,+a,+a,-b);JSM.AddVertexToBody(result,+a,-a,+b);JSM.AddVertexToBody(result,-a,+a,+b);JSM.AddVertexToBody(result,+a,-a,-b);JSM.AddVertexToBody(result,-a,+a,-b);JSM.AddVertexToBody(result,-a,-a,+b);JSM.AddVertexToBody(result,-a,-a,-b);JSM.AddVertexToBody(result,+a,+b,+a);JSM.AddVertexToBody(result,+a,+b,-a);JSM.AddVertexToBody(result,+a,-b,+a);JSM.AddVertexToBody(result,-a,+b,+a);JSM.AddVertexToBody(result,+a,-b,-a);JSM.AddVertexToBody(result,-a,+b,-a);JSM.AddVertexToBody(result,-a,-b,+a);JSM.AddVertexToBody(result,-a,-b,-a);JSM.AddVertexToBody(result,+b,+a,+a);JSM.AddVertexToBody(result,+b,+a,-a);JSM.AddVertexToBody(result,+b,-a,+a);JSM.AddVertexToBody(result,-b,+a,+a);JSM.AddVertexToBody(result,+b,-a,-a);JSM.AddVertexToBody(result,-b,+a,-a);JSM.AddVertexToBody(result,-b,-a,+a);JSM.AddVertexToBody(result,-b,-a,-a);JSM.AddPolygonToBody(result,[0,16,8]);JSM.AddPolygonToBody(result,[1,9,17]);JSM.AddPolygonToBody(result,[2,10,18]);JSM.AddPolygonToBody(result,[3,11,19]);JSM.AddPolygonToBody(result,[4,20,12]);JSM.AddPolygonToBody(result,[5,21,13]);JSM.AddPolygonToBody(result,[6,22,14]);JSM.AddPolygonToBody(result,[7,15,23]);JSM.AddPolygonToBody(result,[0,1,17,21,5,3,19,16]);JSM.AddPolygonToBody(result,[0,8,10,2,4,12,9,1]);JSM.AddPolygonToBody(result,[2,18,22,6,7,23,20,4]);JSM.AddPolygonToBody(result,[3,5,13,15,7,6,14,11]);JSM.AddPolygonToBody(result,[8,16,19,11,14,22,18,10]);JSM.AddPolygonToBody(result,[9,12,20,23,15,13,21,17]);return result;};JSM.GenerateTruncatedOctahedron=function(){var result=new JSM.Body();var a=1;var b=0;var c=2;JSM.AddVertexToBody(result,+b,+a,+c);JSM.AddVertexToBody(result,+b,+a,-c);JSM.AddVertexToBody(result,+b,-a,+c);JSM.AddVertexToBody(result,+b,-a,-c);JSM.AddVertexToBody(result,+b,+c,+a);JSM.AddVertexToBody(result,+b,-c,+a);JSM.AddVertexToBody(result,+b,+c,-a);JSM.AddVertexToBody(result,+b,-c,-a);JSM.AddVertexToBody(result,+a,+b,+c);JSM.AddVertexToBody(result,+a,+b,-c);JSM.AddVertexToBody(result,-a,+b,+c);JSM.AddVertexToBody(result,-a,+b,-c);JSM.AddVertexToBody(result,+a,+c,+b);JSM.AddVertexToBody(result,+a,-c,+b);JSM.AddVertexToBody(result,-a,+c,+b);JSM.AddVertexToBody(result,-a,-c,+b);JSM.AddVertexToBody(result,+c,+b,+a);JSM.AddVertexToBody(result,-c,+b,+a);JSM.AddVertexToBody(result,+c,+b,-a);JSM.AddVertexToBody(result,-c,+b,-a);JSM.AddVertexToBody(result,+c,+a,+b);JSM.AddVertexToBody(result,-c,+a,+b);JSM.AddVertexToBody(result,+c,-a,+b);JSM.AddVertexToBody(result,-c,-a,+b);JSM.AddPolygonToBody(result,[0,10,2,8]);JSM.AddPolygonToBody(result,[1,9,3,11]);JSM.AddPolygonToBody(result,[4,12,6,14]);JSM.AddPolygonToBody(result,[5,15,7,13]);JSM.AddPolygonToBody(result,[16,22,18,20]);JSM.AddPolygonToBody(result,[17,21,19,23]);JSM.AddPolygonToBody(result,[0,4,14,21,17,10]);JSM.AddPolygonToBody(result,[0,8,16,20,12,4]);JSM.AddPolygonToBody(result,[1,6,12,20,18,9]);JSM.AddPolygonToBody(result,[1,11,19,21,14,6]);JSM.AddPolygonToBody(result,[2,5,13,22,16,8]);JSM.AddPolygonToBody(result,[2,10,17,23,15,5]);JSM.AddPolygonToBody(result,[3,7,15,23,19,11]);JSM.AddPolygonToBody(result,[3,9,18,22,13,7]);return result;};JSM.GenerateRhombicuboctahedron=function(){var result=new JSM.Body();var a=1;var b=1+Math.sqrt(2);JSM.AddVertexToBody(result,+a,+a,+b);JSM.AddVertexToBody(result,+a,+a,-b);JSM.AddVertexToBody(result,+a,-a,+b);JSM.AddVertexToBody(result,-a,+a,+b);JSM.AddVertexToBody(result,+a,-a,-b);JSM.AddVertexToBody(result,-a,+a,-b);JSM.AddVertexToBody(result,-a,-a,+b);JSM.AddVertexToBody(result,-a,-a,-b);JSM.AddVertexToBody(result,+a,+b,+a);JSM.AddVertexToBody(result,+a,+b,-a);JSM.AddVertexToBody(result,+a,-b,+a);JSM.AddVertexToBody(result,-a,+b,+a);JSM.AddVertexToBody(result,+a,-b,-a);JSM.AddVertexToBody(result,-a,+b,-a);JSM.AddVertexToBody(result,-a,-b,+a);JSM.AddVertexToBody(result,-a,-b,-a);JSM.AddVertexToBody(result,+b,+a,+a);JSM.AddVertexToBody(result,+b,+a,-a);JSM.AddVertexToBody(result,+b,-a,+a);JSM.AddVertexToBody(result,-b,+a,+a);JSM.AddVertexToBody(result,+b,-a,-a);JSM.AddVertexToBody(result,-b,+a,-a);JSM.AddVertexToBody(result,-b,-a,+a);JSM.AddVertexToBody(result,-b,-a,-a);JSM.AddPolygonToBody(result,[0,16,8]);JSM.AddPolygonToBody(result,[1,9,17]);JSM.AddPolygonToBody(result,[2,10,18]);JSM.AddPolygonToBody(result,[3,11,19]);JSM.AddPolygonToBody(result,[4,20,12]);JSM.AddPolygonToBody(result,[5,21,13]);JSM.AddPolygonToBody(result,[6,22,14]);JSM.AddPolygonToBody(result,[7,15,23]);JSM.AddPolygonToBody(result,[0,2,18,16]);JSM.AddPolygonToBody(result,[0,3,6,2]);JSM.AddPolygonToBody(result,[0,8,11,3]);JSM.AddPolygonToBody(result,[1,4,7,5]);JSM.AddPolygonToBody(result,[1,5,13,9]);JSM.AddPolygonToBody(result,[1,17,20,4]);JSM.AddPolygonToBody(result,[2,6,14,10]);JSM.AddPolygonToBody(result,[3,19,22,6]);JSM.AddPolygonToBody(result,[4,12,15,7]);JSM.AddPolygonToBody(result,[5,7,23,21]);JSM.AddPolygonToBody(result,[8,9,13,11]);JSM.AddPolygonToBody(result,[8,16,17,9]);JSM.AddPolygonToBody(result,[10,12,20,18]);JSM.AddPolygonToBody(result,[10,14,15,12]);JSM.AddPolygonToBody(result,[11,13,21,19]);JSM.AddPolygonToBody(result,[14,22,23,15]);JSM.AddPolygonToBody(result,[16,18,20,17]);JSM.AddPolygonToBody(result,[19,21,23,22]);return result;};JSM.GenerateTruncatedCuboctahedron=function(){var result=new JSM.Body();var a=1;var b=1+Math.sqrt(2);var c=1+2*Math.sqrt(2);JSM.AddVertexToBody(result,+a,+b,+c);JSM.AddVertexToBody(result,+a,+b,-c);JSM.AddVertexToBody(result,+a,-b,+c);JSM.AddVertexToBody(result,-a,+b,+c);JSM.AddVertexToBody(result,+a,-b,-c);JSM.AddVertexToBody(result,-a,+b,-c);JSM.AddVertexToBody(result,-a,-b,+c);JSM.AddVertexToBody(result,-a,-b,-c);JSM.AddVertexToBody(result,+a,+c,+b);JSM.AddVertexToBody(result,+a,-c,+b);JSM.AddVertexToBody(result,+a,+c,-b);JSM.AddVertexToBody(result,-a,+c,+b);JSM.AddVertexToBody(result,+a,-c,-b);JSM.AddVertexToBody(result,-a,-c,+b);JSM.AddVertexToBody(result,-a,+c,-b);JSM.AddVertexToBody(result,-a,-c,-b);JSM.AddVertexToBody(result,+b,+a,+c);JSM.AddVertexToBody(result,+b,+a,-c);JSM.AddVertexToBody(result,-b,+a,+c);JSM.AddVertexToBody(result,+b,-a,+c);JSM.AddVertexToBody(result,-b,+a,-c);JSM.AddVertexToBody(result,+b,-a,-c);JSM.AddVertexToBody(result,-b,-a,+c);JSM.AddVertexToBody(result,-b,-a,-c);JSM.AddVertexToBody(result,+b,+c,+a);JSM.AddVertexToBody(result,+b,-c,+a);JSM.AddVertexToBody(result,-b,+c,+a);JSM.AddVertexToBody(result,+b,+c,-a);JSM.AddVertexToBody(result,-b,-c,+a);JSM.AddVertexToBody(result,+b,-c,-a);JSM.AddVertexToBody(result,-b,+c,-a);JSM.AddVertexToBody(result,-b,-c,-a);JSM.AddVertexToBody(result,+c,+a,+b);JSM.AddVertexToBody(result,-c,+a,+b);JSM.AddVertexToBody(result,+c,+a,-b);JSM.AddVertexToBody(result,+c,-a,+b);JSM.AddVertexToBody(result,-c,+a,-b);JSM.AddVertexToBody(result,-c,-a,+b);JSM.AddVertexToBody(result,+c,-a,-b);JSM.AddVertexToBody(result,-c,-a,-b);JSM.AddVertexToBody(result,+c,+b,+a);JSM.AddVertexToBody(result,-c,+b,+a);JSM.AddVertexToBody(result,+c,-b,+a);JSM.AddVertexToBody(result,+c,+b,-a);JSM.AddVertexToBody(result,-c,-b,+a);JSM.AddVertexToBody(result,-c,+b,-a);JSM.AddVertexToBody(result,+c,-b,-a);JSM.AddVertexToBody(result,-c,-b,-a);JSM.AddPolygonToBody(result,[0,8,11,3]);JSM.AddPolygonToBody(result,[1,5,14,10]);JSM.AddPolygonToBody(result,[2,6,13,9]);JSM.AddPolygonToBody(result,[4,12,15,7]);JSM.AddPolygonToBody(result,[16,19,35,32]);JSM.AddPolygonToBody(result,[17,34,38,21]);JSM.AddPolygonToBody(result,[18,33,37,22]);JSM.AddPolygonToBody(result,[23,39,36,20]);JSM.AddPolygonToBody(result,[24,40,43,27]);JSM.AddPolygonToBody(result,[25,29,46,42]);JSM.AddPolygonToBody(result,[26,30,45,41]);JSM.AddPolygonToBody(result,[28,44,47,31]);JSM.AddPolygonToBody(result,[0,16,32,40,24,8]);JSM.AddPolygonToBody(result,[1,10,27,43,34,17]);JSM.AddPolygonToBody(result,[2,9,25,42,35,19]);JSM.AddPolygonToBody(result,[3,11,26,41,33,18]);JSM.AddPolygonToBody(result,[4,21,38,46,29,12]);JSM.AddPolygonToBody(result,[5,20,36,45,30,14]);JSM.AddPolygonToBody(result,[6,22,37,44,28,13]);JSM.AddPolygonToBody(result,[7,15,31,47,39,23]);JSM.AddPolygonToBody(result,[0,3,18,22,6,2,19,16]);JSM.AddPolygonToBody(result,[1,17,21,4,7,23,20,5]);JSM.AddPolygonToBody(result,[8,24,27,10,14,30,26,11]);JSM.AddPolygonToBody(result,[9,13,28,31,15,12,29,25]);JSM.AddPolygonToBody(result,[32,35,42,46,38,34,43,40]);JSM.AddPolygonToBody(result,[33,41,45,36,39,47,44,37]);return result;};JSM.GenerateSnubCube=function(){var result=new JSM.Body();var a=1;var b=(1/3)*(Math.pow(17+3*Math.sqrt(33),1/3)-Math.pow(-17+3*Math.sqrt(33),1/3)-1);var c=1/b;JSM.AddVertexToBody(result,+a,+b,-c);JSM.AddVertexToBody(result,+a,-b,+c);JSM.AddVertexToBody(result,-a,+b,+c);JSM.AddVertexToBody(result,-a,-b,-c);JSM.AddVertexToBody(result,+b,-c,+a);JSM.AddVertexToBody(result,-b,+c,+a);JSM.AddVertexToBody(result,+b,+c,-a);JSM.AddVertexToBody(result,-b,-c,-a);JSM.AddVertexToBody(result,-c,+a,+b);JSM.AddVertexToBody(result,+c,+a,-b);JSM.AddVertexToBody(result,+c,-a,+b);JSM.AddVertexToBody(result,-c,-a,-b);JSM.AddVertexToBody(result,+a,+c,+b);JSM.AddVertexToBody(result,+a,-c,-b);JSM.AddVertexToBody(result,-a,+c,-b);JSM.AddVertexToBody(result,-a,-c,+b);JSM.AddVertexToBody(result,+b,+a,+c);JSM.AddVertexToBody(result,-b,+a,-c);JSM.AddVertexToBody(result,-b,-a,+c);JSM.AddVertexToBody(result,+b,-a,-c);JSM.AddVertexToBody(result,+c,+b,+a);JSM.AddVertexToBody(result,-c,-b,+a);JSM.AddVertexToBody(result,+c,-b,-a);JSM.AddVertexToBody(result,-c,+b,-a);JSM.AddPolygonToBody(result,[0,6,9]);JSM.AddPolygonToBody(result,[0,9,22]);JSM.AddPolygonToBody(result,[0,17,6]);JSM.AddPolygonToBody(result,[0,22,19]);JSM.AddPolygonToBody(result,[1,4,10]);JSM.AddPolygonToBody(result,[1,10,20]);JSM.AddPolygonToBody(result,[1,18,4]);JSM.AddPolygonToBody(result,[1,20,16]);JSM.AddPolygonToBody(result,[2,5,8]);JSM.AddPolygonToBody(result,[2,8,21]);JSM.AddPolygonToBody(result,[2,16,5]);JSM.AddPolygonToBody(result,[2,21,18]);JSM.AddPolygonToBody(result,[3,7,11]);JSM.AddPolygonToBody(result,[3,11,23]);JSM.AddPolygonToBody(result,[3,19,7]);JSM.AddPolygonToBody(result,[3,23,17]);JSM.AddPolygonToBody(result,[4,13,10]);JSM.AddPolygonToBody(result,[4,18,15]);JSM.AddPolygonToBody(result,[5,14,8]);JSM.AddPolygonToBody(result,[5,16,12]);JSM.AddPolygonToBody(result,[6,12,9]);JSM.AddPolygonToBody(result,[6,17,14]);JSM.AddPolygonToBody(result,[7,15,11]);JSM.AddPolygonToBody(result,[7,19,13]);JSM.AddPolygonToBody(result,[8,14,23]);JSM.AddPolygonToBody(result,[9,12,20]);JSM.AddPolygonToBody(result,[10,13,22]);JSM.AddPolygonToBody(result,[11,15,21]);JSM.AddPolygonToBody(result,[12,16,20]);JSM.AddPolygonToBody(result,[13,19,22]);JSM.AddPolygonToBody(result,[14,17,23]);JSM.AddPolygonToBody(result,[15,18,21]);JSM.AddPolygonToBody(result,[0,19,3,17]);JSM.AddPolygonToBody(result,[1,16,2,18]);JSM.AddPolygonToBody(result,[4,15,7,13]);JSM.AddPolygonToBody(result,[5,12,6,14]);JSM.AddPolygonToBody(result,[8,23,11,21]);JSM.AddPolygonToBody(result,[9,20,10,22]);return result;};JSM.GenerateIcosidodecahedron=function(){var result=new JSM.Body();var a=0;var b=(1+Math.sqrt(5))/2;var c=1/2;var d=b/2;var e=(1+b)/2;JSM.AddVertexToBody(result,+a,+a,+b);JSM.AddVertexToBody(result,+a,+a,-b);JSM.AddVertexToBody(result,+a,+b,+a);JSM.AddVertexToBody(result,+a,-b,+a);JSM.AddVertexToBody(result,+b,+a,+a);JSM.AddVertexToBody(result,-b,+a,+a);JSM.AddVertexToBody(result,+c,+d,+e);JSM.AddVertexToBody(result,+c,+d,-e);JSM.AddVertexToBody(result,+c,-d,+e);JSM.AddVertexToBody(result,-c,+d,+e);JSM.AddVertexToBody(result,+c,-d,-e);JSM.AddVertexToBody(result,-c,+d,-e);JSM.AddVertexToBody(result,-c,-d,+e);JSM.AddVertexToBody(result,-c,-d,-e);JSM.AddVertexToBody(result,+d,+e,+c);JSM.AddVertexToBody(result,+d,-e,+c);JSM.AddVertexToBody(result,-d,+e,+c);JSM.AddVertexToBody(result,+d,+e,-c);JSM.AddVertexToBody(result,-d,-e,+c);JSM.AddVertexToBody(result,+d,-e,-c);JSM.AddVertexToBody(result,-d,+e,-c);JSM.AddVertexToBody(result,-d,-e,-c);JSM.AddVertexToBody(result,+e,+c,+d);JSM.AddVertexToBody(result,-e,+c,+d);JSM.AddVertexToBody(result,+e,+c,-d);JSM.AddVertexToBody(result,+e,-c,+d);JSM.AddVertexToBody(result,-e,+c,-d);JSM.AddVertexToBody(result,-e,-c,+d);JSM.AddVertexToBody(result,+e,-c,-d);JSM.AddVertexToBody(result,-e,-c,-d);JSM.AddPolygonToBody(result,[0,6,9]);JSM.AddPolygonToBody(result,[0,12,8]);JSM.AddPolygonToBody(result,[1,10,13]);JSM.AddPolygonToBody(result,[1,11,7]);JSM.AddPolygonToBody(result,[2,14,17]);JSM.AddPolygonToBody(result,[2,20,16]);JSM.AddPolygonToBody(result,[3,18,21]);JSM.AddPolygonToBody(result,[3,19,15]);JSM.AddPolygonToBody(result,[4,22,25]);JSM.AddPolygonToBody(result,[4,28,24]);JSM.AddPolygonToBody(result,[5,26,29]);JSM.AddPolygonToBody(result,[5,27,23]);JSM.AddPolygonToBody(result,[6,22,14]);JSM.AddPolygonToBody(result,[7,17,24]);JSM.AddPolygonToBody(result,[8,15,25]);JSM.AddPolygonToBody(result,[9,16,23]);JSM.AddPolygonToBody(result,[10,28,19]);JSM.AddPolygonToBody(result,[11,26,20]);JSM.AddPolygonToBody(result,[12,27,18]);JSM.AddPolygonToBody(result,[13,21,29]);JSM.AddPolygonToBody(result,[0,8,25,22,6]);JSM.AddPolygonToBody(result,[0,9,23,27,12]);JSM.AddPolygonToBody(result,[1,7,24,28,10]);JSM.AddPolygonToBody(result,[1,13,29,26,11]);JSM.AddPolygonToBody(result,[2,16,9,6,14]);JSM.AddPolygonToBody(result,[2,17,7,11,20]);JSM.AddPolygonToBody(result,[3,15,8,12,18]);JSM.AddPolygonToBody(result,[3,21,13,10,19]);JSM.AddPolygonToBody(result,[4,24,17,14,22]);JSM.AddPolygonToBody(result,[4,25,15,19,28]);JSM.AddPolygonToBody(result,[5,23,16,20,26]);JSM.AddPolygonToBody(result,[5,29,21,18,27]);return result;};JSM.GenerateTruncatedDodecahedron=function(){var result=new JSM.Body();var a=0;var b=2;var c=(1+Math.sqrt(5))/2;var d=1/c;var e=2+c;var f=2*c;var g=Math.pow(c,2);JSM.AddVertexToBody(result,+a,+d,+e);JSM.AddVertexToBody(result,+a,+d,-e);JSM.AddVertexToBody(result,+a,-d,+e);JSM.AddVertexToBody(result,+a,-d,-e);JSM.AddVertexToBody(result,+e,+a,+d);JSM.AddVertexToBody(result,-e,+a,+d);JSM.AddVertexToBody(result,+e,+a,-d);JSM.AddVertexToBody(result,-e,+a,-d);JSM.AddVertexToBody(result,+d,+e,+a);JSM.AddVertexToBody(result,+d,-e,+a);JSM.AddVertexToBody(result,-d,+e,+a);JSM.AddVertexToBody(result,-d,-e,+a);JSM.AddVertexToBody(result,+d,+c,+f);JSM.AddVertexToBody(result,+d,+c,-f);JSM.AddVertexToBody(result,+d,-c,+f);JSM.AddVertexToBody(result,-d,+c,+f);JSM.AddVertexToBody(result,+d,-c,-f);JSM.AddVertexToBody(result,-d,+c,-f);JSM.AddVertexToBody(result,-d,-c,+f);JSM.AddVertexToBody(result,-d,-c,-f);JSM.AddVertexToBody(result,+f,+d,+c);JSM.AddVertexToBody(result,+f,+d,-c);JSM.AddVertexToBody(result,+f,-d,+c);JSM.AddVertexToBody(result,-f,+d,+c);JSM.AddVertexToBody(result,+f,-d,-c);JSM.AddVertexToBody(result,-f,+d,-c);JSM.AddVertexToBody(result,-f,-d,+c);JSM.AddVertexToBody(result,-f,-d,-c);JSM.AddVertexToBody(result,+c,+f,+d);JSM.AddVertexToBody(result,+c,+f,-d);JSM.AddVertexToBody(result,+c,-f,+d);JSM.AddVertexToBody(result,-c,+f,+d);JSM.AddVertexToBody(result,+c,-f,-d);JSM.AddVertexToBody(result,-c,+f,-d);JSM.AddVertexToBody(result,-c,-f,+d);JSM.AddVertexToBody(result,-c,-f,-d);JSM.AddVertexToBody(result,+c,+b,+g);JSM.AddVertexToBody(result,+c,+b,-g);JSM.AddVertexToBody(result,+c,-b,+g);JSM.AddVertexToBody(result,-c,+b,+g);JSM.AddVertexToBody(result,+c,-b,-g);JSM.AddVertexToBody(result,-c,+b,-g);JSM.AddVertexToBody(result,-c,-b,+g);JSM.AddVertexToBody(result,-c,-b,-g);JSM.AddVertexToBody(result,+g,+c,+b);JSM.AddVertexToBody(result,+g,+c,-b);JSM.AddVertexToBody(result,+g,-c,+b);JSM.AddVertexToBody(result,-g,+c,+b);JSM.AddVertexToBody(result,+g,-c,-b);JSM.AddVertexToBody(result,-g,+c,-b);JSM.AddVertexToBody(result,-g,-c,+b);JSM.AddVertexToBody(result,-g,-c,-b);JSM.AddVertexToBody(result,+b,+g,+c);JSM.AddVertexToBody(result,+b,+g,-c);JSM.AddVertexToBody(result,+b,-g,+c);JSM.AddVertexToBody(result,-b,+g,+c);JSM.AddVertexToBody(result,+b,-g,-c);JSM.AddVertexToBody(result,-b,+g,-c);JSM.AddVertexToBody(result,-b,-g,+c);JSM.AddVertexToBody(result,-b,-g,-c);JSM.AddPolygonToBody(result,[0,12,15]);JSM.AddPolygonToBody(result,[1,17,13]);JSM.AddPolygonToBody(result,[2,18,14]);JSM.AddPolygonToBody(result,[3,16,19]);JSM.AddPolygonToBody(result,[4,20,22]);JSM.AddPolygonToBody(result,[5,26,23]);JSM.AddPolygonToBody(result,[6,24,21]);JSM.AddPolygonToBody(result,[7,25,27]);JSM.AddPolygonToBody(result,[8,28,29]);JSM.AddPolygonToBody(result,[9,32,30]);JSM.AddPolygonToBody(result,[10,33,31]);JSM.AddPolygonToBody(result,[11,34,35]);JSM.AddPolygonToBody(result,[36,44,52]);JSM.AddPolygonToBody(result,[37,53,45]);JSM.AddPolygonToBody(result,[38,54,46]);JSM.AddPolygonToBody(result,[39,55,47]);JSM.AddPolygonToBody(result,[40,48,56]);JSM.AddPolygonToBody(result,[41,49,57]);JSM.AddPolygonToBody(result,[42,50,58]);JSM.AddPolygonToBody(result,[43,59,51]);JSM.AddPolygonToBody(result,[0,2,14,38,46,22,20,44,36,12]);JSM.AddPolygonToBody(result,[0,15,39,47,23,26,50,42,18,2]);JSM.AddPolygonToBody(result,[1,3,19,43,51,27,25,49,41,17]);JSM.AddPolygonToBody(result,[1,13,37,45,21,24,48,40,16,3]);JSM.AddPolygonToBody(result,[4,6,21,45,53,29,28,52,44,20]);JSM.AddPolygonToBody(result,[4,22,46,54,30,32,56,48,24,6]);JSM.AddPolygonToBody(result,[5,7,27,51,59,35,34,58,50,26]);JSM.AddPolygonToBody(result,[5,23,47,55,31,33,57,49,25,7]);JSM.AddPolygonToBody(result,[8,10,31,55,39,15,12,36,52,28]);JSM.AddPolygonToBody(result,[8,29,53,37,13,17,41,57,33,10]);JSM.AddPolygonToBody(result,[9,11,35,59,43,19,16,40,56,32]);JSM.AddPolygonToBody(result,[9,30,54,38,14,18,42,58,34,11]);return result;};JSM.GenerateTruncatedIcosahedron=function(){var result=new JSM.Body();var a=0;var b=1;var c=2;var d=(1+Math.sqrt(5))/2;var e=3*d;var f=1+2*d;var g=2+d;var h=2*d;JSM.AddVertexToBody(result,+a,+b,+e);JSM.AddVertexToBody(result,+a,+b,-e);JSM.AddVertexToBody(result,+a,-b,+e);JSM.AddVertexToBody(result,+a,-b,-e);JSM.AddVertexToBody(result,+b,+e,+a);JSM.AddVertexToBody(result,+b,-e,+a);JSM.AddVertexToBody(result,-b,+e,+a);JSM.AddVertexToBody(result,-b,-e,+a);JSM.AddVertexToBody(result,+e,+a,+b);JSM.AddVertexToBody(result,-e,+a,+b);JSM.AddVertexToBody(result,+e,+a,-b);JSM.AddVertexToBody(result,-e,+a,-b);JSM.AddVertexToBody(result,+c,+f,+d);JSM.AddVertexToBody(result,+c,+f,-d);JSM.AddVertexToBody(result,+c,-f,+d);JSM.AddVertexToBody(result,-c,+f,+d);JSM.AddVertexToBody(result,+c,-f,-d);JSM.AddVertexToBody(result,-c,+f,-d);JSM.AddVertexToBody(result,-c,-f,+d);JSM.AddVertexToBody(result,-c,-f,-d);JSM.AddVertexToBody(result,+f,+d,+c);JSM.AddVertexToBody(result,+f,-d,+c);JSM.AddVertexToBody(result,-f,+d,+c);JSM.AddVertexToBody(result,+f,+d,-c);JSM.AddVertexToBody(result,-f,-d,+c);JSM.AddVertexToBody(result,+f,-d,-c);JSM.AddVertexToBody(result,-f,+d,-c);JSM.AddVertexToBody(result,-f,-d,-c);JSM.AddVertexToBody(result,+d,+c,+f);JSM.AddVertexToBody(result,-d,+c,+f);JSM.AddVertexToBody(result,+d,+c,-f);JSM.AddVertexToBody(result,+d,-c,+f);JSM.AddVertexToBody(result,-d,+c,-f);JSM.AddVertexToBody(result,-d,-c,+f);JSM.AddVertexToBody(result,+d,-c,-f);JSM.AddVertexToBody(result,-d,-c,-f);JSM.AddVertexToBody(result,+b,+g,+h);JSM.AddVertexToBody(result,+b,+g,-h);JSM.AddVertexToBody(result,+b,-g,+h);JSM.AddVertexToBody(result,-b,+g,+h);JSM.AddVertexToBody(result,+b,-g,-h);JSM.AddVertexToBody(result,-b,+g,-h);JSM.AddVertexToBody(result,-b,-g,+h);JSM.AddVertexToBody(result,-b,-g,-h);JSM.AddVertexToBody(result,+g,+h,+b);JSM.AddVertexToBody(result,+g,-h,+b);JSM.AddVertexToBody(result,-g,+h,+b);JSM.AddVertexToBody(result,+g,+h,-b);JSM.AddVertexToBody(result,-g,-h,+b);JSM.AddVertexToBody(result,+g,-h,-b);JSM.AddVertexToBody(result,-g,+h,-b);JSM.AddVertexToBody(result,-g,-h,-b);JSM.AddVertexToBody(result,+h,+b,+g);JSM.AddVertexToBody(result,-h,+b,+g);JSM.AddVertexToBody(result,+h,+b,-g);JSM.AddVertexToBody(result,+h,-b,+g);JSM.AddVertexToBody(result,-h,+b,-g);JSM.AddVertexToBody(result,-h,-b,+g);JSM.AddVertexToBody(result,+h,-b,-g);JSM.AddVertexToBody(result,-h,-b,-g);JSM.AddPolygonToBody(result,[0,28,36,39,29]);JSM.AddPolygonToBody(result,[1,32,41,37,30]);JSM.AddPolygonToBody(result,[2,33,42,38,31]);JSM.AddPolygonToBody(result,[3,34,40,43,35]);JSM.AddPolygonToBody(result,[4,12,44,47,13]);JSM.AddPolygonToBody(result,[5,16,49,45,14]);JSM.AddPolygonToBody(result,[6,17,50,46,15]);JSM.AddPolygonToBody(result,[7,18,48,51,19]);JSM.AddPolygonToBody(result,[8,20,52,55,21]);JSM.AddPolygonToBody(result,[9,24,57,53,22]);JSM.AddPolygonToBody(result,[10,25,58,54,23]);JSM.AddPolygonToBody(result,[11,26,56,59,27]);JSM.AddPolygonToBody(result,[0,2,31,55,52,28]);JSM.AddPolygonToBody(result,[0,29,53,57,33,2]);JSM.AddPolygonToBody(result,[1,3,35,59,56,32]);JSM.AddPolygonToBody(result,[1,30,54,58,34,3]);JSM.AddPolygonToBody(result,[4,6,15,39,36,12]);JSM.AddPolygonToBody(result,[4,13,37,41,17,6]);JSM.AddPolygonToBody(result,[5,7,19,43,40,16]);JSM.AddPolygonToBody(result,[5,14,38,42,18,7]);JSM.AddPolygonToBody(result,[8,10,23,47,44,20]);JSM.AddPolygonToBody(result,[8,21,45,49,25,10]);JSM.AddPolygonToBody(result,[9,11,27,51,48,24]);JSM.AddPolygonToBody(result,[9,22,46,50,26,11]);JSM.AddPolygonToBody(result,[12,36,28,52,20,44]);JSM.AddPolygonToBody(result,[13,47,23,54,30,37]);JSM.AddPolygonToBody(result,[14,45,21,55,31,38]);JSM.AddPolygonToBody(result,[15,46,22,53,29,39]);JSM.AddPolygonToBody(result,[16,40,34,58,25,49]);JSM.AddPolygonToBody(result,[17,41,32,56,26,50]);JSM.AddPolygonToBody(result,[18,42,33,57,24,48]);JSM.AddPolygonToBody(result,[19,51,27,59,35,43]);return result;};JSM.GenerateRhombicosidodecahedron=function(){var result=new JSM.Body();var a=0;var b=1;var c=(1+Math.sqrt(5))/2;var d=Math.pow(c,2);var e=Math.pow(c,3);var f=2*c;var g=2+c;JSM.AddVertexToBody(result,+b,+b,+e);JSM.AddVertexToBody(result,+b,+b,-e);JSM.AddVertexToBody(result,+b,-b,+e);JSM.AddVertexToBody(result,-b,+b,+e);JSM.AddVertexToBody(result,+b,-b,-e);JSM.AddVertexToBody(result,-b,+b,-e);JSM.AddVertexToBody(result,-b,-b,+e);JSM.AddVertexToBody(result,-b,-b,-e);JSM.AddVertexToBody(result,+e,+b,+b);JSM.AddVertexToBody(result,+e,+b,-b);JSM.AddVertexToBody(result,+e,-b,+b);JSM.AddVertexToBody(result,-e,+b,+b);JSM.AddVertexToBody(result,+e,-b,-b);JSM.AddVertexToBody(result,-e,+b,-b);JSM.AddVertexToBody(result,-e,-b,+b);JSM.AddVertexToBody(result,-e,-b,-b);JSM.AddVertexToBody(result,+b,+e,+b);JSM.AddVertexToBody(result,+b,+e,-b);JSM.AddVertexToBody(result,+b,-e,+b);JSM.AddVertexToBody(result,-b,+e,+b);JSM.AddVertexToBody(result,+b,-e,-b);JSM.AddVertexToBody(result,-b,+e,-b);JSM.AddVertexToBody(result,-b,-e,+b);JSM.AddVertexToBody(result,-b,-e,-b);JSM.AddVertexToBody(result,+d,+c,+f);JSM.AddVertexToBody(result,+d,+c,-f);JSM.AddVertexToBody(result,+d,-c,+f);JSM.AddVertexToBody(result,-d,+c,+f);JSM.AddVertexToBody(result,+d,-c,-f);JSM.AddVertexToBody(result,-d,+c,-f);JSM.AddVertexToBody(result,-d,-c,+f);JSM.AddVertexToBody(result,-d,-c,-f);JSM.AddVertexToBody(result,+f,+d,+c);JSM.AddVertexToBody(result,+f,+d,-c);JSM.AddVertexToBody(result,+f,-d,+c);JSM.AddVertexToBody(result,-f,+d,+c);JSM.AddVertexToBody(result,+f,-d,-c);JSM.AddVertexToBody(result,-f,+d,-c);JSM.AddVertexToBody(result,-f,-d,+c);JSM.AddVertexToBody(result,-f,-d,-c);JSM.AddVertexToBody(result,+c,+f,+d);JSM.AddVertexToBody(result,+c,+f,-d);JSM.AddVertexToBody(result,+c,-f,+d);JSM.AddVertexToBody(result,-c,+f,+d);JSM.AddVertexToBody(result,+c,-f,-d);JSM.AddVertexToBody(result,-c,+f,-d);JSM.AddVertexToBody(result,-c,-f,+d);JSM.AddVertexToBody(result,-c,-f,-d);JSM.AddVertexToBody(result,+g,+a,+d);JSM.AddVertexToBody(result,+g,+a,-d);JSM.AddVertexToBody(result,-g,+a,+d);JSM.AddVertexToBody(result,-g,+a,-d);JSM.AddVertexToBody(result,+d,+g,+a);JSM.AddVertexToBody(result,-d,+g,+a);JSM.AddVertexToBody(result,+d,-g,+a);JSM.AddVertexToBody(result,-d,-g,+a);JSM.AddVertexToBody(result,+a,+d,+g);JSM.AddVertexToBody(result,+a,-d,+g);JSM.AddVertexToBody(result,+a,+d,-g);JSM.AddVertexToBody(result,+a,-d,-g);JSM.AddPolygonToBody(result,[0,56,3]);JSM.AddPolygonToBody(result,[1,5,58]);JSM.AddPolygonToBody(result,[2,6,57]);JSM.AddPolygonToBody(result,[4,59,7]);JSM.AddPolygonToBody(result,[8,48,10]);JSM.AddPolygonToBody(result,[9,12,49]);JSM.AddPolygonToBody(result,[11,14,50]);JSM.AddPolygonToBody(result,[13,51,15]);JSM.AddPolygonToBody(result,[16,52,17]);JSM.AddPolygonToBody(result,[18,20,54]);JSM.AddPolygonToBody(result,[19,21,53]);JSM.AddPolygonToBody(result,[22,55,23]);JSM.AddPolygonToBody(result,[24,32,40]);JSM.AddPolygonToBody(result,[25,41,33]);JSM.AddPolygonToBody(result,[26,42,34]);JSM.AddPolygonToBody(result,[27,43,35]);JSM.AddPolygonToBody(result,[28,36,44]);JSM.AddPolygonToBody(result,[29,37,45]);JSM.AddPolygonToBody(result,[30,38,46]);JSM.AddPolygonToBody(result,[31,47,39]);JSM.AddPolygonToBody(result,[0,3,6,2]);JSM.AddPolygonToBody(result,[0,24,40,56]);JSM.AddPolygonToBody(result,[1,4,7,5]);JSM.AddPolygonToBody(result,[1,58,41,25]);JSM.AddPolygonToBody(result,[2,57,42,26]);JSM.AddPolygonToBody(result,[3,56,43,27]);JSM.AddPolygonToBody(result,[4,28,44,59]);JSM.AddPolygonToBody(result,[5,29,45,58]);JSM.AddPolygonToBody(result,[6,30,46,57]);JSM.AddPolygonToBody(result,[7,59,47,31]);JSM.AddPolygonToBody(result,[8,10,12,9]);JSM.AddPolygonToBody(result,[8,32,24,48]);JSM.AddPolygonToBody(result,[9,49,25,33]);JSM.AddPolygonToBody(result,[10,48,26,34]);JSM.AddPolygonToBody(result,[11,13,15,14]);JSM.AddPolygonToBody(result,[11,50,27,35]);JSM.AddPolygonToBody(result,[12,36,28,49]);JSM.AddPolygonToBody(result,[13,37,29,51]);JSM.AddPolygonToBody(result,[14,38,30,50]);JSM.AddPolygonToBody(result,[15,51,31,39]);JSM.AddPolygonToBody(result,[16,17,21,19]);JSM.AddPolygonToBody(result,[16,40,32,52]);JSM.AddPolygonToBody(result,[17,52,33,41]);JSM.AddPolygonToBody(result,[18,22,23,20]);JSM.AddPolygonToBody(result,[18,54,34,42]);JSM.AddPolygonToBody(result,[19,53,35,43]);JSM.AddPolygonToBody(result,[20,44,36,54]);JSM.AddPolygonToBody(result,[21,45,37,53]);JSM.AddPolygonToBody(result,[22,46,38,55]);JSM.AddPolygonToBody(result,[23,55,39,47]);JSM.AddPolygonToBody(result,[0,2,26,48,24]);JSM.AddPolygonToBody(result,[1,25,49,28,4]);JSM.AddPolygonToBody(result,[3,27,50,30,6]);JSM.AddPolygonToBody(result,[5,7,31,51,29]);JSM.AddPolygonToBody(result,[8,9,33,52,32]);JSM.AddPolygonToBody(result,[10,34,54,36,12]);JSM.AddPolygonToBody(result,[11,35,53,37,13]);JSM.AddPolygonToBody(result,[14,15,39,55,38]);JSM.AddPolygonToBody(result,[16,19,43,56,40]);JSM.AddPolygonToBody(result,[17,41,58,45,21]);JSM.AddPolygonToBody(result,[18,42,57,46,22]);JSM.AddPolygonToBody(result,[20,23,47,59,44]);return result;};JSM.GenerateTruncatedIcosidodecahedron=function(){var result=new JSM.Body();var a=2;var b=(1+Math.sqrt(5))/2;var c=1/b;var d=3+b;var e=2/b;var f=1+2*b;var g=Math.pow(b,2);var h=-1+3*b;var i=-1+2*b;var j=2+b;var k=3;var l=2*b;JSM.AddVertexToBody(result,+c,+c,+d);JSM.AddVertexToBody(result,+c,+c,-d);JSM.AddVertexToBody(result,+c,-c,+d);JSM.AddVertexToBody(result,-c,+c,+d);JSM.AddVertexToBody(result,+c,-c,-d);JSM.AddVertexToBody(result,-c,+c,-d);JSM.AddVertexToBody(result,-c,-c,+d);JSM.AddVertexToBody(result,-c,-c,-d);JSM.AddVertexToBody(result,+c,+d,+c);JSM.AddVertexToBody(result,+c,-d,+c);JSM.AddVertexToBody(result,-c,+d,+c);JSM.AddVertexToBody(result,+c,+d,-c);JSM.AddVertexToBody(result,-c,-d,+c);JSM.AddVertexToBody(result,+c,-d,-c);JSM.AddVertexToBody(result,-c,+d,-c);JSM.AddVertexToBody(result,-c,-d,-c);JSM.AddVertexToBody(result,+d,+c,+c);JSM.AddVertexToBody(result,-d,+c,+c);JSM.AddVertexToBody(result,+d,+c,-c);JSM.AddVertexToBody(result,+d,-c,+c);JSM.AddVertexToBody(result,-d,+c,-c);JSM.AddVertexToBody(result,-d,-c,+c);JSM.AddVertexToBody(result,+d,-c,-c);JSM.AddVertexToBody(result,-d,-c,-c);JSM.AddVertexToBody(result,+e,+b,+f);JSM.AddVertexToBody(result,+e,+b,-f);JSM.AddVertexToBody(result,+e,-b,+f);JSM.AddVertexToBody(result,-e,+b,+f);JSM.AddVertexToBody(result,+e,-b,-f);JSM.AddVertexToBody(result,-e,+b,-f);JSM.AddVertexToBody(result,-e,-b,+f);JSM.AddVertexToBody(result,-e,-b,-f);JSM.AddVertexToBody(result,+b,+f,+e);JSM.AddVertexToBody(result,+b,-f,+e);JSM.AddVertexToBody(result,-b,+f,+e);JSM.AddVertexToBody(result,+b,+f,-e);JSM.AddVertexToBody(result,-b,-f,+e);JSM.AddVertexToBody(result,+b,-f,-e);JSM.AddVertexToBody(result,-b,+f,-e);JSM.AddVertexToBody(result,-b,-f,-e);JSM.AddVertexToBody(result,+f,+e,+b);JSM.AddVertexToBody(result,-f,+e,+b);JSM.AddVertexToBody(result,+f,+e,-b);JSM.AddVertexToBody(result,+f,-e,+b);JSM.AddVertexToBody(result,-f,+e,-b);JSM.AddVertexToBody(result,-f,-e,+b);JSM.AddVertexToBody(result,+f,-e,-b);JSM.AddVertexToBody(result,-f,-e,-b);JSM.AddVertexToBody(result,+c,+g,+h);JSM.AddVertexToBody(result,+c,+g,-h);JSM.AddVertexToBody(result,+c,-g,+h);JSM.AddVertexToBody(result,-c,+g,+h);JSM.AddVertexToBody(result,+c,-g,-h);JSM.AddVertexToBody(result,-c,+g,-h);JSM.AddVertexToBody(result,-c,-g,+h);JSM.AddVertexToBody(result,-c,-g,-h);JSM.AddVertexToBody(result,+g,+h,+c);JSM.AddVertexToBody(result,+g,-h,+c);JSM.AddVertexToBody(result,-g,+h,+c);JSM.AddVertexToBody(result,+g,+h,-c);JSM.AddVertexToBody(result,-g,-h,+c);JSM.AddVertexToBody(result,+g,-h,-c);JSM.AddVertexToBody(result,-g,+h,-c);JSM.AddVertexToBody(result,-g,-h,-c);JSM.AddVertexToBody(result,+h,+c,+g);JSM.AddVertexToBody(result,-h,+c,+g);JSM.AddVertexToBody(result,+h,+c,-g);JSM.AddVertexToBody(result,+h,-c,+g);JSM.AddVertexToBody(result,-h,+c,-g);JSM.AddVertexToBody(result,-h,-c,+g);JSM.AddVertexToBody(result,+h,-c,-g);JSM.AddVertexToBody(result,-h,-c,-g);JSM.AddVertexToBody(result,+i,+a,+j);JSM.AddVertexToBody(result,+i,+a,-j);JSM.AddVertexToBody(result,+i,-a,+j);JSM.AddVertexToBody(result,-i,+a,+j);JSM.AddVertexToBody(result,+i,-a,-j);JSM.AddVertexToBody(result,-i,+a,-j);JSM.AddVertexToBody(result,-i,-a,+j);JSM.AddVertexToBody(result,-i,-a,-j);JSM.AddVertexToBody(result,+a,+j,+i);JSM.AddVertexToBody(result,+a,-j,+i);JSM.AddVertexToBody(result,-a,+j,+i);JSM.AddVertexToBody(result,+a,+j,-i);JSM.AddVertexToBody(result,-a,-j,+i);JSM.AddVertexToBody(result,+a,-j,-i);JSM.AddVertexToBody(result,-a,+j,-i);JSM.AddVertexToBody(result,-a,-j,-i);JSM.AddVertexToBody(result,+j,+i,+a);JSM.AddVertexToBody(result,-j,+i,+a);JSM.AddVertexToBody(result,+j,+i,-a);JSM.AddVertexToBody(result,+j,-i,+a);JSM.AddVertexToBody(result,-j,+i,-a);JSM.AddVertexToBody(result,-j,-i,+a);JSM.AddVertexToBody(result,+j,-i,-a);JSM.AddVertexToBody(result,-j,-i,-a);JSM.AddVertexToBody(result,+b,+k,+l);JSM.AddVertexToBody(result,+b,+k,-l);JSM.AddVertexToBody(result,+b,-k,+l);JSM.AddVertexToBody(result,-b,+k,+l);JSM.AddVertexToBody(result,+b,-k,-l);JSM.AddVertexToBody(result,-b,+k,-l);JSM.AddVertexToBody(result,-b,-k,+l);JSM.AddVertexToBody(result,-b,-k,-l);JSM.AddVertexToBody(result,+k,+l,+b);JSM.AddVertexToBody(result,+k,-l,+b);JSM.AddVertexToBody(result,-k,+l,+b);JSM.AddVertexToBody(result,+k,+l,-b);JSM.AddVertexToBody(result,-k,-l,+b);JSM.AddVertexToBody(result,+k,-l,-b);JSM.AddVertexToBody(result,-k,+l,-b);JSM.AddVertexToBody(result,-k,-l,-b);JSM.AddVertexToBody(result,+l,+b,+k);JSM.AddVertexToBody(result,-l,+b,+k);JSM.AddVertexToBody(result,+l,+b,-k);JSM.AddVertexToBody(result,+l,-b,+k);JSM.AddVertexToBody(result,-l,+b,-k);JSM.AddVertexToBody(result,-l,-b,+k);JSM.AddVertexToBody(result,+l,-b,-k);JSM.AddVertexToBody(result,-l,-b,-k);JSM.AddPolygonToBody(result,[0,3,6,2]);JSM.AddPolygonToBody(result,[1,4,7,5]);JSM.AddPolygonToBody(result,[8,11,14,10]);JSM.AddPolygonToBody(result,[9,12,15,13]);JSM.AddPolygonToBody(result,[16,19,22,18]);JSM.AddPolygonToBody(result,[17,20,23,21]);JSM.AddPolygonToBody(result,[24,72,96,48]);JSM.AddPolygonToBody(result,[25,49,97,73]);JSM.AddPolygonToBody(result,[26,50,98,74]);JSM.AddPolygonToBody(result,[27,51,99,75]);JSM.AddPolygonToBody(result,[28,76,100,52]);JSM.AddPolygonToBody(result,[29,77,101,53]);JSM.AddPolygonToBody(result,[30,78,102,54]);JSM.AddPolygonToBody(result,[31,55,103,79]);JSM.AddPolygonToBody(result,[32,80,104,56]);JSM.AddPolygonToBody(result,[33,57,105,81]);JSM.AddPolygonToBody(result,[34,58,106,82]);JSM.AddPolygonToBody(result,[35,59,107,83]);JSM.AddPolygonToBody(result,[36,84,108,60]);JSM.AddPolygonToBody(result,[37,85,109,61]);JSM.AddPolygonToBody(result,[38,86,110,62]);JSM.AddPolygonToBody(result,[39,63,111,87]);JSM.AddPolygonToBody(result,[40,88,112,64]);JSM.AddPolygonToBody(result,[41,65,113,89]);JSM.AddPolygonToBody(result,[42,66,114,90]);JSM.AddPolygonToBody(result,[43,67,115,91]);JSM.AddPolygonToBody(result,[44,92,116,68]);JSM.AddPolygonToBody(result,[45,93,117,69]);JSM.AddPolygonToBody(result,[46,94,118,70]);JSM.AddPolygonToBody(result,[47,71,119,95]);JSM.AddPolygonToBody(result,[0,24,48,51,27,3]);JSM.AddPolygonToBody(result,[1,5,29,53,49,25]);JSM.AddPolygonToBody(result,[2,6,30,54,50,26]);JSM.AddPolygonToBody(result,[4,28,52,55,31,7]);JSM.AddPolygonToBody(result,[8,32,56,59,35,11]);JSM.AddPolygonToBody(result,[9,13,37,61,57,33]);JSM.AddPolygonToBody(result,[10,14,38,62,58,34]);JSM.AddPolygonToBody(result,[12,36,60,63,39,15]);JSM.AddPolygonToBody(result,[16,40,64,67,43,19]);JSM.AddPolygonToBody(result,[17,21,45,69,65,41]);JSM.AddPolygonToBody(result,[18,22,46,70,66,42]);JSM.AddPolygonToBody(result,[20,44,68,71,47,23]);JSM.AddPolygonToBody(result,[72,112,88,104,80,96]);JSM.AddPolygonToBody(result,[73,97,83,107,90,114]);JSM.AddPolygonToBody(result,[74,98,81,105,91,115]);JSM.AddPolygonToBody(result,[75,99,82,106,89,113]);JSM.AddPolygonToBody(result,[76,118,94,109,85,100]);JSM.AddPolygonToBody(result,[78,117,93,108,84,102]);JSM.AddPolygonToBody(result,[79,103,87,111,95,119]);JSM.AddPolygonToBody(result,[86,101,77,116,92,110]);JSM.AddPolygonToBody(result,[0,2,26,74,115,67,64,112,72,24]);JSM.AddPolygonToBody(result,[1,25,73,114,66,70,118,76,28,4]);JSM.AddPolygonToBody(result,[3,27,75,113,65,69,117,78,30,6]);JSM.AddPolygonToBody(result,[5,7,31,79,119,71,68,116,77,29]);JSM.AddPolygonToBody(result,[8,10,34,82,99,51,48,96,80,32]);JSM.AddPolygonToBody(result,[9,33,81,98,50,54,102,84,36,12]);JSM.AddPolygonToBody(result,[11,35,83,97,49,53,101,86,38,14]);JSM.AddPolygonToBody(result,[13,15,39,87,103,55,52,100,85,37]);JSM.AddPolygonToBody(result,[16,18,42,90,107,59,56,104,88,40]);JSM.AddPolygonToBody(result,[17,41,89,106,58,62,110,92,44,20]);JSM.AddPolygonToBody(result,[19,43,91,105,57,61,109,94,46,22]);JSM.AddPolygonToBody(result,[21,23,47,95,111,63,60,108,93,45]);return result;};JSM.GenerateSnubDodecahedron=function(){var result=new JSM.Body();var a=2;var b=(1+Math.sqrt(5))/2;var c=Math.pow(b/2+(1/2)*Math.sqrt(b-(5/27)),1/3)+Math.pow(b/2-(1/2)*Math.sqrt(b-(5/27)),1/3);var d=c-(1/c);var e=c*b+Math.pow(b,2)+b/c;var f=2*d;var g=2*e;var h=d+(e/b)+b;var i=-(d*b)+e+(1/b);var j=(d/b)+(e*b)-1;var k=-(d/b)+(e*b)+1;var l=-d+(e/b)-b;var m=(d*b)+e-(1/b);var n=-(d/b)+(e*b)-1;var o=d-(e/b)-b;var p=(d*b)+e+(1/b);var q=d+(e/b)-b;var r=(d*b)-e+(1/b);var s=(d/b)+(e*b)+1;JSM.AddVertexToBody(result,+f,+a,-g);JSM.AddVertexToBody(result,+f,-a,+g);JSM.AddVertexToBody(result,-f,+a,+g);JSM.AddVertexToBody(result,-f,-a,-g);JSM.AddVertexToBody(result,+a,-g,+f);JSM.AddVertexToBody(result,-a,+g,+f);JSM.AddVertexToBody(result,+a,+g,-f);JSM.AddVertexToBody(result,-a,-g,-f);JSM.AddVertexToBody(result,-g,+f,+a);JSM.AddVertexToBody(result,+g,+f,-a);JSM.AddVertexToBody(result,+g,-f,+a);JSM.AddVertexToBody(result,-g,-f,-a);JSM.AddVertexToBody(result,+h,+i,-j);JSM.AddVertexToBody(result,+h,-i,+j);JSM.AddVertexToBody(result,-h,+i,+j);JSM.AddVertexToBody(result,-h,-i,-j);JSM.AddVertexToBody(result,+i,-j,+h);JSM.AddVertexToBody(result,-i,+j,+h);JSM.AddVertexToBody(result,+i,+j,-h);JSM.AddVertexToBody(result,-i,-j,-h);JSM.AddVertexToBody(result,-j,+h,+i);JSM.AddVertexToBody(result,+j,+h,-i);JSM.AddVertexToBody(result,+j,-h,+i);JSM.AddVertexToBody(result,-j,-h,-i);JSM.AddVertexToBody(result,+k,+l,-m);JSM.AddVertexToBody(result,+k,-l,+m);JSM.AddVertexToBody(result,-k,+l,+m);JSM.AddVertexToBody(result,-k,-l,-m);JSM.AddVertexToBody(result,+l,-m,+k);JSM.AddVertexToBody(result,-l,+m,+k);JSM.AddVertexToBody(result,+l,+m,-k);JSM.AddVertexToBody(result,-l,-m,-k);JSM.AddVertexToBody(result,-m,+k,+l);JSM.AddVertexToBody(result,+m,+k,-l);JSM.AddVertexToBody(result,+m,-k,+l);JSM.AddVertexToBody(result,-m,-k,-l);JSM.AddVertexToBody(result,+n,+o,-p);JSM.AddVertexToBody(result,+n,-o,+p);JSM.AddVertexToBody(result,-n,+o,+p);JSM.AddVertexToBody(result,-n,-o,-p);JSM.AddVertexToBody(result,+o,-p,+n);JSM.AddVertexToBody(result,-o,+p,+n);JSM.AddVertexToBody(result,+o,+p,-n);JSM.AddVertexToBody(result,-o,-p,-n);JSM.AddVertexToBody(result,-p,+n,+o);JSM.AddVertexToBody(result,+p,+n,-o);JSM.AddVertexToBody(result,+p,-n,+o);JSM.AddVertexToBody(result,-p,-n,-o);JSM.AddVertexToBody(result,+q,+r,-s);JSM.AddVertexToBody(result,+q,-r,+s);JSM.AddVertexToBody(result,-q,+r,+s);JSM.AddVertexToBody(result,-q,-r,-s);JSM.AddVertexToBody(result,+r,-s,+q);JSM.AddVertexToBody(result,-r,+s,+q);JSM.AddVertexToBody(result,+r,+s,-q);JSM.AddVertexToBody(result,-r,-s,-q);JSM.AddVertexToBody(result,-s,+q,+r);JSM.AddVertexToBody(result,+s,+q,-r);JSM.AddVertexToBody(result,+s,-q,+r);JSM.AddVertexToBody(result,-s,-q,-r);JSM.AddPolygonToBody(result,[0,3,51]);JSM.AddPolygonToBody(result,[0,30,12]);JSM.AddPolygonToBody(result,[0,48,3]);JSM.AddPolygonToBody(result,[0,51,30]);JSM.AddPolygonToBody(result,[1,2,50]);JSM.AddPolygonToBody(result,[1,28,13]);JSM.AddPolygonToBody(result,[1,49,2]);JSM.AddPolygonToBody(result,[1,50,28]);JSM.AddPolygonToBody(result,[2,29,14]);JSM.AddPolygonToBody(result,[2,49,29]);JSM.AddPolygonToBody(result,[3,31,15]);JSM.AddPolygonToBody(result,[3,48,31]);JSM.AddPolygonToBody(result,[4,7,55]);JSM.AddPolygonToBody(result,[4,34,16]);JSM.AddPolygonToBody(result,[4,52,7]);JSM.AddPolygonToBody(result,[4,55,34]);JSM.AddPolygonToBody(result,[5,6,54]);JSM.AddPolygonToBody(result,[5,32,17]);JSM.AddPolygonToBody(result,[5,53,6]);JSM.AddPolygonToBody(result,[5,54,32]);JSM.AddPolygonToBody(result,[6,33,18]);JSM.AddPolygonToBody(result,[6,53,33]);JSM.AddPolygonToBody(result,[7,35,19]);JSM.AddPolygonToBody(result,[7,52,35]);JSM.AddPolygonToBody(result,[8,11,59]);JSM.AddPolygonToBody(result,[8,26,20]);JSM.AddPolygonToBody(result,[8,56,11]);JSM.AddPolygonToBody(result,[8,59,26]);JSM.AddPolygonToBody(result,[9,10,58]);JSM.AddPolygonToBody(result,[9,24,21]);JSM.AddPolygonToBody(result,[9,57,10]);JSM.AddPolygonToBody(result,[9,58,24]);JSM.AddPolygonToBody(result,[10,25,22]);JSM.AddPolygonToBody(result,[10,57,25]);JSM.AddPolygonToBody(result,[11,27,23]);JSM.AddPolygonToBody(result,[11,56,27]);JSM.AddPolygonToBody(result,[12,18,21]);JSM.AddPolygonToBody(result,[12,21,24]);JSM.AddPolygonToBody(result,[12,30,18]);JSM.AddPolygonToBody(result,[13,16,22]);JSM.AddPolygonToBody(result,[13,22,25]);JSM.AddPolygonToBody(result,[13,28,16]);JSM.AddPolygonToBody(result,[14,17,20]);JSM.AddPolygonToBody(result,[14,20,26]);JSM.AddPolygonToBody(result,[14,29,17]);JSM.AddPolygonToBody(result,[15,19,23]);JSM.AddPolygonToBody(result,[15,23,27]);JSM.AddPolygonToBody(result,[15,31,19]);JSM.AddPolygonToBody(result,[16,34,22]);JSM.AddPolygonToBody(result,[17,32,20]);JSM.AddPolygonToBody(result,[18,33,21]);JSM.AddPolygonToBody(result,[19,35,23]);JSM.AddPolygonToBody(result,[24,58,36]);JSM.AddPolygonToBody(result,[25,57,37]);JSM.AddPolygonToBody(result,[26,59,38]);JSM.AddPolygonToBody(result,[27,56,39]);JSM.AddPolygonToBody(result,[28,50,40]);JSM.AddPolygonToBody(result,[29,49,41]);JSM.AddPolygonToBody(result,[30,51,42]);JSM.AddPolygonToBody(result,[31,48,43]);JSM.AddPolygonToBody(result,[32,54,44]);JSM.AddPolygonToBody(result,[33,53,45]);JSM.AddPolygonToBody(result,[34,55,46]);JSM.AddPolygonToBody(result,[35,52,47]);JSM.AddPolygonToBody(result,[36,43,48]);JSM.AddPolygonToBody(result,[36,46,43]);JSM.AddPolygonToBody(result,[36,58,46]);JSM.AddPolygonToBody(result,[37,41,49]);JSM.AddPolygonToBody(result,[37,45,41]);JSM.AddPolygonToBody(result,[37,57,45]);JSM.AddPolygonToBody(result,[38,40,50]);JSM.AddPolygonToBody(result,[38,47,40]);JSM.AddPolygonToBody(result,[38,59,47]);JSM.AddPolygonToBody(result,[39,42,51]);JSM.AddPolygonToBody(result,[39,44,42]);JSM.AddPolygonToBody(result,[39,56,44]);JSM.AddPolygonToBody(result,[40,47,52]);JSM.AddPolygonToBody(result,[41,45,53]);JSM.AddPolygonToBody(result,[42,44,54]);JSM.AddPolygonToBody(result,[43,46,55]);JSM.AddPolygonToBody(result,[0,12,24,36,48]);JSM.AddPolygonToBody(result,[1,13,25,37,49]);JSM.AddPolygonToBody(result,[2,14,26,38,50]);JSM.AddPolygonToBody(result,[3,15,27,39,51]);JSM.AddPolygonToBody(result,[4,16,28,40,52]);JSM.AddPolygonToBody(result,[5,17,29,41,53]);JSM.AddPolygonToBody(result,[6,18,30,42,54]);JSM.AddPolygonToBody(result,[7,19,31,43,55]);JSM.AddPolygonToBody(result,[8,20,32,44,56]);JSM.AddPolygonToBody(result,[9,21,33,45,57]);JSM.AddPolygonToBody(result,[10,22,34,46,58]);JSM.AddPolygonToBody(result,[11,23,35,47,59]);return result;};JSM.ConversionData=function(textureLoadedCallback,hasConvexPolygons){this.textureLoadedCallback=textureLoadedCallback;this.hasConvexPolygons=hasConvexPolygons;};JSM.ConvertBodyToThreeMeshesSpecial=function(body,materials,vertexNormals,textureCoords,conversionData){var AddTriangle=function(geometry,vertex1,vertex2,vertex3,normal1,normal2,normal3,uv1,uv2,uv3){var lastVertexIndex=geometry.vertices.length;geometry.vertices.push(new THREE.Vector3(vertex1.x,vertex1.y,vertex1.z));geometry.vertices.push(new THREE.Vector3(vertex2.x,vertex2.y,vertex2.z));geometry.vertices.push(new THREE.Vector3(vertex3.x,vertex3.y,vertex3.z));geometry.faces.push(new THREE.Face3(lastVertexIndex+0,lastVertexIndex+1,lastVertexIndex+2));if(normal1!==undefined&&normal2!==undefined&&normal3!==undefined){var normalArray=[];normalArray.push(new THREE.Vector3(normal1.x,normal1.y,normal1.z));normalArray.push(new THREE.Vector3(normal2.x,normal2.y,normal2.z));normalArray.push(new THREE.Vector3(normal3.x,normal3.y,normal3.z));geometry.faces[geometry.faces.length-1].vertexNormals=normalArray;}if(uv1!==undefined&&uv2!==undefined&&uv3!==undefined){var uvArray=[];uvArray.push(new THREE.UV(uv1.x,uv1.y));uvArray.push(new THREE.UV(uv2.x,uv2.y));uvArray.push(new THREE.UV(uv3.x,uv3.y));geometry.faceVertexUvs[0].push(uvArray);}};var AddPolygon=function(geometry,index,hasTexture){var polygon=body.GetPolygon(index);var count=polygon.VertexIndexCount();if(count<3){return;}var vertex1,vertex2,vertex3;var normal1,normal2,normal3;var uv1,uv2,uv3;if(count===3){vertex1=body.GetVertex(polygon.GetVertexIndex(0)).position;vertex2=body.GetVertex(polygon.GetVertexIndex(1)).position;vertex3=body.GetVertex(polygon.GetVertexIndex(2)).position;normal1=undefined;normal2=undefined;normal3=undefined;if(hasVertexNormals){normal1=vertexNormals[index][0];normal2=vertexNormals[index][1];normal3=vertexNormals[index][2];}uv1=undefined;uv2=undefined;uv3=undefined;if(hasTexture&&hasTextureCoords){uv1=textureCoords[index][0];uv2=textureCoords[index][1];uv3=textureCoords[index][2];}AddTriangle(geometry,vertex1,vertex2,vertex3,normal1,normal2,normal3,uv1,uv2,uv3);}else{var i;var useTriangulation=false;if(conversionData===undefined||conversionData.hasConvexPolygons===undefined||!conversionData.hasConvexPolygons){useTriangulation=true;}if(useTriangulation){var polygon3D=new JSM.Polygon();var vertex;for(i=0;i<count;i++){vertex=body.GetVertex(polygon.vertices[i]);polygon3D.AddVertex(vertex.position.x,vertex.position.y,vertex.position.z);}var normal=JSM.CalculateBodyPolygonNormal(body,index);var triangles=JSM.PolygonTriangulate(polygon3D,normal);var triangle;for(i=0;i<triangles.length;i++){triangle=triangles[i];vertex1=body.GetVertex(polygon.GetVertexIndex(triangle[0])).position;vertex2=body.GetVertex(polygon.GetVertexIndex(triangle[1])).position;vertex3=body.GetVertex(polygon.GetVertexIndex(triangle[2])).position;normal1=undefined;normal2=undefined;normal3=undefined;if(hasVertexNormals){normal1=vertexNormals[index][triangle[0]];normal2=vertexNormals[index][triangle[1]];normal3=vertexNormals[index][triangle[2]];}uv1=undefined;uv2=undefined;uv3=undefined;if(hasTexture&&hasTextureCoords){uv1=textureCoords[index][triangle[0]];uv2=textureCoords[index][triangle[1]];uv3=textureCoords[index][triangle[2]];}AddTriangle(geometry,vertex1,vertex2,vertex3,normal1,normal2,normal3,uv1,uv2,uv3);}}else{for(i=0;i<count-2;i++){vertex1=body.GetVertex(polygon.GetVertexIndex(0)).position;vertex2=body.GetVertex(polygon.GetVertexIndex((i+1)%count)).position;vertex3=body.GetVertex(polygon.GetVertexIndex((i+2)%count)).position;normal1=undefined;normal2=undefined;normal3=undefined;if(hasVertexNormals){normal1=vertexNormals[index][0];normal2=vertexNormals[index][(i+1)%count];normal3=vertexNormals[index][(i+2)%count];}uv1=undefined;uv2=undefined;uv3=undefined;if(hasTexture&&hasTextureCoords){uv1=textureCoords[index][0];uv2=textureCoords[index][(i+1)%count];uv3=textureCoords[index][(i+2)%count];}AddTriangle(geometry,vertex1,vertex2,vertex3,normal1,normal2,normal3,uv1,uv2,uv3);}}}};var CreateGeometry=function(polygonIndices,materialIndex){var geometry=new THREE.Geometry();var hasTexture=(materialIndex!==-1&&materials.GetMaterial(materialIndex).texture!==null);var hasOpacity=(materialIndex!==-1&&materials.GetMaterial(materialIndex).opacity!==1);var i;for(i=0;i<polygonIndices.length;i++){AddPolygon(geometry,polygonIndices[i],hasTexture);}var material=null;if(materialIndex!==-1){material=new THREE.MeshLambertMaterial({ambient:materials.GetMaterial(materialIndex).ambient,color:materials.GetMaterial(materialIndex).diffuse,side:THREE.DoubleSide});if(hasOpacity){material.opacity=materials.GetMaterial(materialIndex).opacity;material.transparent=true;}if(hasTexture){var textureName=materials.GetMaterial(materialIndex).texture;var texture=THREE.ImageUtils.loadTexture(textureName,new THREE.UVMapping(),function(image){if(conversionData!==undefined&&conversionData.textureLoadedCallback!==undefined){conversionData.textureLoadedCallback();}});texture.wrapS=THREE.RepeatWrapping;texture.wrapT=THREE.RepeatWrapping;material.map=texture;}}else{material=new THREE.MeshLambertMaterial({ambient:52224,color:52224,side:THREE.DoubleSide});}var mesh=new THREE.Mesh(geometry,material);meshes.push(mesh);};var i,j;var polygonsByMaterial=[];var polygonsWithNoMaterial=[];var hasVertexNormals=(vertexNormals!==undefined&&vertexNormals!==null);var hasTextureCoords=(textureCoords!==undefined&&textureCoords!==null);if(materials!==undefined&&materials!==null){for(i=0;i<materials.Count();i++){polygonsByMaterial[i]=[];}}var polygon,material;for(i=0;i<body.PolygonCount();i++){polygon=body.GetPolygon(i);if(!polygon.HasMaterialIndex()){polygonsWithNoMaterial.push(i);continue;}material=polygon.GetMaterialIndex();polygonsByMaterial[material].push(i);}var meshes=[];var polygons;for(i=0;i<polygonsByMaterial.length;i++){polygons=polygonsByMaterial[i];if(polygons.length===0){continue;}CreateGeometry(polygons,i);}CreateGeometry(polygonsWithNoMaterial,-1);return meshes;};JSM.ConvertBodyToThreeMeshes=function(body,materials,conversionData){var vertexNormals=JSM.CalculateBodyVertexNormals(body);var hasTextures=false;if(materials!==undefined&&materials!==null&&projection!==null&&coords!==null){var projection=body.GetTextureProjectionType();var coords=body.GetTextureProjectionCoords();for(i=0;i<materials.Count();i++){if(materials.GetMaterial(i).texture!==null){hasTextures=true;break;}}}var textureCoords;if(hasTextures){textureCoords=JSM.CalculateBodyTextureCoords(body);for(i=0;i<textureCoords.length;i++){polygon=body.GetPolygon(i);if(polygon.HasMaterialIndex()){material=materials.GetMaterial(polygon.GetMaterialIndex());for(j=0;j<textureCoords[i].length;j++){textureCoords[i][j].x/=material.textureWidth;textureCoords[i][j].y/=-material.textureHeight;}}}}return JSM.ConvertBodyToThreeMeshesSpecial(body,materials,vertexNormals,textureCoords,conversionData);};JSM.ConvertModelToThreeMeshes=function(model,materials,conversionData){var meshes=[];var currentMeshes=[];var i,j,body;for(i=0;i<model.BodyCount();i++){body=model.GetBody(i);currentMeshes=JSM.ConvertBodyToThreeMeshes(body,materials,conversionData);for(j=0;j<currentMeshes.length;j++){meshes.push(currentMeshes[j]);}}return meshes;};JSM.ConvertBodyContentToSTL=function(body,name,hasConvexPolygons){var AddLineToContent=function(line){stlContent+=line+"\n";};var AddTriangleToContent=function(normal,vertex1,vertex2,vertex3){AddLineToContent("\tfacet normal "+normal.x+" "+normal.y+" "+normal.z);AddLineToContent("\t\touter loop");AddLineToContent("\t\t\tvertex "+vertex1.x+" "+vertex1.y+" "+vertex1.z);AddLineToContent("\t\t\tvertex "+vertex2.x+" "+vertex2.y+" "+vertex2.z);AddLineToContent("\t\t\tvertex "+vertex3.x+" "+vertex3.y+" "+vertex3.z);AddLineToContent("\t\tendloop");AddLineToContent("\tendfacet");};var AddPolygon=function(index){var polygon=body.GetPolygon(index);var count=polygon.VertexIndexCount();if(count<3){return;}var vertex1,vertex2,vertex3;var normal1,normal2,normal3;var uv1,uv2,uv3;if(count===3){var normal=JSM.CalculateBodyPolygonNormal(body,index);vertex1=body.GetVertex(polygon.GetVertexIndex(0)).position;vertex2=body.GetVertex(polygon.GetVertexIndex(1)).position;vertex3=body.GetVertex(polygon.GetVertexIndex(2)).position;AddTriangleToContent(normal,vertex1,vertex2,vertex3);}else{var useTriangulation=true;if(hasConvexPolygons!==undefined&&hasConvexPolygons){useTriangulation=false;}var i;var normal=JSM.CalculateBodyPolygonNormal(body,index);if(useTriangulation){var polygon3D=new JSM.Polygon();var vertex;for(i=0;i<count;i++){vertex=body.GetVertex(polygon.vertices[i]);polygon3D.AddVertex(vertex.position.x,vertex.position.y,vertex.position.z);}var triangles=JSM.PolygonTriangulate(polygon3D,normal);var triangle;for(i=0;i<triangles.length;i++){triangle=triangles[i];vertex1=body.GetVertex(polygon.GetVertexIndex(triangle[0])).position;vertex2=body.GetVertex(polygon.GetVertexIndex(triangle[1])).position;vertex3=body.GetVertex(polygon.GetVertexIndex(triangle[2])).position;AddTriangleToContent(normal,vertex1,vertex2,vertex3);}}else{for(i=0;i<count-2;i++){vertex1=body.GetVertex(polygon.GetVertexIndex(0)).position;vertex2=body.GetVertex(polygon.GetVertexIndex((i+1)%count)).position;vertex3=body.GetVertex(polygon.GetVertexIndex((i+2)%count)).position;AddTriangleToContent(normal,vertex1,vertex2,vertex3);}}}};var stlContent="";var i;for(i=0;i<body.PolygonCount();i++){AddPolygon(i);}return stlContent;};JSM.ConvertBodyToSTL=function(body,name,hasConvexPolygons){var AddLineToContent=function(line){stlContent+=line+"\n";};var stlContent="";AddLineToContent("solid "+name);stlContent+=JSM.ConvertBodyContentToSTL(body,name,hasConvexPolygons);AddLineToContent("endsolid "+name);return stlContent;};JSM.ConvertModelToSTL=function(model,name,hasConvexPolygons){var AddLineToContent=function(line){stlContent+=line+"\n";};var stlContent="";AddLineToContent("solid "+name);var i,body;for(i=0;i<model.BodyCount();i++){body=model.GetBody(i);stlContent+=JSM.ConvertBodyContentToSTL(body,name+(i+1).toString(),hasConvexPolygons);}AddLineToContent("endsolid "+name);return stlContent;};JSM.ConvertRawDataToThreeMeshes=function(rawData,textureLoadedCallback){var AddMesh=function(mesh){var AddTriangles=function(currentTriangles){var materialIndex=currentTriangles["material"];var parameters=currentTriangles["parameters"];var materialData=materials[materialIndex];var textureName=materialData["texture"];var textureOffset=materialData["offset"];var textureScale=materialData["scale"];var ambientColor=new THREE.Color();var diffuseColor=new THREE.Color();var specularColor=new THREE.Color();ambientColor.setRGB(materialData["ambient"][0],materialData["ambient"][1],materialData["ambient"][2]);diffuseColor.setRGB(materialData["diffuse"][0],materialData["diffuse"][1],materialData["diffuse"][2]);specularColor.setRGB(materialData["specular"][0],materialData["specular"][1],materialData["specular"][2]);if(textureName!==undefined){ambientColor.setRGB(1,1,1);diffuseColor.setRGB(1,1,1);specularColor.setRGB(1,1,1);if(textureOffset===undefined){textureOffset=[0,0];}if(textureScale===undefined){textureScale=[1,1];}}var material=new THREE.MeshLambertMaterial({ambient:ambientColor.getHex(),color:diffuseColor.getHex(),side:THREE.DoubleSide});if(materialData["opacity"]!==1){material.opacity=materialData["opacity"];material.transparent=true;}if(textureName!==undefined){texture=THREE.ImageUtils.loadTexture(textureName,new THREE.UVMapping(),function(image){if(textureLoadedCallback!==undefined){textureLoadedCallback();}});texture.wrapS=THREE.RepeatWrapping;texture.wrapT=THREE.RepeatWrapping;material.map=texture;}var geometry=new THREE.Geometry();var v1,v2,v3,n1,n2,n3,u1,u2,u3;var lastVertex,lastFace,vertexNormals,textureUVs;for(j=0;j<parameters.length;j+=9){v1=3*parameters[j+0];v2=3*parameters[j+1];v3=3*parameters[j+2];n1=3*parameters[j+3];n2=3*parameters[j+4];n3=3*parameters[j+5];u1=2*parameters[j+6];u2=2*parameters[j+7];u3=2*parameters[j+8];lastVertex=geometry.vertices.length;lastFace=geometry.faces.length;geometry.vertices.push(new THREE.Vector3(vertices[v1+0],vertices[v1+1],vertices[v1+2]));geometry.vertices.push(new THREE.Vector3(vertices[v2+0],vertices[v2+1],vertices[v2+2]));geometry.vertices.push(new THREE.Vector3(vertices[v3+0],vertices[v3+1],vertices[v3+2]));geometry.faces.push(new THREE.Face3(lastVertex+0,lastVertex+1,lastVertex+2));vertexNormals=[];vertexNormals.push(new THREE.Vector3(normals[n1+0],normals[n1+1],normals[n1+2]));vertexNormals.push(new THREE.Vector3(normals[n2+0],normals[n2+1],normals[n2+2]));vertexNormals.push(new THREE.Vector3(normals[n3+0],normals[n3+1],normals[n3+2]));geometry.faces[lastFace].vertexNormals=vertexNormals;if(textureName!==undefined){textureUVs=[];textureUVs.push(new THREE.UV(textureOffset[0]+uvs[u1+0]*textureScale[0],textureOffset[1]+uvs[u1+1]*textureScale[1]));textureUVs.push(new THREE.UV(textureOffset[0]+uvs[u2+0]*textureScale[0],textureOffset[1]+uvs[u2+1]*textureScale[1]));textureUVs.push(new THREE.UV(textureOffset[0]+uvs[u3+0]*textureScale[0],textureOffset[1]+uvs[u3+1]*textureScale[1]));geometry.faceVertexUvs[0].push(textureUVs);}}var mesh=new THREE.Mesh(geometry,material);result.push(mesh);};var vertices=mesh["vertices"];if(vertices===undefined){return result;}var normals=mesh["normals"];if(normals===undefined){return result;}var uvs=mesh["uvs"];if(uvs===undefined){return result;}var triangles=mesh["triangles"];var i;for(i=0;i<triangles.length;i++){AddTriangles(triangles[i]);}};var result=[];var materials=rawData["materials"];if(materials===undefined){return result;}var meshes=rawData["meshes"];if(meshes===undefined){return result;}var i;for(i=0;i<meshes.length;i++){AddMesh(meshes[i]);}return result;};JSM.Camera=function(){this.origo=null;this.eye=null;this.center=null;this.up=null;};JSM.Camera.prototype={Init:function(eye,center,up){this.origo=new JSM.Coord(center[0],center[1],center[2]);this.eye=new JSM.Coord(eye[0],eye[1],eye[2]);this.center=new JSM.Coord(center[0],center[1],center[2]);this.up=new JSM.Coord(up[0],up[1],up[2]);},Zoom:function(zoomIn){var direction=JSM.CoordSub(this.center,this.eye);var distance=JSM.VectorLength(direction);if(zoomIn&&distance<0.1){return 0;}var move=distance*0.1;if(!zoomIn){move=move*-1;}this.eye=JSM.CoordOffset(this.eye,direction,move);},Pan:function(distanceX,distanceY){var viewDirection=JSM.VectorNormalize(JSM.CoordSub(this.center,this.eye));var horizontalDirection=JSM.VectorNormalize(JSM.VectorCross(viewDirection,this.up));var verticalDirection=JSM.VectorNormalize(JSM.VectorCross(horizontalDirection,viewDirection));this.eye=JSM.CoordOffset(this.eye,verticalDirection,distanceY);this.eye=JSM.CoordOffset(this.eye,horizontalDirection,distanceX);this.center=JSM.CoordOffset(this.center,verticalDirection,distanceY);this.center=JSM.CoordOffset(this.center,horizontalDirection,distanceX);},Orbit:function(angleX,angleY){var radAngleX=angleX*JSM.DegRad;var radAngleY=angleY*JSM.DegRad;var viewDirection=JSM.VectorNormalize(JSM.CoordSub(this.center,this.eye));var horizontalDirection=JSM.VectorNormalize(JSM.VectorCross(viewDirection,this.up));var verticalDirection=JSM.VectorNormalize(JSM.VectorCross(horizontalDirection,viewDirection));this.eye=JSM.CoordRotate(this.eye,verticalDirection,radAngleX,this.origo);this.center=JSM.CoordRotate(this.center,verticalDirection,radAngleX,this.origo);viewDirection=JSM.VectorNormalize(JSM.CoordSub(this.center,this.eye));horizontalDirection=JSM.VectorNormalize(JSM.VectorCross(viewDirection,verticalDirection));this.eye=JSM.CoordRotate(this.eye,horizontalDirection,radAngleY,this.origo);this.center=JSM.CoordRotate(this.center,horizontalDirection,radAngleY,this.origo);this.up=verticalDirection;}};JSM.Mouse=function(){this.down=false;this.button=0;this.shift=false;this.ctrl=false;this.alt=false;this.prevX=0;this.prevY=0;this.currX=0;this.currY=0;this.diffX=0;this.diffY=0;};JSM.Mouse.prototype={Down:function(event,div){var eventParameters=event;if(eventParameters===undefined){eventParameters=window.event;}this.down=true;this.button=event.which;this.shift=event.shiftKey;this.ctrl=event.ctrlKey;this.alt=event.altKey;this.prevX=eventParameters.clientX;this.prevY=eventParameters.clientY;if(div!==undefined){this.prevX=this.prevX-div.offsetLeft;this.prevY=this.prevY-div.offsetTop;}},Move:function(event,div){var eventParameters=event;if(eventParameters===undefined){eventParameters=window.event;}this.shift=event.shiftKey;this.ctrl=event.ctrlKey;this.alt=event.altKey;this.currX=eventParameters.clientX;this.currY=eventParameters.clientY;if(div!==undefined){this.currX=this.currX-div.offsetLeft;this.currY=this.currY-div.offsetTop;}this.diffX=this.currX-this.prevX;this.diffY=this.currY-this.prevY;this.prevX=this.currX;this.prevY=this.currY;},Up:function(event,div){var eventParameters=event;if(eventParameters===undefined){eventParameters=window.event;}this.down=false;this.currX=eventParameters.clientX;this.currY=eventParameters.clientY;if(div!==undefined){this.currX=this.currX-div.offsetLeft;this.currY=this.currY-div.offsetTop;}},Out:function(event,div){var eventParameters=event;if(eventParameters===undefined){eventParameters=window.event;}this.down=false;this.currX=eventParameters.clientX;this.currY=eventParameters.clientY;if(div!==undefined){this.currX=this.currX-div.offsetLeft;this.currY=this.currY-div.offsetTop;}}};JSM.Touch=function(){this.down=false;this.prevX=0;this.prevY=0;this.currX=0;this.currY=0;this.diffX=0;this.diffY=0;};JSM.Touch.prototype={Start:function(event,div){var eventParameters=event;if(eventParameters===undefined){eventParameters=window.event;}if(event.touches.length==0){return;}var touch=event.touches[0];this.down=true;this.prevX=touch.pageX-div.offsetLeft;this.prevY=touch.pageY-div.offsetTop;},Move:function(event,div){var eventParameters=event;if(eventParameters===undefined){eventParameters=window.event;}if(event.touches.length==0){return;}var touch=event.touches[0];this.currX=touch.pageX-div.offsetLeft;this.currY=touch.pageY-div.offsetTop;this.diffX=this.currX-this.prevX;this.diffY=this.currY-this.prevY;this.prevX=this.currX;this.prevY=this.currY;},End:function(event,div){var eventParameters=event;if(eventParameters===undefined){eventParameters=window.event;}this.down=false;}};JSM.Viewer=function(){this.canvas=null;this.scene=null;this.camera=null;this.renderer=null;this.ambientLight=null;this.directionalLight=null;this.cameraMove=null;this.mouse=null;this.touch=null;this.settings=null;};JSM.Viewer.prototype={Start:function(canvasName,settings){if(!this.IsWebGLEnabled()){return false;}if(!this.InitSettings(settings)){return false;}if(!this.InitThree(canvasName)){return false;}if(!this.InitCamera()){return false;}if(!this.InitLights()){return false;}if(!this.InitEvents()){return false;}this.Draw();return true;},IsWebGLEnabled:function(){if(!window.WebGLRenderingContext){return false;}if(!document.createElement("canvas").getContext("experimental-webgl")){return false;}return true;},InitSettings:function(settings){this.settings={"cameraEyePosition":[1,1,1],"cameraCenterPosition":[0,0,0],"cameraUpVector":[0,0,1],"fieldOfView":45,"nearClippingPlane":0.1,"farClippingPlane":1000,"lightAmbientColor":[0.5,0.5,0.5],"lightDiffuseColor":[1,1,1]};if(settings!=undefined){if(settings["cameraEyePosition"]!==undefined){this.settings["cameraEyePosition"]=settings["cameraEyePosition"];}if(settings["cameraCenterPosition"]!==undefined){this.settings["cameraCenterPosition"]=settings["cameraCenterPosition"];}if(settings["cameraUpVector"]!==undefined){this.settings["cameraUpVector"]=settings["cameraUpVector"];}if(settings["fieldOfView"]!==undefined){this.settings["fieldOfView"]=settings["fieldOfView"];}if(settings["nearClippingPlane"]!==undefined){this.settings["nearClippingPlane"]=settings["nearClippingPlane"];}if(settings["farClippingPlane"]!==undefined){this.settings["farClippingPlane"]=settings["farClippingPlane"];}if(settings["lightAmbientColor"]!==undefined){this.settings["lightAmbientColor"]=settings["lightAmbientColor"];}if(settings["lightDiffuseColor"]!==undefined){this.settings["lightDiffuseColor"]=settings["lightDiffuseColor"];}}return true;},InitThree:function(canvasName){this.canvas=document.getElementById(canvasName);if(!this.canvas){return false;}this.scene=new THREE.Scene();if(!this.scene){return false;}var parameters={canvas:this.canvas,antialias:true};this.renderer=new THREE.WebGLRenderer(parameters);if(!this.renderer){return false;}this.renderer.setSize(this.canvas.width,this.canvas.height);return true;},InitCamera:function(canvasName){this.mouse=new JSM.Mouse();if(!this.mouse){return false;}this.touch=new JSM.Touch();if(!this.touch){return false;}this.cameraMove=new JSM.Camera();if(!this.cameraMove){return false;}this.cameraMove.Init(this.settings["cameraEyePosition"],this.settings["cameraCenterPosition"],this.settings["cameraUpVector"]);this.camera=new THREE.PerspectiveCamera(this.settings["fieldOfView"],this.canvas.width/this.canvas.height,this.settings["nearClippingPlane"],this.settings["farClippingPlane"]);if(!this.camera){return false;}this.scene.add(this.camera);return true;},InitLights:function(){var ambientColor=new THREE.Color();var diffuseColor=new THREE.Color();ambientColor.setRGB(this.settings["lightAmbientColor"][0],this.settings["lightAmbientColor"][1],this.settings["lightAmbientColor"][2]);diffuseColor.setRGB(this.settings["lightDiffuseColor"][0],this.settings["lightDiffuseColor"][1],this.settings["lightDiffuseColor"][2]);this.ambientLight=new THREE.AmbientLight(ambientColor.getHex());if(!this.ambientLight){return false;}this.scene.add(this.ambientLight);this.directionalLight=new THREE.DirectionalLight(diffuseColor.getHex());if(!this.directionalLight){return false;}this.directionalLight.position.set(0,0,1).normalize();this.scene.add(this.directionalLight);return true;},InitEvents:function(){var myThis=this;if(document.addEventListener){document.addEventListener("mousemove",function(event){myThis.OnMouseMove(event);});document.addEventListener("mouseup",function(event){myThis.OnMouseUp(event);});}if(this.canvas.addEventListener){this.canvas.addEventListener("mousedown",function(event){myThis.OnMouseDown(event);},false);this.canvas.addEventListener("DOMMouseScroll",function(event){myThis.OnMouseWheel(event);},false);this.canvas.addEventListener("mousewheel",function(event){myThis.OnMouseWheel(event);},false);this.canvas.addEventListener("touchstart",function(event){myThis.OnTouchStart(event);},false);this.canvas.addEventListener("touchmove",function(event){myThis.OnTouchMove(event);},false);this.canvas.addEventListener("touchend",function(event){myThis.OnTouchEnd(event);},false);}return true;},AddMesh:function(mesh){this.scene.add(mesh);this.Draw();},RemoveMeshes:function(){for(var i=0;i<this.scene.__objects.length;i++){var current=this.scene.__objects[i];if(current instanceof THREE.Mesh){this.scene.remove(current);i--;}}},Resize:function(){this.camera.aspect=this.canvas.width/this.canvas.height;this.camera.updateProjectionMatrix();this.renderer.setSize(this.canvas.width,this.canvas.height);this.Draw();},FitInWindow:function(){var center=this.GetCenter();var radius=this.GetBoundingSphereRadius();this.FitInWindowWithCenterAndRadius(center,radius);},FitInWindowWithCenterAndRadius:function(center,radius){var offsetToOrigo=JSM.CoordSub(this.cameraMove.center,center);this.cameraMove.origo=center;this.cameraMove.center=center;this.cameraMove.eye=JSM.CoordSub(this.cameraMove.eye,offsetToOrigo);var centerEyeDirection=JSM.VectorNormalize(JSM.CoordSub(this.cameraMove.eye,this.cameraMove.center));var fieldOfView=this.settings["fieldOfView"]/2;if(this.canvas.width<this.canvas.height){fieldOfView=fieldOfView*this.canvas.width/this.canvas.height;}var distance=radius/Math.sin(fieldOfView*JSM.DegRad);this.cameraMove.eye=JSM.CoordOffset(this.cameraMove.center,centerEyeDirection,distance);this.Draw();},GetCenter:function(){var boundingBox=this.GetBoundingBox();var center=JSM.MidCoord(boundingBox[0],boundingBox[1]);return center;},GetBoundingBox:function(){var min=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf);var max=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf);var i,j,current,geometry,coord;for(i=0;i<this.scene.__objects.length;i++){current=this.scene.__objects[i];if(current instanceof THREE.Mesh){geometry=current.geometry;for(j=0;j<geometry.vertices.length;j++){coord=geometry.vertices[j];min.x=JSM.Minimum(min.x,coord.x);min.y=JSM.Minimum(min.y,coord.y);min.z=JSM.Minimum(min.z,coord.z);max.x=JSM.Maximum(max.x,coord.x);max.y=JSM.Maximum(max.y,coord.y);max.z=JSM.Maximum(max.z,coord.z);}}}return[min,max];},GetBoundingSphereRadius:function(){var center=this.GetCenter();var radius=0;var i,j,current;for(i=0;i<this.scene.__objects.length;i++){current=this.scene.__objects[i];if(current instanceof THREE.Mesh){geometry=current.geometry;for(j=0;j<geometry.vertices.length;j++){current=JSM.CoordDistance(center,geometry.vertices[j]);if(JSM.IsGreater(current,radius)){radius=current;}}}}return radius;},Draw:function(){this.camera.position=this.cameraMove.eye;this.camera.up=this.cameraMove.up;this.camera.lookAt(this.cameraMove.center);this.directionalLight.position=new THREE.Vector3().sub(this.cameraMove.eye,this.cameraMove.center);this.renderer.render(this.scene,this.camera);return true;},OnMouseDown:function(event){this.mouse.Down(event,this.canvas);},OnMouseMove:function(event){this.mouse.Move(event,this.canvas);if(!this.mouse.down){return;}var ratio=1;if(this.mouse.shift){ratio=0.01;this.cameraMove.Pan(-this.mouse.diffX*ratio,this.mouse.diffY*ratio);}else{ratio=-0.5;this.cameraMove.Orbit(this.mouse.diffX*ratio,this.mouse.diffY*ratio);}this.Draw();},OnMouseUp:function(event){this.mouse.Up(event,this.canvas);},OnMouseOut:function(event){this.mouse.Out(event,this.canvas);},OnMouseWheel:function(event){var eventParameters=event;if(eventParameters===null){eventParameters=window.event;}var delta=0;if(eventParameters.detail){delta=-eventParameters.detail;}else{if(eventParameters.wheelDelta){delta=eventParameters.wheelDelta/40;}}var zoomIn=delta>0;this.cameraMove.Zoom(zoomIn);this.Draw();},OnTouchStart:function(event){this.touch.Start(event,this.canvas);},OnTouchMove:function(event){this.touch.Move(event,this.canvas);if(!this.touch.down){return;}var ratio=-0.5;this.cameraMove.Orbit(this.touch.diffX*ratio,this.touch.diffY*ratio);this.Draw();},OnTouchEnd:function(event){this.touch.End(event,this.canvas);}};